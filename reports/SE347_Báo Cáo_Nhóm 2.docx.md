**TRÆ¯á»œNG Äáº I Há»ŒC CÃ”NG NGHá»† THÃ”NG TIN, ÄHQG-HCM**

**KHOA Máº NG MÃY TÃNH VÃ€ TRUYá»€N THÃ”NG**

![][image1]

**BÃO CÃO Äá»’ ÃN MÃ”N Há»ŒC**

# **Äá»€ TÃ€I: XÃ¢y dá»±ng Calendar Assistant Web**

**MÃ´n há»c:** CÃ´ng nghá»‡ Web vÃ  á»©ng dá»¥ng \- SE347.Q12

**Giáº£ng viÃªn hÆ°á»›ng dáº«n:  Äáº·ng Viá»‡t DÅ©ng**

**Thá»±c hiá»‡n bá»Ÿi nhÃ³m 2, bao gá»“m:** 

1. Táº¡ VÄƒn ThÃ¡i			22523177		TrÆ°á»Ÿng nhÃ³m  
2. BÃ¹i Quá»‘c LÃ¢m		22520733		ThÃ nh viÃªn  
3. Nguyá»…n VÄƒn Quyá»n 		22521223		ThÃ nh viÃªn  
4. Nguyá»…n CÃ´ng Tháº¯ng 	22521330		ThÃ nh viÃªn

**Thá»i gian thá»±c hiá»‡n:** 10/2025 \- 1/2026

# **Má»¤C Lá»¤C** {#má»¥c-lá»¥c}

[Má»¤C Lá»¤C	2](#má»¥c-lá»¥c)

[ChÆ°Æ¡ng I. Tá»”NG QUAN.	3](#chÆ°Æ¡ng-i.-tá»•ng-quan.)

[1\. Giá»›i thiá»‡u Ä‘á» tÃ i.	3](#heading=h.g1cnmohwqajz)

[1.2. LÃ½ do chá»n Ä‘á» tÃ i.	3](#1.1-lÃ½-do-chá»n-Ä‘á»-tÃ i.)

[2\. CÆ¡ sá»Ÿ lÃ½ thuyáº¿t.	3](#heading=h.h52d15setcmh)

[ChÆ°Æ¡ng II. THIáº¾T Káº¾ Há»† THá»NG.	4](#chÆ°Æ¡ng-ii.-cÃ´ng-nghá»‡-sá»­-dá»¥ng)

[1.Kiáº¿n trÃºc há»‡ thá»‘ng	4](#heading=h.z18z19u0xqds)

[1.1. Tá»•ng quan vá» kiáº¿n trÃºc	4](#heading=h.l7khgiosucxf)

[1.2. SÆ¡ Ä‘á»“ kiáº¿n trÃºc tá»•ng thá»ƒ	4](#heading=h.kr03iokw7h6)

[1.3 Luá»“ng dá»¯ liá»‡u (Data Flow)	9](#heading=h.3i0w0agac8rr)

[2\. Thiáº¿t káº¿ Database	9](#heading=h.1pi9ud5uc0oj)

[2.1 Tá»•ng quan vá» cáº¥u trÃºc Database	9](#heading=h.st73cs6j8a73)

[2\. Má»‘i quan há»‡ giá»¯a cÃ¡c Tables	11](#heading=h.enzfv0phyihx)

[ChÆ°Æ¡ng III. TRIá»‚N KHAI Há»† THá»NG.	11](#chÆ°Æ¡ng-iii.-phÃ¢n-tÃ­ch-vÃ -thiáº¿t-káº¿-há»‡-thá»‘ng)

[1\. Táº¡o tÃ i khoáº£n Azure.	12](#heading=)

[2\. Khá»Ÿi táº¡o tÃ i nguyÃªn vÃ  cáº¥u hÃ¬nh.	12](#heading=)

[3\. Triá»ƒn khai á»©ng dá»¥ng web.	12](#heading=)

[ChÆ°Æ¡ng IV. Káº¾T LUáº¬N.	13](#heading=h.o9k9z0mixkyq)

[1\. Káº¿t quáº£ Ä‘áº¡t Ä‘Æ°á»£c	13](#heading=h.hegb62hm14wp)

[1.1. ThÃ nh tá»±u vá» Backend	13](#heading=h.htiu8wabsamg)

[1.2. ThÃ nh tá»±u vá» Frontend	16](#heading=h.4yev20d3vtb0)

[1.3. ThÃ nh tá»±u vá» Deployment vÃ  Infrastructure	16](#heading=h.uucx4p2u0o3t)

[1.4. Kiáº¿n thá»©c vÃ  Ká»¹ nÄƒng Thu Ä‘Æ°á»£c	16](#heading=h.f35xlt7w5gly)

[2\. Háº¡n cháº¿ cá»§a Há»‡ thá»‘ng	16](#heading=h.pk08do36flej)

[3\. HÆ°á»›ng PhÃ¡t triá»ƒn TÆ°Æ¡ng lai	16](#heading=h.64tzltaurqon)

[NGUá»’N THAM KHáº¢O	17](#nguá»“n-tham-kháº£o)

# 

# 

# **DANH Má»¤C HÃŒNH áº¢NH** 

[HÃ¬nh 1: NestJS	8](#hÃ¬nh-1:-nestjs)

[HÃ¬nh 2: PostgreSQl	8](#hÃ¬nh-2:-postgresql)

[HÃ¬nh 3: Redis & BullMQ	9](#hÃ¬nh-3:-redis-&-bullmq)

[HÃ¬nh 4: Next.js & React	10](#hÃ¬nh-4:-next.js-&-react)

[HÃ¬nh 5:Tailwind CSS	10](#hÃ¬nh-5:tailwind-css)

[HÃ¬nh 6:Gemini	11](#hÃ¬nh-6:gemini)

[HÃ¬nh 7: LangChain	12](#hÃ¬nh-7:-langchain)

[HÃ¬nh 8: Kiáº¿n trÃºc tá»•ng thá»ƒ	12](#hÃ¬nh-8:-kiáº¿n-trÃºc-tá»•ng-thá»ƒ)

[HÃ¬nh 9: Auth Module	13](#hÃ¬nh-9:-auth-module)

[HÃ¬nh 10: Calendar & Event Module	14](#hÃ¬nh-10:-calendar-&-event-module)

[HÃ¬nh 11: Booking Module	15](#hÃ¬nh-11:-booking-module)

[HÃ¬nh 12: LLM Module	15](#hÃ¬nh-12:-llm-module)

[HÃ¬nh 13: RAG Module	16](#hÃ¬nh-13:-rag-module)

[HÃ¬nh 14: Worker & Infrastructure	17](#hÃ¬nh-14:-worker-&-infrastructure)

# **ChÆ°Æ¡ng I. Tá»”NG QUAN.** {#chÆ°Æ¡ng-i.-tá»•ng-quan.}

## **1.1 LÃ½ do chá»n Ä‘á» tÃ i.** {#1.1-lÃ½-do-chá»n-Ä‘á»-tÃ i.}

Trong bá»‘i cáº£nh xÃ£ há»™i hiá»‡n Ä‘áº¡i, viá»‡c quáº£n lÃ½ thá»i gian hiá»‡u quáº£ Ä‘Ã£ trá»Ÿ thÃ nh má»™t ká»¹ nÄƒng thiáº¿t yáº¿u Ä‘á»‘i vá»›i má»i ngÆ°á»i, Ä‘áº·c biá»‡t lÃ  sinh viÃªn, nhÃ¢n viÃªn vÄƒn phÃ²ng vÃ  cÃ¡c chuyÃªn gia. Theo kháº£o sÃ¡t cá»§a Microsoft (2022), má»™t ngÆ°á»i dÃ¹ng trung bÃ¬nh dÃ nh khoáº£ng 11 giá» má»—i tuáº§n Ä‘á»ƒ quáº£n lÃ½ vÃ  sáº¯p xáº¿p lá»‹ch trÃ¬nh cÃ¡ nhÃ¢n. Con sá»‘ nÃ y cho tháº¥y nhu cáº§u cáº¥p thiáº¿t vá» má»™t giáº£i phÃ¡p tá»‘i Æ°u hÃ³a quy trÃ¬nh quáº£n lÃ½ thá»i gian.

Hiá»‡n nay, thá»‹ trÆ°á»ng Ä‘Ã£ cÃ³ nhiá»u á»©ng dá»¥ng quáº£n lÃ½ lá»‹ch nhÆ° Google Calendar, Outlook Calendar, Apple Calendar. Tuy nhiÃªn, cÃ¡c á»©ng dá»¥ng nÃ y váº«n tá»“n táº¡i má»™t sá»‘ háº¡n cháº¿:

| KhÃ­a cáº¡nh | Háº¡n cháº¿ |
| ----- | ----- |
| TÃ­nh tá»± Ä‘á»™ng hÃ³a | NgÆ°á»i dÃ¹ng pháº£i tá»± nháº­p thÃ´ng tin sá»± kiá»‡n má»™t cÃ¡ch thá»§ cÃ´ng, khÃ´ng cÃ³ kháº£ nÄƒng Ä‘á» xuáº¥t thá»i gian há»p phÃ¹ há»£p tá»± Ä‘á»™ng. |
| Tráº£i nghiá»‡m ngÆ°á»i dÃ¹ng | Giao diá»‡n phá»©c táº¡p vá»›i nhiá»u bÆ°á»›c thao tÃ¡c, khÃ´ng há»— trá»£ tÆ°Æ¡ng tÃ¡c báº±ng ngÃ´n ngá»¯ tá»± nhiÃªn. |
| TÃ­ch há»£p AI | ChÆ°a táº­n dá»¥ng Ä‘Æ°á»£c cÃ´ng nghá»‡ Large Language Models (LLMs), thiáº¿u kháº£ nÄƒng hiá»ƒu ngá»¯ cáº£nh vÃ  tÃ¬m kiáº¿m thÃ´ng minh (RAG). |

Xuáº¥t phÃ¡t tá»« nhá»¯ng báº¥t cáº­p trÃªn, nhÃ³m quyáº¿t Ä‘á»‹nh xÃ¢y dá»±ng Calento (Calendar Intelligence Assistant) \- má»™t á»©ng dá»¥ng web quáº£n lÃ½ lá»‹ch thÃ´ng minh. Calento khÃ´ng chá»‰ lÃ  má»™t cÃ´ng cá»¥ lá»‹ch thÃ´ng thÆ°á»ng mÃ  cÃ²n tÃ­ch há»£p trá»£ lÃ½ áº£o AI, kháº£ nÄƒng xá»­ lÃ½ ngÃ´n ngá»¯ tá»± nhiÃªn vÃ  tÃ¬m kiáº¿m ngá»¯ cáº£nh thÃ´ng minh Ä‘á»ƒ mang láº¡i tráº£i nghiá»‡m Ä‘á»™t phÃ¡.

Äá» tÃ i nÃ y cÅ©ng lÃ  cÆ¡ há»™i Ä‘á»ƒ nhÃ³m Ã¡p dá»¥ng cÃ¡c kiáº¿n thá»©c Ä‘Ã£ há»c trong mÃ´n CÃ´ng nghá»‡ Web vÃ  á»¨ng dá»¥ng, Ä‘á»“ng thá»i tÃ¬m hiá»ƒu cÃ¡c cÃ´ng nghá»‡ má»›i nhÆ° AI, Vector Database.

## **1.2. Má»¥c tiÃªu**

### **1.2.1. Má»¥c tiÃªu chung**

XÃ¢y dá»±ng thÃ nh cÃ´ng á»©ng dá»¥ng web Calento vá»›i Ä‘áº§y Ä‘á»§ cÃ¡c tÃ­nh nÄƒng quáº£n lÃ½ lá»‹ch, tÃ­ch há»£p trá»£ lÃ½ áº£o AI Ä‘á»ƒ há»— trá»£ ngÆ°á»i dÃ¹ng sáº¯p xáº¿p cÃ´ng viá»‡c má»™t cÃ¡ch thÃ´ng minh vÃ  tá»± Ä‘á»™ng.

### **1.2.2. Má»¥c tiÃªu cá»¥ thá»ƒ**

1. Vá» nghiá»‡p vá»¥:  
   * Cung cáº¥p Ä‘áº§y Ä‘á»§ cÃ¡c thao tÃ¡c quáº£n lÃ½ lá»‹ch cÆ¡ báº£n (CRUD events).  
   * TÃ­ch há»£p Google Calendar Ä‘á»ƒ Ä‘á»“ng bá»™ dá»¯ liá»‡u hai chiá»u.  
   * XÃ¢y dá»±ng há»‡ thá»‘ng Ä‘áº·t lá»‹ch háº¹n (Booking System) chuyÃªn nghiá»‡p.  
   * PhÃ¡t triá»ƒn trá»£ lÃ½ áº£o AI cÃ³ kháº£ nÄƒng hiá»ƒu lá»‡nh vÃ  thá»±c hiá»‡n hÃ nh Ä‘á»™ng (Function Calling).  
2. Vá» ká»¹ thuáº­t:  
   * XÃ¢y dá»±ng há»‡ thá»‘ng theo kiáº¿n trÃºc Client-Server hiá»‡n Ä‘áº¡i, Ä‘áº£m báº£o tÃ­nh má»Ÿ rá»™ng vÃ  báº£o trÃ¬.  
   * Sá»­ dá»¥ng NestJS cho Backend vÃ  Next.js cho Frontend Ä‘á»ƒ tá»‘i Æ°u hiá»‡u suáº¥t vÃ  SEO.  
   * Triá»ƒn khai PostgreSQL vá»›i pgvector Ä‘á»ƒ há»— trá»£ tÃ­nh nÄƒng RAG (Retrieval-Augmented Generation).  
   * Tá»‘i Æ°u hÃ³a tráº£i nghiá»‡m ngÆ°á»i dÃ¹ng vá»›i Real-time Streaming vÃ  pháº£n há»“i nhanh chÃ³ng.

## **1.3. Pháº¡m vi thá»±c hiá»‡n**

### **1.3.1. CÃ¡c tÃ­nh nÄƒng Ä‘Æ°á»£c triá»ƒn khai**

1. Quáº£n lÃ½ sá»± kiá»‡n (Event Management):  
   * Táº¡o, xem, sá»­a, xÃ³a sá»± kiá»‡n.  
   * Há»— trá»£ sá»± kiá»‡n láº·p láº¡i (Recurring events \- RRULE).  
   * Quáº£n lÃ½ ngÆ°á»i tham dá»± vÃ  gá»­i lá»i má»i.  
2. AI Assistant & RAG (Retrieval-Augmented Generation):  
   * Chatbot tÃ­ch há»£p Google Gemini AI.  
   * Há»— trá»£ Function Calling Ä‘á»ƒ thá»±c hiá»‡n hÃ nh Ä‘á»™ng (táº¡o lá»‹ch, tÃ¬m lá»‹ch trá»‘ng).  
   * Má»šI: Há»‡ thá»‘ng RAG giÃºp AI ghi nhá»› vÃ  truy xuáº¥t ngá»¯ cáº£nh ngÆ°á»i dÃ¹ng thÃ´ng qua Vector Search.  
3. Há»‡ thá»‘ng Ä‘áº·t lá»‹ch (Booking System):  
   * Táº¡o trang Ä‘áº·t lá»‹ch cÃ¡ nhÃ¢n (Booking Links).  
   * TÃ¹y chá»‰nh khung giá» ráº£nh vÃ  quy táº¯c Ä‘áº·t lá»‹ch.  
4. Äá»“ng bá»™ & TÃ­ch há»£p:  
   * Äá»“ng bá»™ 2 chiá»u vá»›i Google Calendar.  
   * Gá»­i email thÃ´ng bÃ¡o vÃ  nháº¯c nhá»Ÿ tá»± Ä‘á»™ng.

### **1.3.2. Giá»›i háº¡n**

* á»¨ng dá»¥ng táº­p trung vÃ o ná»n táº£ng Web, giao diá»‡n Mobile Ä‘Æ°á»£c tá»‘i Æ°u qua Responsive Web Design (khÃ´ng pháº£i Native App).  
* ChÆ°a há»— trá»£ tÃ­ch há»£p Video Call trá»±c tiáº¿p (chá»‰ táº¡o link Google Meet).  
* TÃ­nh nÄƒng phÃ¢n tÃ­ch dá»¯ liá»‡u nÃ¢ng cao (Advanced Analytics) sáº½ Ä‘Æ°á»£c phÃ¡t triá»ƒn trong giai Ä‘oáº¡n sau.

## **1.4. Bá»‘ cá»¥c bÃ¡o cÃ¡o**

BÃ¡o cÃ¡o Ä‘Æ°á»£c chia thÃ nh 4 chÆ°Æ¡ng chÃ­nh:

* ChÆ°Æ¡ng 1: Giá»›i thiá»‡u Ä‘á» tÃ i: TrÃ¬nh bÃ y lÃ½ do chá»n Ä‘á» tÃ i, má»¥c tiÃªu vÃ  pháº¡m vi cá»§a dá»± Ã¡n.  
* ChÆ°Æ¡ng 2: CÃ´ng nghá»‡ sá»­ dá»¥ng: Giá»›i thiá»‡u cÃ¡c cÃ´ng nghá»‡, ngÃ´n ngá»¯ vÃ  cÃ´ng cá»¥ Ä‘Æ°á»£c sá»­ dá»¥ng Ä‘á»ƒ xÃ¢y dá»±ng há»‡ thá»‘ng (NestJS, Next.js, PostgreSQL/pgvector, Google Gemini).  
* ChÆ°Æ¡ng 3: PhÃ¢n tÃ­ch vÃ  thiáº¿t káº¿ há»‡ thá»‘ng: MÃ´ táº£ kiáº¿n trÃºc tá»•ng thá»ƒ, cÃ¡c thÃ nh pháº§n module (bao gá»“m module Vector/RAG má»›i), vÃ  thiáº¿t káº¿ cÆ¡ sá»Ÿ dá»¯ liá»‡u chi tiáº¿t.  
* ChÆ°Æ¡ng 4: Thiáº¿t káº¿ mÃ n hÃ¬nh: TrÃ¬nh bÃ y sÆ¡ Ä‘á»“ luá»“ng mÃ n hÃ¬nh vÃ  chi tiáº¿t thiáº¿t káº¿ giao diá»‡n ngÆ°á»i dÃ¹ng, bao gá»“m cÃ¡c cáº£i tiáº¿n vá» tráº£i nghiá»‡m chat thÃ´ng minh

# **ChÆ°Æ¡ng II. CÃ”NG NGHá»† Sá»¬ Dá»¤NG** {#chÆ°Æ¡ng-ii.-cÃ´ng-nghá»‡-sá»­-dá»¥ng}

## **2.1. Kiáº¿n trÃºc tá»•ng quan (Tech Stack)**

Há»‡ thá»‘ng Calento Ä‘Æ°á»£c xÃ¢y dá»±ng trÃªn ná»n táº£ng cÃ´ng nghá»‡ hiá»‡n Ä‘áº¡i, Ä‘áº£m báº£o hiá»‡u nÄƒng cao, kháº£ nÄƒng má»Ÿ rá»™ng tá»‘t vÃ  tráº£i nghiá»‡m ngÆ°á»i dÃ¹ng mÆ°á»£t mÃ .

| ThÃ nh pháº§n | CÃ´ng nghá»‡ chÃ­nh |
| ----- | ----- |
| Frontend | Next.js 15, React 19, Tailwind CSS, TanStack Query, Zustand |
| Backend | NestJS, TypeScript |
| Database | PostgreSQL (vá»›i pgvector extension), Redis |
| AI & ML | Google, Gemini, LangChain, Embeddings |
| Infrastructure | Docker, BullMQ, Google Cloud Platform |

## **2.2. CÃ´ng nghá»‡ Backend**

### **2.2.1. NestJS Framework**

NestJS lÃ  framework Node.js Ä‘Æ°á»£c chá»n lÃ m ná»n táº£ng cho Backend vÃ¬ kiáº¿n trÃºc module hÃ³a rÃµ rÃ ng, há»— trá»£ TypeScript toÃ n diá»‡n vÃ  tuÃ¢n thá»§ cÃ¡c nguyÃªn táº¯c SOLID.

* Module System: GiÃºp tá»• chá»©c code thÃ nh cÃ¡c khá»‘i Ä‘á»™c láº­p (AuthModule, UserModule, AIModule, VectorModule...), dá»… báº£o trÃ¬ vÃ  má»Ÿ rá»™ng.  
* Dependency Injection: Quáº£n lÃ½ sá»± phá»¥ thuá»™c giá»¯a cÃ¡c thÃ nh pháº§n hiá»‡u quáº£.  
* Decorators: ÄÆ¡n giáº£n hÃ³a viá»‡c khai bÃ¡o route, middleware vÃ  validation.


  ##### HÃ¬nh 1: NestJS  {#hÃ¬nh-1:-nestjs}

### **2.2.2. PostgreSQL & pgvector**

Há»‡ thá»‘ng sá»­ dá»¥ng PostgreSQL lÃ m cÆ¡ sá»Ÿ dá»¯ liá»‡u chÃ­nh (Relational Database) káº¿t há»£p vá»›i extension pgvector Ä‘á»ƒ há»— trá»£ lÆ°u trá»¯ vÃ  tÃ¬m kiáº¿m vector.

* Relational Data: LÆ°u trá»¯ thÃ´ng tin structured nhÆ° User, Event, Calendar, Booking.  
* Vector Data: LÆ°u trá»¯ embeddings cá»§a ngá»¯ cáº£nh ngÆ°á»i dÃ¹ng vÃ  lá»‹ch sá»­ há»™i thoáº¡i trong báº£ng user\_context\_summary vá»›i kÃ­ch thÆ°á»›c 768 chiá»u (tÆ°Æ¡ng thÃ­ch vá»›i model embedding má»›i cá»§a Google).  
* Hybrid Search: Káº¿t há»£p tÃ¬m kiáº¿m tá»« khÃ³a (Full-text search) vÃ  tÃ¬m kiáº¿m ngá»¯ nghÄ©a (Vector similarity search) Ä‘á»ƒ tÄƒng Ä‘á»™ chÃ­nh xÃ¡c.

  ![][image2]

  ##### HÃ¬nh 2: PostgreSQl {#hÃ¬nh-2:-postgresql}

### **2.2.3. Redis & BullMQ**

* Redis: Sá»­ dá»¥ng lÃ m bá»™ nhá»› Ä‘á»‡m (Caching) Ä‘á»ƒ tÄƒng tá»‘c Ä‘á»™ truy xuáº¥t dá»¯ liá»‡u thÆ°á»ng dÃ¹ng vÃ  lÆ°u trá»¯ session/temp data.  
* BullMQ: ThÆ° viá»‡n quáº£n lÃ½ hÃ ng Ä‘á»£i (Message Queue) dá»±a trÃªn Redis, dÃ¹ng Ä‘á»ƒ xá»­ lÃ½ cÃ¡c tÃ¡c vá»¥ ná»n (background jobs) nhÆ° gá»­i email, Ä‘á»“ng bá»™ lá»‹ch Google, xá»­ lÃ½ embeddings mÃ  khÃ´ng lÃ m cháº·n luá»“ng chÃ­nh cá»§a á»©ng dá»¥ng.

  ![][image3]

  ![][image4]

  ##### HÃ¬nh 3: Redis & BullMQ {#hÃ¬nh-3:-redis-&-bullmq}

## **2.3. CÃ´ng nghá»‡ Frontend**

### **2.3.1. Next.js 15 & React 19**

Sá»­ dá»¥ng Next.js phiÃªn báº£n má»›i nháº¥t vá»›i App Router Ä‘á»ƒ táº­n dá»¥ng cÃ¡c tÃ­nh nÄƒng:

* Server Components (RSC): Render giao diá»‡n trÃªn server, giáº£m dung lÆ°á»£ng JavaScript gá»­i xuá»‘ng client.  
* Server Actions: Xá»­ lÃ½ logic form vÃ  mutation trá»±c tiáº¿p trÃªn server mÃ  khÃ´ng cáº§n táº¡o API route riÃªng biá»‡t.  
* Streaming & Suspense: Hiá»ƒn thá»‹ tá»«ng pháº§n cá»§a trang web ngay khi sáºµn sÃ ng, Ä‘áº·c biá»‡t há»¯u Ã­ch cho tÃ­nh nÄƒng AI Chat streaming.

  ![][image5]

  ##### HÃ¬nh 4: Next.js & React  {#hÃ¬nh-4:-next.js-&-react}

### **2.3.2. Tailwind CSS & UI Libraries**

* Tailwind CSS: Framework CSS utility-first giÃºp xÃ¢y dá»±ng giao diá»‡n nhanh chÃ³ng, dá»… tÃ¹y biáº¿n vÃ  tá»‘i Æ°u dung lÆ°á»£ng.  
* Radix UI / Shadcn UI: Bá»™ component headless Ä‘áº£m báº£o tÃ­nh truy cáº­p (accessibility) vÃ  dá»… dÃ ng tÃ¹y chá»‰nh style.

  ![][image6]

  ##### HÃ¬nh 5:Tailwind CSS {#hÃ¬nh-5:tailwind-css}

### **2.3.3. AI Chat Integration**

* React Markdown: Há»— trá»£ render ná»™i dung pháº£n há»“i tá»« AI (Markdown) thÃ nh HTML Ä‘áº¹p máº¯t.  
* Event Source API: Sá»­ dá»¥ng Server-Sent Events (SSE) Ä‘á»ƒ nháº­n pháº£n há»“i tá»« AI theo thá»i gian thá»±c (streaming response), mang láº¡i cáº£m giÃ¡c há»™i thoáº¡i tá»± nhiÃªn.

## **2.4. CÃ´ng nghá»‡ AI & LLM**

### **2.4.1. Gemini** 

Calento tÃ­ch há»£p mÃ´ hÃ¬nh ngÃ´n ngá»¯ lá»›n (LLM) Gemini Pro cá»§a Google Ä‘á»ƒ xá»­ lÃ½ logic há»™i thoáº¡i vÃ  function calling.

* Natural Language Processing: Hiá»ƒu Ã½ Ä‘á»‹nh ngÆ°á»i dÃ¹ng tá»« cÃ¢u chat tá»± nhiÃªn (VD: "Äáº·t lá»‹ch há»p team vÃ o sÃ¡ng thá»© 2").  
* Function Calling: AI tá»± Ä‘á»™ng xÃ¡c Ä‘á»‹nh vÃ  gá»i cÃ¡c hÃ m nghiá»‡p vá»¥ (createEvent, findSlot, summary) dá»±a trÃªn yÃªu cáº§u.

  ![][image7]

  ##### HÃ¬nh 6:Gemini {#hÃ¬nh-6:gemini}

### **2.4.2. LangChain & Embeddings**

* LangChain: Framework giÃºp káº¿t ná»‘i LLM vá»›i dá»¯ liá»‡u cá»§a á»©ng dá»¥ng vÃ  quáº£n lÃ½ luá»“ng há»™i thoáº¡i.  
* Embeddings (text-embedding-004): Chuyá»ƒn Ä‘á»•i vÄƒn báº£n (ghi chÃº, ngá»¯ cáº£nh) thÃ nh cÃ¡c vector 768 chiá»u Ä‘á»ƒ lÆ°u trá»¯ vÃ  tÃ¬m kiáº¿m tÆ°Æ¡ng Ä‘á»“ng, phá»¥c vá»¥ cho tÃ­nh nÄƒng RAG (nhá»› láº¡i thÃ´ng tin cÅ©).

  ![][image8]

  ##### HÃ¬nh 7: LangChain {#hÃ¬nh-7:-langchain}

# **ChÆ°Æ¡ng III. PHÃ‚N TÃCH VÃ€ THIáº¾T Káº¾ Há»† THá»NG** {#chÆ°Æ¡ng-iii.-phÃ¢n-tÃ­ch-vÃ -thiáº¿t-káº¿-há»‡-thá»‘ng}

## **3.1. Danh sÃ¡ch cÃ¡c yÃªu cáº§u**

### **3.1.1. YÃªu cáº§u nghiá»‡p vá»¥ (Business Requirements)**

Há»‡ thá»‘ng Calento Ä‘Æ°á»£c xÃ¢y dá»±ng nháº±m giáº£i quyáº¿t cÃ¡c váº¥n Ä‘á» quáº£n lÃ½ thá»i gian trong bá»‘i cáº£nh hiá»‡n Ä‘áº¡i, vá»›i cÃ¡c yÃªu cáº§u nghiá»‡p vá»¥ chÃ­nh Ä‘Æ°á»£c phÃ¢n tÃ­ch dá»±a trÃªn nhu cáº§u thá»±c táº¿ cá»§a ngÆ°á»i dÃ¹ng vÃ  xu hÆ°á»›ng cÃ´ng nghá»‡.

#### **BR-01: Quáº£n lÃ½ sá»± kiá»‡n vÃ  lá»‹ch trÃ¬nh cÃ¡ nhÃ¢n**

Há»‡ thá»‘ng pháº£i cho phÃ©p ngÆ°á»i dÃ¹ng táº¡o, xem, sá»­a, xÃ³a cÃ¡c sá»± kiá»‡n trong lá»‹ch cÃ¡ nhÃ¢n má»™t cÃ¡ch linh hoáº¡t. Má»—i sá»± kiá»‡n cáº§n chá»©a Ä‘áº§y Ä‘á»§ thÃ´ng tin bao gá»“m tiÃªu Ä‘á», thá»i gian báº¯t Ä‘áº§u/káº¿t thÃºc, Ä‘á»‹a Ä‘iá»ƒm, mÃ´ táº£ chi tiáº¿t, vÃ  danh sÃ¡ch ngÆ°á»i tham dá»±. Äáº·c biá»‡t, há»‡ thá»‘ng cáº§n há»— trá»£ cÃ¡c sá»± kiá»‡n láº·p láº¡i (recurring events) theo cÃ¡c pattern phá»©c táº¡p nhÆ° hÃ ng ngÃ y, hÃ ng tuáº§n, hÃ ng thÃ¡ng, hoáº·c theo quy táº¯c tÃ¹y chá»‰nh tuÃ¢n theo chuáº©n RRULE (RFC 5545).

Lá»‹ch cáº§n Ä‘Æ°á»£c hiá»ƒn thá»‹ á»Ÿ nhiá»u cháº¿ Ä‘á»™ xem khÃ¡c nhau (ngÃ y, tuáº§n, thÃ¡ng, nÄƒm) Ä‘á»ƒ phÃ¹ há»£p vá»›i nhu cáº§u khÃ¡c nhau cá»§a ngÆ°á»i dÃ¹ng. TÃ­nh nÄƒng kÃ©o-tháº£ (drag and drop) cáº§n Ä‘Æ°á»£c tÃ­ch há»£p Ä‘á»ƒ ngÆ°á»i dÃ¹ng cÃ³ thá»ƒ nhanh chÃ³ng thay Ä‘á»•i thá»i gian sá»± kiá»‡n mÃ  khÃ´ng cáº§n má»Ÿ form chá»‰nh sá»­a. Há»‡ thá»‘ng cÅ©ng pháº£i há»— trá»£ nhiá»u mÃºi giá» (timezone) khÃ¡c nhau, Ä‘áº·c biá»‡t quan trá»ng cho ngÆ°á»i dÃ¹ng lÃ m viá»‡c quá»‘c táº¿ hoáº·c thÆ°á»ng xuyÃªn di chuyá»ƒn giá»¯a cÃ¡c khu vá»±c Ä‘á»‹a lÃ½.

#### **BR-02: Äá»“ng bá»™ hÃ³a vá»›i Google Calendar**

Do Google Calendar lÃ  dá»‹ch vá»¥ lá»‹ch phá»• biáº¿n nháº¥t hiá»‡n nay vá»›i hÆ¡n 500 triá»‡u ngÆ°á»i dÃ¹ng, viá»‡c tÃ­ch há»£p Ä‘á»“ng bá»™ lÃ  yÃªu cáº§u thiáº¿t yáº¿u. Há»‡ thá»‘ng pháº£i thá»±c hiá»‡n Ä‘á»“ng bá»™ hai chiá»u (bi-directional sync): pull events tá»« Google Calendar vá» Calento vÃ  push cÃ¡c sá»± kiá»‡n Ä‘Æ°á»£c táº¡o trong Calento lÃªn Google Calendar. Äiá»u nÃ y Ä‘áº£m báº£o ngÆ°á»i dÃ¹ng cÃ³ thá»ƒ quáº£n lÃ½ lá»‹ch tá»« báº¥t ká»³ ná»n táº£ng nÃ o (Calento, Google Calendar mobile app, hoáº·c cÃ¡c á»©ng dá»¥ng khÃ¡c tÃ­ch há»£p Google Calendar) vÃ  dá»¯ liá»‡u luÃ´n Ä‘Æ°á»£c Ä‘á»“ng nháº¥t.

QuÃ¡ trÃ¬nh Ä‘á»“ng bá»™ cáº§n Ä‘Æ°á»£c tá»± Ä‘á»™ng hÃ³a hoÃ n toÃ n thÃ´ng qua background jobs, cháº¡y Ä‘á»‹nh ká»³ mÃ  khÃ´ng lÃ m giÃ¡n Ä‘oáº¡n tráº£i nghiá»‡m ngÆ°á»i dÃ¹ng. Há»‡ thá»‘ng pháº£i cÃ³ kháº£ nÄƒng phÃ¡t hiá»‡n vÃ  giáº£i quyáº¿t conflicts (xung Ä‘á»™t) khi cÃ¹ng má»™t sá»± kiá»‡n bá»‹ chá»‰nh sá»­a á»Ÿ cáº£ hai phÃ­a, cung cáº¥p cho ngÆ°á»i dÃ¹ng cÃ¡c tÃ¹y chá»n resolution nhÆ° Æ°u tiÃªn phÃ­a Google, Æ°u tiÃªn phÃ­a Calento, hoáº·c giá»¯ cáº£ hai phiÃªn báº£n.

#### **BR-03: Há»‡ thá»‘ng Ä‘áº·t lá»‹ch háº¹n cÃ´ng khai (Booking System)**

Há»‡ thá»‘ng cáº§n cung cáº¥p tÃ­nh nÄƒng cho phÃ©p ngÆ°á»i dÃ¹ng táº¡o cÃ¡c "booking links" - nhá»¯ng trang Ä‘áº·t lá»‹ch cÃ´ng khai tÆ°Æ¡ng tá»± nhÆ° Calendly hoáº·c Cal.com. Má»—i user cÃ³ thá»ƒ táº¡o nhiá»u booking links vá»›i cÃ¡c cáº¥u hÃ¬nh khÃ¡c nhau, phá»¥c vá»¥ cho cÃ¡c má»¥c Ä‘Ã­ch khÃ¡c nhau (vÃ­ dá»¥: "30-minute Meeting", "1-hour Consulting", "Quick Call").

Má»—i booking link cáº§n cho phÃ©p cáº¥u hÃ¬nh chi tiáº¿t bao gá»“m: thá»i lÆ°á»£ng cuá»™c háº¹n (duration), thá»i gian Ä‘á»‡m trÆ°á»›c vÃ  sau (buffer time), thá»i gian thÃ´ng bÃ¡o tá»‘i thiá»ƒu (advance notice), sá»‘ lÆ°á»£ng booking tá»‘i Ä‘a má»—i ngÃ y, vÃ  mÃºi giá» máº·c Ä‘á»‹nh. Há»‡ thá»‘ng pháº£i tá»± Ä‘á»™ng tÃ­nh toÃ¡n cÃ¡c khung giá» ráº£nh (available slots) dá»±a trÃªn lá»‹ch availability Ä‘Ã£ Ä‘Æ°á»£c user thiáº¿t láº­p vÃ  cÃ¡c sá»± kiá»‡n hiá»‡n cÃ³, Ä‘áº£m báº£o khÃ´ng cÃ³ conflict.

Khi khÃ¡ch (guest) Ä‘áº·t lá»‹ch thÃ nh cÃ´ng, há»‡ thá»‘ng cáº§n tá»± Ä‘á»™ng táº¡o sá»± kiá»‡n cho cáº£ host vÃ  guest, gá»­i email xÃ¡c nháº­n cho cáº£ hai bÃªn vá»›i thÃ´ng tin Ä‘áº§y Ä‘á»§ (thá»i gian, Ä‘á»‹a Ä‘iá»ƒm, link tham gia náº¿u lÃ  online meeting), vÃ  tÃ¹y chá»n tá»± Ä‘á»™ng Ä‘á»“ng bá»™ lÃªn Google Calendar cá»§a host.

#### **BR-04: Trá»£ lÃ½ áº£o AI thÃ´ng minh (AI Assistant)**

ÄÃ¢y lÃ  tÃ­nh nÄƒng khÃ¡c biá»‡t hÃ³a chÃ­nh cá»§a Calento so vá»›i cÃ¡c á»©ng dá»¥ng lá»‹ch truyá»n thá»‘ng. Há»‡ thá»‘ng cáº§n tÃ­ch há»£p má»™t AI assistant cÃ³ kháº£ nÄƒng hiá»ƒu ngÃ´n ngá»¯ tá»± nhiÃªn (tiáº¿ng Viá»‡t vÃ  tiáº¿ng Anh), cho phÃ©p ngÆ°á»i dÃ¹ng tÆ°Æ¡ng tÃ¡c báº±ng cÃ¡ch chat thay vÃ¬ pháº£i Ä‘iá»n form hoáº·c nháº¥n nhiá»u nÃºt.

AI assistant cáº§n cÃ³ kháº£ nÄƒng thá»±c hiá»‡n cÃ¡c tÃ¡c vá»¥ sau qua lá»‡nh chat: (1) Truy váº¥n lá»‹ch trÃ¬nh - "TÃ´i cÃ³ báº­n vÃ o thá»© 5 khÃ´ng?", "Cuá»™c há»p tiáº¿p theo cá»§a tÃ´i lÃ  gÃ¬?"; (2) Táº¡o sá»± kiá»‡n má»›i - "Äáº·t lá»‹ch há»p team vÃ o 9h sÃ¡ng thá»© 2"; (3) TÃ¬m khung giá» ráº£nh - "Khi nÃ o tÃ´i ráº£nh Ä‘á»ƒ gáº·p khÃ¡ch hÃ ng?"; (4) TÃ³m táº¯t lá»‹ch trÃ¬nh - "TÃ³m táº¯t lá»‹ch tuáº§n sau cho tÃ´i".

Äá»ƒ Ä‘áº¡t Ä‘Æ°á»£c Ä‘á»™ chÃ­nh xÃ¡c cao, há»‡ thá»‘ng cáº§n triá»ƒn khai RAG (Retrieval-Augmented Generation) pattern. Khi nháº­n cÃ¢u há»i tá»« user, AI sáº½: (1) Chuyá»ƒn Ä‘á»•i cÃ¢u há»i thÃ nh vector embedding 768 chiá»u, (2) TÃ¬m kiáº¿m cÃ¡c sá»± kiá»‡n vÃ  ngá»¯ cáº£nh liÃªn quan trong database sá»­ dá»¥ng pgvector vá»›i cosine similarity, (3) ÄÆ°a context nÃ y vÃ o prompt gá»­i cho LLM model (Google Gemini), (4) LLM sinh ra cÃ¢u tráº£ lá»i dá»±a trÃªn context cá»¥ thá»ƒ cá»§a user thay vÃ¬ general knowledge.

AI cÅ©ng cáº§n há»— trá»£ function calling, nghÄ©a lÃ  cÃ³ thá»ƒ tá»± Ä‘á»™ng xÃ¡c Ä‘á»‹nh khi nÃ o cáº§n gá»i cÃ¡c function nghiá»‡p vá»¥ (nhÆ° createEvent, findAvailableSlots) vÃ  thá»±c thi chÃºng sau khi confirm vá»›i user.

#### **BR-05: Quáº£n lÃ½ cÃ´ng viá»‡c vá»›i há»‡ thá»‘ng Æ°u tiÃªn (Task Management)**

NgoÃ i sá»± kiá»‡n, ngÆ°á»i dÃ¹ng cáº§n quáº£n lÃ½ cÃ¡c cÃ´ng viá»‡c (tasks) - nhá»¯ng viá»‡c cáº§n lÃ m nhÆ°ng chÆ°a cÃ³ thá»i gian cá»¥ thá»ƒ hoáº·c deadline linh hoáº¡t. Há»‡ thá»‘ng cáº§n cung cáº¥p má»™t priority board vá»›i 4 cáº¥p Ä‘á»™ Æ°u tiÃªn: Critical (kháº©n cáº¥p pháº£i lÃ m ngay), High (quan trá»ng), Medium (trung bÃ¬nh), vÃ  Low (cÃ³ thá»ƒ lÃ m sau).

Tasks cáº§n há»— trá»£ Ä‘áº§y Ä‘á»§ cÃ¡c thuá»™c tÃ­nh nhÆ° title, description, due date, tags, project/category, vÃ  quan há»‡ phÃ¢n cáº¥p (subtasks). Giao diá»‡n priority board pháº£i cÃ³ tÃ­nh nÄƒng drag-and-drop Ä‘á»ƒ ngÆ°á»i dÃ¹ng dá»… dÃ ng thay Ä‘á»•i má»©c Ä‘á»™ Æ°u tiÃªn hoáº·c thá»© tá»± trong cÃ¹ng má»™t column. Há»‡ thá»‘ng cÅ©ng cáº§n há»— trá»£ recurring tasks cho cÃ¡c cÃ´ng viá»‡c láº·p láº¡i Ä‘á»‹nh ká»³.

Má»™t tÃ­nh nÄƒng quan trá»ng lÃ  kháº£ nÄƒng chuyá»ƒn Ä‘á»•i task thÃ nh event vÃ  ngÆ°á»£c láº¡i. VÃ­ dá»¥, khi user quyáº¿t Ä‘á»‹nh thá»i gian cá»¥ thá»ƒ Ä‘á»ƒ lÃ m má»™t task, há» cÃ³ thá»ƒ convert task Ä‘Ã³ thÃ nh event trÃªn calendar Ä‘á»ƒ block time.

#### **BR-06: Cá»™ng tÃ¡c nhÃ³m (Team Collaboration)**

Äá»‘i vá»›i cÃ¡c nhÃ³m lÃ m viá»‡c (team), há»‡ thá»‘ng cáº§n cung cáº¥p khÃ´ng gian chia sáº» lá»‹ch. Má»—i team owner cÃ³ thá»ƒ táº¡o team, má»i members (tá»‘i Ä‘a 5 ngÆ°á»i trong phiÃªn báº£n hiá»‡n táº¡i), vÃ  quáº£n lÃ½ quyá»n truy cáº­p. Team calendar cho phÃ©p táº¥t cáº£ members xem sá»± kiá»‡n chung, trÃ¡nh viá»‡c book meeting vÃ o thá»i gian conflict.

TÃ­nh nÄƒng Team Rituals Ä‘áº·c biá»‡t há»¯u Ã­ch cho cÃ¡c cuá»™c há»p Ä‘á»‹nh ká»³ nhÆ° Daily Standup, Weekly Planning, hoáº·c Monthly Review. Owner cÃ³ thá»ƒ setup ritual vá»›i recurrence rule vÃ  rotation schedule - ai sáº½ lÃ  ngÆ°á»i lead/present trong má»—i láº§n meeting. Há»‡ thá»‘ng tá»± Ä‘á»™ng táº¡o events cho cÃ¡c instances cá»§a ritual vÃ  assign Ä‘Ãºng ngÆ°á»i theo rotation order.

Team availability dashboard cho phÃ©p members xem Ä‘Æ°á»£c khung giá» ráº£nh cá»§a nhau, giÃºp viá»‡c sáº¯p xáº¿p meeting chung trá»Ÿ nÃªn dá»… dÃ ng hÆ¡n mÃ  khÃ´ng cáº§n trao Ä‘á»•i qua láº¡i nhiá»u láº§n.

#### **BR-07: Há»‡ thá»‘ng thÃ´ng bÃ¡o Ä‘a kÃªnh (Multi-channel Notifications)**

Äá»ƒ Ä‘áº£m báº£o ngÆ°á»i dÃ¹ng khÃ´ng bá» lá»¡ sá»± kiá»‡n quan trá»ng, há»‡ thá»‘ng cáº§n gá»­i thÃ´ng bÃ¡o nháº¯c nhá»Ÿ qua nhiá»u kÃªnh khÃ¡c nhau. Email notification lÃ  kÃªnh chÃ­nh, Ä‘Æ°á»£c gá»­i tá»± Ä‘á»™ng cho cÃ¡c sá»± kiá»‡n: (1) XÃ¡c nháº­n khi táº¡o/cáº­p nháº­t sá»± kiá»‡n, (2) Nháº¯c nhá»Ÿ trÆ°á»›c sá»± kiá»‡n (15 phÃºt, 1 giá», 1 ngÃ y tÃ¹y theo cÃ i Ä‘áº·t), (3) ThÃ´ng bÃ¡o khi cÃ³ ngÆ°á»i RSVP lá»i má»i, (4) ThÃ´ng bÃ¡o booking má»›i tá»« booking link.

Há»‡ thá»‘ng cÅ©ng cáº§n há»— trá»£ webhook Ä‘á»ƒ tÃ­ch há»£p vá»›i cÃ¡c dá»‹ch vá»¥ bÃªn thá»© ba nhÆ° Slack, Telegram, hoáº·c Zapier. User cÃ³ thá»ƒ configure webhook URLs vÃ  chá»n events nÃ o sáº½ trigger webhook. Trong tÆ°Æ¡ng lai, push notifications cho mobile app vÃ  SMS notifications cÅ©ng sáº½ Ä‘Æ°á»£c bá»• sung.

#### **BR-08: Content Management System (Blog CMS)**

Äá»ƒ xÃ¢y dá»±ng cá»™ng Ä‘á»“ng vÃ  chia sáº» kiáº¿n thá»©c vá» quáº£n lÃ½ thá»i gian, há»‡ thá»‘ng cáº§n cÃ³ má»™t blog platform tÃ­ch há»£p. Admin/content manager cÃ³ thá»ƒ táº¡o bÃ i viáº¿t vá»›i rich text editor (há»— trá»£ markdown, images, code blocks), phÃ¢n loáº¡i theo categories, gáº¯n tags, vÃ  schedule publish time.

Blog cáº§n Ä‘Æ°á»£c tá»‘i Æ°u cho SEO vá»›i cÃ¡c features: custom meta title/description, friendly URLs (slugs), sitemap.xml tá»± Ä‘á»™ng, vÃ  schema markup. Há»‡ thá»‘ng comments cho phÃ©p readers tÆ°Æ¡ng tÃ¡c, nhÆ°ng cáº§n cÃ³ moderation tools Ä‘á»ƒ admin kiá»ƒm duyá»‡t trÆ°á»›c khi publish. Analytics tracking giÃºp admin theo dÃµi views, popular posts, vÃ  engagement metrics.

### **3.1.2. YÃªu cáº§u chá»©c nÄƒng chi tiáº¿t (Functional Requirements)**

Dá»±a trÃªn cÃ¡c yÃªu cáº§u nghiá»‡p vá»¥ trÃªn, há»‡ thá»‘ng Ä‘Æ°á»£c phÃ¢n tÃ­ch thÃ nh cÃ¡c yÃªu cáº§u chá»©c nÄƒng cá»¥ thá»ƒ theo tá»«ng module:

| ID | Module | Chá»©c nÄƒng | Äá»™ Æ°u tiÃªn | Tráº¡ng thÃ¡i |
|----|--------|-----------|------------|------------|
| FR-01 | Auth | ÄÄƒng kÃ½ tÃ i khoáº£n vá»›i email/password | High | âœ… Completed |
| FR-02 | Auth | ÄÄƒng nháº­p vá»›i Google OAuth 2.0 | High | âœ… Completed |
| FR-03 | Auth | Reset password qua email | Medium | âœ… Completed |
| FR-04 | Auth | JWT token authentication | High | âœ… Completed |
| FR-05 | Calendar | Táº¡o/sá»­a/xÃ³a event cÆ¡ báº£n | High | âœ… Completed |
| FR-06 | Calendar | View calendar (day/week/month) | High | âœ… Completed |
| FR-07 | Calendar | Recurring events (RRULE) | High | âœ… Completed |
| FR-08 | Calendar | Drag & drop events | Medium | âœ… Completed |
| FR-09 | Event | Má»i attendees qua email | High | âœ… Completed |
| FR-10 | Event | RSVP invitations | Medium | âœ… Completed |
| FR-11 | Event | Event reminders | Medium | âœ… Completed |
| FR-12 | Google | OAuth connection | High | âœ… Completed |
| FR-13 | Google | Pull events from Google | High | âœ… Completed |
| FR-14 | Google | Push events to Google | High | âœ… Completed |
| FR-15 | Google | Conflict detection & resolution | Medium | âœ… Completed |
| FR-16 | Booking | Create booking links | High | âœ… Completed |
| FR-17 | Booking | Public booking page | High | âœ… Completed |
| FR-18 | Booking | Availability calculation | High | âœ… Completed |
| FR-19 | Booking | Email confirmations | High | âœ… Completed |
| FR-20 | Booking | Cancel/reschedule booking | Medium | âœ… Completed |
| FR-21 | Task | Create/edit/delete tasks | High | âœ… Completed |
| FR-22 | Task | Priority levels (4 levels) | High | âœ… Completed |
| FR-23 | Task | Drag & drop priority board | Medium | âœ… Completed |
| FR-24 | Task | Recurring tasks | Low | âœ… Completed |
| FR-25 | AI | Chat interface | High | âœ… Completed |
| FR-26 | AI | Semantic event search (RAG) | High | âœ… Completed |
| FR-27 | AI | Function calling (create/find) | Medium | âœ… Completed |
| FR-28 | AI | Streaming responses | Medium | âœ… Completed |
| FR-29 | Team | Create/manage team | Medium | âœ… Completed |
| FR-30 | Team | Invite team members | Medium | âœ… Completed |
| FR-31 | Team | Team rituals with rotation | Low | âœ… Completed |
| FR-32 | Team | Team availability view | Low | âœ… Completed |
| FR-33 | Blog | Create/edit blog posts | Medium | âœ… Completed |
| FR-34 | Blog | Categories & tags | Medium | âœ… Completed |
| FR-35 | Blog | Comments moderation | Low | âœ… Completed |
| FR-36 | Blog | SEO optimization | Medium | âœ… Completed |
| FR-37 | Email | Send transactional emails | High | âœ… Completed |
| FR-38 | Email | Email templates (Handlebars) | Medium | âœ… Completed |
| FR-39 | Webhook | Configure webhook URLs | Low | âœ… Completed |
| FR-40 | Analytics | Track user activities | Low | ğŸš§ In Progress |

## **3.2. Kiáº¿n trÃºc há»‡ thá»‘ng**

Há»‡ thá»‘ng Calento Ä‘Æ°á»£c thiáº¿t káº¿ theo mÃ´ hÃ¬nh Micro-modular Monolith, chia tÃ¡ch rÃµ rÃ ng giá»¯a cÃ¡c táº§ng nhÆ°ng váº«n giá»¯ Ä‘Æ°á»£c sá»± thá»‘ng nháº¥t trong triá»ƒn khai.

## **3.1.1. SÆ¡ Ä‘á»“ kiáº¿n trÃºc tá»•ng thá»ƒ**

![][image9]

##### HÃ¬nh 8: Kiáº¿n trÃºc tá»•ng thá»ƒ  {#hÃ¬nh-8:-kiáº¿n-trÃºc-tá»•ng-thá»ƒ}

## **3.2. PhÃ¢n tÃ­ch yÃªu cáº§u vÃ  Use Case**

### **3.2.1. XÃ¡c Ä‘á»‹nh Actors (TÃ¡c nhÃ¢n)**

Há»‡ thá»‘ng Calento phá»¥c vá»¥ cÃ¡c actors sau:

| Actor | MÃ´ táº£ | Quyá»n háº¡n |
|-------|-------|-----------|
| **Guest (KhÃ¡ch)** | NgÆ°á»i dÃ¹ng chÆ°a Ä‘Äƒng kÃ½ | Xem landing page, Ä‘áº·t lá»‹ch qua booking link public, Ä‘á»c blog |
| **Registered User** | NgÆ°á»i dÃ¹ng Ä‘Ã£ Ä‘Äƒng kÃ½ vÃ  Ä‘Äƒng nháº­p | Quáº£n lÃ½ lá»‹ch cÃ¡ nhÃ¢n, sá»± kiá»‡n, tasks, booking links, chat AI |
| **Team Member** | User thuá»™c má»™t team | Xem lá»‹ch team, tham gia team rituals, view team availability |
| **Team Owner** | User táº¡o vÃ  sá»Ÿ há»¯u team | Quáº£n lÃ½ team members, táº¡o team rituals, settings |
| **Admin/Content Manager** | Quáº£n trá»‹ viÃªn há»‡ thá»‘ng | Quáº£n lÃ½ blog posts, categories, user management, analytics |
| **Google Calendar API** | External system | Äá»“ng bá»™ events qua OAuth 2.0 |
| **Gemini AI** | External AI service | Xá»­ lÃ½ chat queries, function calling |

### **3.2.2. SÆ¡ Ä‘á»“ Use Case tá»•ng quan**

```
                              Calento System
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€ Authentication â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚  â€¢ Register                                    â”‚            â”‚
â”‚  â”‚  â€¢ Login (Email/Google OAuth)                  â”‚            â”‚
â”‚  â”‚  â€¢ Reset Password                              â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€ Calendar & Events â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚  â€¢ Create/Edit/Delete Event                     â”‚           â”‚
â”‚  â”‚  â€¢ View Calendar (Day/Week/Month)               â”‚           â”‚
â”‚  â”‚  â€¢ Manage Recurring Events (RRULE)              â”‚           â”‚
â”‚  â”‚  â€¢ Invite Attendees                              â”‚           â”‚
â”‚  â”‚  â€¢ RSVP to Invitations                          â”‚           â”‚
â”‚  â”‚  â€¢ Sync with Google Calendar                    â”‚           â”‚
â”‚  â”‚  â€¢ Resolve Sync Conflicts                       â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€ Booking System â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚  â€¢ Create Booking Link                           â”‚          â”‚
â”‚  â”‚  â€¢ Set Availability Rules                        â”‚          â”‚
â”‚  â”‚  â€¢ Public: Book Appointment                      â”‚          â”‚
â”‚  â”‚  â€¢ Confirm/Cancel Booking                        â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€ Task Management â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚  â€¢ Create/Edit/Delete Task                      â”‚           â”‚
â”‚  â”‚  â€¢ Set Priority (Critical/High/Med/Low)         â”‚           â”‚
â”‚  â”‚  â€¢ Drag & Drop in Priority Board                â”‚           â”‚
â”‚  â”‚  â€¢ Mark Task Complete                            â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€ Team Collaboration â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚  â€¢ Create Team                                   â”‚           â”‚
â”‚  â”‚  â€¢ Invite Team Members                           â”‚           â”‚
â”‚  â”‚  â€¢ Create Team Rituals (Recurring Meetings)     â”‚           â”‚
â”‚  â”‚  â€¢ View Team Availability                        â”‚           â”‚
â”‚  â”‚  â€¢ Manage Rotation Schedule                      â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€ AI Assistant â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚  â€¢ Chat with AI                                  â”‚           â”‚
â”‚  â”‚  â€¢ Search Events (Semantic)                      â”‚           â”‚
â”‚  â”‚  â€¢ Get Schedule Summary                          â”‚           â”‚
â”‚  â”‚  â€¢ Find Free Slots                               â”‚           â”‚
â”‚  â”‚  â€¢ AI Create Event (Function Calling)            â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€ Blog CMS (Admin) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚  â€¢ Create/Edit Blog Post                         â”‚           â”‚
â”‚  â”‚  â€¢ Manage Categories & Tags                      â”‚           â”‚
â”‚  â”‚  â€¢ Publish/Unpublish Posts                       â”‚           â”‚
â”‚  â”‚  â€¢ Moderate Comments                             â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Actor Relationships:
[Guest] â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ Authentication, Public Booking, Blog Read
[Registered User] â”€â”€â”€â”€â†’ All Calendar, Tasks, Booking, AI Features
[Team Member] â”€â”€â”€â”€â”€â”€â”€â”€â†’ Team Collaboration (Read)
[Team Owner] â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ Team Collaboration (Full Control)
[Admin] â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ Blog CMS, User Management
```

### **3.2.3. Äáº·c táº£ Use Case chi tiáº¿t**

#### **UC-01: ÄÄƒng kÃ½ tÃ i khoáº£n (Register)**

| Thuá»™c tÃ­nh | Ná»™i dung |
|------------|----------|
| **Use Case ID** | UC-01 |
| **TÃªn** | ÄÄƒng kÃ½ tÃ i khoáº£n |
| **Actor** | Guest |
| **MÃ´ táº£** | NgÆ°á»i dÃ¹ng táº¡o tÃ i khoáº£n má»›i Ä‘á»ƒ sá»­ dá»¥ng há»‡ thá»‘ng |
| **Tiá»n Ä‘iá»u kiá»‡n** | User chÆ°a cÃ³ tÃ i khoáº£n |
| **Háº­u Ä‘iá»u kiá»‡n** | User Ä‘Æ°á»£c táº¡o trong DB, cÃ³ thá»ƒ Ä‘Äƒng nháº­p |
| **Luá»“ng chÃ­nh** | 1. User truy cáº­p trang /auth/register<br>2. Nháº­p: email, username, password, confirm password<br>3. Há»‡ thá»‘ng validate:<br>   - Email unique & format correct<br>   - Username unique (3-20 kÃ½ tá»±)<br>   - Password >= 8 kÃ½ tá»±, cÃ³ chá»¯ hoa, sá»‘<br>4. Hash password vá»›i bcrypt<br>5. Táº¡o user record (is_verified = false)<br>6. Gá»­i verification email<br>7. Redirect Ä‘áº¿n /dashboard |
| **Luá»“ng thay tháº¿** | **3a. Validation failed:**<br>   - Hiá»ƒn thá»‹ error message cá»¥ thá»ƒ<br>   - User sá»­a vÃ  submit láº¡i<br>**6a. Email gá»­i tháº¥t báº¡i:**<br>   - Log error, user váº«n Ä‘Æ°á»£c táº¡o<br>   - User cÃ³ thá»ƒ resend verification sau |
| **Business Rules** | - Email pháº£i unique trong há»‡ thá»‘ng<br>- Username khÃ´ng chá»©a kÃ½ tá»± Ä‘áº·c biá»‡t<br>- Máº­t kháº©u pháº£i Ä‘á»§ máº¡nh (entropy check) |

#### **UC-02: Äá»“ng bá»™ Google Calendar**

| Thuá»™c tÃ­nh | Ná»™i dung |
|------------|----------|
| **Use Case ID** | UC-02 |
| **TÃªn** | Äá»“ng bá»™ hai chiá»u vá»›i Google Calendar |
| **Actor** | Registered User, Google Calendar API |
| **MÃ´ táº£** | Tá»± Ä‘á»™ng pull events tá»« Google vÃ  push local events lÃªn Google |
| **Tiá»n Ä‘iá»u kiá»‡n** | User Ä‘Ã£ káº¿t ná»‘i Google account (OAuth) |
| **Háº­u Ä‘iá»u kiá»‡n** | Events Ä‘Æ°á»£c Ä‘á»“ng bá»™ giá»¯a Calento vÃ  Google Calendar |
| **Luá»“ng chÃ­nh** | **PULL (Google â†’ Calento):**<br>1. Background job cháº¡y má»—i 5 phÃºt<br>2. Láº¥y access_token tá»« user_credentials<br>3. Gá»i Google Calendar API: events.list()<br>4. So sÃ¡nh vá»›i DB:<br>   - Dá»±a vÃ o google_event_id, updated timestamp<br>5. PhÃ¡t hiá»‡n changes:<br>   - New: Insert vÃ o events table<br>   - Updated: Update existing event<br>   - Deleted: Soft delete hoáº·c mark cancelled<br>6. Detect conflicts (same time, different data)<br>7. LÆ°u conflicts vÃ o event_conflicts table<br><br>**PUSH (Calento â†’ Google):**<br>8. TÃ¬m events cÃ³ google_event_id = NULL<br>9. Gá»i Google Calendar API: events.insert()<br>10. LÆ°u google_event_id vÃ o DB |
| **Luá»“ng thay tháº¿** | **3a. Token expired:**<br>   - Refresh token tá»± Ä‘á»™ng<br>   - Retry request<br>**3b. API rate limit:**<br>   - Exponential backoff<br>   - Retry sau 1-5-10 phÃºt<br>**6a. Conflict detected:**<br>   - User nháº­n notification<br>   - User chá»n resolution strategy |
| **Business Rules** | - Events recurring: Expand instances trÆ°á»›c khi so sÃ¡nh<br>- Chá»‰ sync calendars cÃ³ sync_enabled = true<br>- Conflict priority: Manual user input > Auto sync |

#### **UC-03: Táº¡o Booking Link**

| Thuá»™c tÃ­nh | Ná»™i dung |
|------------|----------|
| **Use Case ID** | UC-03 |
| **TÃªn** | Táº¡o trang Ä‘áº·t lá»‹ch cÃ´ng khai |
| **Actor** | Registered User |
| **MÃ´ táº£** | User táº¡o booking link Ä‘á»ƒ ngÆ°á»i khÃ¡c Ä‘áº·t lá»‹ch vá»›i mÃ¬nh |
| **Tiá»n Ä‘iá»u kiá»‡n** | User Ä‘Ã£ Ä‘Äƒng nháº­p, Ä‘Ã£ set availability |
| **Háº­u Ä‘iá»u kiá»‡n** | Booking link Ä‘Æ°á»£c táº¡o, public URL cÃ³ thá»ƒ share |
| **Luá»“ng chÃ­nh** | 1. User vÃ o /dashboard/booking<br>2. Click "New Booking Link"<br>3. Nháº­p thÃ´ng tin:<br>   - Title (VD: "30min Meeting")<br>   - Slug (unique, VD: "meeting-30min")<br>   - Duration (minutes)<br>   - Buffer time (trÆ°á»›c/sau)<br>   - Advance notice (hours)<br>   - Max bookings per day<br>   - Location (optional)<br>4. Validate:<br>   - Slug chÆ°a tá»“n táº¡i cho user nÃ y<br>   - Duration > 0<br>5. Táº¡o booking_link record<br>6. Generate public URL: calento.space/book/username/slug<br>7. Hiá»ƒn thá»‹ preview vÃ  share options |
| **Luá»“ng thay tháº¿** | **4a. Slug Ä‘Ã£ tá»“n táº¡i:**<br>   - Suggest alternative (append sá»‘)<br>**4b. User chÆ°a set availability:**<br>   - Prompt user set availability trÆ°á»›c |
| **Business Rules** | - 1 user cÃ³ thá»ƒ táº¡o nhiá»u booking links<br>- Slug unique per user (khÃ´ng global)<br>- Buffer time khÃ´ng tÃ­nh vÃ o duration |

#### **UC-04: Äáº·t lá»‹ch qua Booking Link (Public)**

| Thuá»™c tÃ­nh | Ná»™i dung |
|------------|----------|
| **Use Case ID** | UC-04 |
| **TÃªn** | Guest Ä‘áº·t lá»‹ch háº¹n |
| **Actor** | Guest |
| **MÃ´ táº£** | NgÆ°á»i ngoÃ i Ä‘áº·t lá»‹ch vá»›i user qua public booking link |
| **Tiá»n Ä‘iá»u kiá»‡n** | Booking link active, user Ä‘Ã£ set availability |
| **Háº­u Ä‘iá»u kiá»‡n** | Booking created, event created, emails sent |
| **Luá»“ng chÃ­nh** | 1. Guest truy cáº­p: /book/username/slug<br>2. Há»‡ thá»‘ng load booking link config<br>3. Query availability cá»§a user:<br>   - Láº¥y availabilities (weekly schedule)<br>   - Láº¥y existing events<br>   - Calculate available slots (next 60 days)<br>4. Hiá»ƒn thá»‹ calendar vá»›i slots mÃ u xanh<br>5. Guest chá»n slot<br>6. Popup form: Name, Email, Phone, Notes<br>7. Guest submit<br>8. Validate:<br>   - Slot váº«n available (double-check)<br>   - Email format correct<br>   - KhÃ´ng vÆ°á»£t max_bookings/day<br>9. Transaction:<br>   - Táº¡o booking record<br>   - Táº¡o event cho user<br>   - Link booking.event_id = event.id<br>10. Send emails:<br>    - Confirmation to guest<br>    - Notification to host<br>11. [Optional] Push event to Google Calendar |
| **Luá»“ng thay tháº¿** | **8a. Slot Ä‘Ã£ bá»‹ book:**<br>   - Show error "ÄÃ£ cÃ³ ngÆ°á»i Ä‘áº·t"<br>   - Refresh calendar<br>**8b. VÆ°á»£t max bookings:**<br>   - "ÄÃ£ háº¿t slot cho ngÃ y nÃ y"<br>**10a. Email failed:**<br>   - Log error, queue retry<br>   - Booking váº«n Ä‘Æ°á»£c táº¡o |
| **Business Rules** | - Check advance_notice: KhÃ´ng cho book slot < X giá»<br>- Apply buffer_time khi tÃ­nh slots<br>- Timezone: Hiá»ƒn thá»‹ theo timezone cá»§a guest (auto-detect) |

#### **UC-05: Chat vá»›i AI Assistant (RAG)**

| Thuá»™c tÃ­nh | Ná»™i dung |
|------------|----------|
| **Use Case ID** | UC-05 |
| **TÃªn** | TÆ°Æ¡ng tÃ¡c vá»›i AI Assistant |
| **Actor** | Registered User, Gemini AI |
| **MÃ´ táº£** | User chat vá»›i AI Ä‘á»ƒ query lá»‹ch, táº¡o event, tÃ¬m slot ráº£nh |
| **Tiá»n Ä‘iá»u kiá»‡n** | User Ä‘Ã£ Ä‘Äƒng nháº­p |
| **Háº­u Ä‘iá»u kiá»‡n** | User nháº­n response tá»« AI, action Ä‘Æ°á»£c thá»±c thi (náº¿u cÃ³) |
| **Luá»“ng chÃ­nh** | 1. User má»Ÿ AI chat panel<br>2. Nháº­p cÃ¢u há»i (VD: "TÃ´i cÃ³ báº­n vÃ o thá»© 5?")<br>3. Frontend gá»­i POST /api/v1/ai/chat<br>4. Backend - RAG Service:<br>   - Generate embedding cho cÃ¢u há»i (768-dim vector)<br>   - Vector search trong events table (pgvector)<br>   - Láº¥y top 5 relevant events (cosine similarity > 0.7)<br>5. Backend - LLM Service:<br>   - Construct prompt:<br>     * System: "Báº¡n lÃ  AI assistant..."<br>     * Context: JSON cá»§a 5 events<br>     * User question<br>   - Gá»i Gemini API (streaming)<br>   - Parse response<br>6. [Optional] Function Calling:<br>   - AI return function: createEvent / findSlots<br>   - Execute function<br>   - Return result to AI<br>7. Stream response qua SSE vá» frontend<br>8. Frontend render markdown real-time |
| **Luá»“ng thay tháº¿** | **4a. KhÃ´ng tÃ¬m tháº¥y relevant events:**<br>   - Context = empty<br>   - AI answer dá»±a vÃ o general knowledge<br>**5a. Gemini API error:**<br>   - Fallback: "Xin lá»—i, AI táº¡m thá»i khÃ´ng kháº£ dá»¥ng"<br>**6a. Function execution failed:**<br>   - Return error to AI<br>   - AI explain lá»—i cho user |
| **Business Rules** | - Chá»‰ search events cá»§a chÃ­nh user (privacy)<br>- Vector search timeout: 3s max<br>- Function calling: Pháº£i confirm vá»›i user trÆ°á»›c khi execute |

### **3.2.4. Ma tráº­n Actor - Use Case**

| Use Case | Guest | Registered User | Team Member | Team Owner | Admin |
|----------|-------|----------------|-------------|-----------|-------|
| UC-01: Register | âœ“ | - | - | - | - |
| UC-02: Google Sync | - | âœ“ | âœ“ | âœ“ | - |
| UC-03: Create Booking Link | - | âœ“ | âœ“ | âœ“ | - |
| UC-04: Book Appointment | âœ“ | âœ“ | - | - | - |
| UC-05: AI Chat | - | âœ“ | âœ“ | âœ“ | - |
| UC-06: Create Event | - | âœ“ | âœ“ | âœ“ | - |
| UC-07: Manage Tasks | - | âœ“ | âœ“ | âœ“ | - |
| UC-08: Create Team | - | âœ“ | - | âœ“ | - |
| UC-09: Invite Team Member | - | - | - | âœ“ | - |
| UC-10: View Team Calendar | - | - | âœ“ | âœ“ | - |
| UC-11: Create Blog Post | - | - | - | - | âœ“ |
| UC-12: Moderate Comments | - | - | - | - | âœ“ |
| UC-13: View Analytics | - | - | - | - | âœ“ |

### **3.2.5. YÃªu cáº§u phi chá»©c nÄƒng (Non-functional Requirements)**

BÃªn cáº¡nh cÃ¡c yÃªu cáº§u chá»©c nÄƒng Ä‘Æ°á»£c mÃ´ táº£ trong Use Case, há»‡ thá»‘ng Calento cáº§n Ä‘Ã¡p á»©ng cÃ¡c yÃªu cáº§u phi chá»©c nÄƒng quan trá»ng vá» hiá»‡u nÄƒng, báº£o máº­t, kháº£ nÄƒng má»Ÿ rá»™ng, Ä‘á»™ sáºµn sÃ ng vÃ  tÃ­nh kháº£ dá»¥ng.

#### **3.2.5.1. YÃªu cáº§u vá» Hiá»‡u nÄƒng (Performance Requirements)**

Há»‡ thá»‘ng Ä‘Æ°á»£c thiáº¿t káº¿ Ä‘á»ƒ Ä‘áº£m báº£o tráº£i nghiá»‡m ngÆ°á»i dÃ¹ng mÆ°á»£t mÃ  vá»›i thá»i gian pháº£n há»“i nhanh chÃ³ng. Äá»‘i vá»›i cÃ¡c API endpoint, thá»i gian pháº£n há»“i trung bÃ¬nh pháº£i Ä‘áº¡t dÆ°á»›i 200 milliseconds á»Ÿ percentile thá»© 95, Ä‘áº£m báº£o ráº±ng 95% cÃ¡c request Ä‘Æ°á»£c xá»­ lÃ½ trong khoáº£ng thá»i gian nÃ y. Äiá»u nÃ y Ä‘áº¡t Ä‘Æ°á»£c thÃ´ng qua viá»‡c tá»‘i Æ°u hÃ³a cÃ¡c cÃ¢u truy váº¥n database vá»›i indexes phÃ¹ há»£p, sá»­ dá»¥ng connection pooling, vÃ  Ã¡p dá»¥ng chiáº¿n lÆ°á»£c caching thÃ´ng minh.

Vá» máº·t giao diá»‡n ngÆ°á»i dÃ¹ng, trang web cáº§n Ä‘áº¡t chá»‰ sá»‘ First Contentful Paint (FCP) dÆ°á»›i 2 giÃ¢y, lÃ  thá»i Ä‘iá»ƒm ná»™i dung Ä‘áº§u tiÃªn Ä‘Æ°á»£c render trÃªn mÃ n hÃ¬nh. Äiá»u nÃ y Ä‘áº£m báº£o ngÆ°á»i dÃ¹ng cÃ³ pháº£n há»“i trá»±c quan nhanh chÃ³ng khi truy cáº­p á»©ng dá»¥ng. Äá»ƒ Ä‘áº¡t Ä‘Æ°á»£c má»¥c tiÃªu nÃ y, há»‡ thá»‘ng sá»­ dá»¥ng Server-Side Rendering (SSR) cá»§a Next.js, tá»‘i Æ°u hÃ³a bundle size báº±ng code splitting, vÃ  lazy loading cho cÃ¡c component khÃ´ng quan trá»ng.

Há»‡ thá»‘ng Ä‘Æ°á»£c thiáº¿t káº¿ Ä‘á»ƒ há»— trá»£ Ä‘á»“ng thá»i hÆ¡n 1000 ngÆ°á»i dÃ¹ng hoáº¡t Ä‘á»™ng cÃ¹ng lÃºc mÃ  khÃ´ng suy giáº£m hiá»‡u nÄƒng Ä‘Ã¡ng ká»ƒ. Kháº£ nÄƒng nÃ y Ä‘Æ°á»£c Ä‘áº£m báº£o thÃ´ng qua kiáº¿n trÃºc stateless backend, cho phÃ©p scale horizontal báº±ng cÃ¡ch thÃªm server instances khi cáº§n thiáº¿t. Äá»‘i vá»›i cÃ¡c truy váº¥n database phá»©c táº¡p trÃªn táº­p dá»¯ liá»‡u lá»›n (100,000 events), thá»i gian thá»±c thi trung bÃ¬nh pháº£i dÆ°á»›i 50 milliseconds nhá» vÃ o viá»‡c thiáº¿t káº¿ indexes tá»‘i Æ°u vÃ  sá»­ dá»¥ng covering indexes khi cÃ³ thá»ƒ.

#### **3.2.5.2. YÃªu cáº§u vá» Báº£o máº­t (Security Requirements)**

Báº£o máº­t lÃ  má»™t trong nhá»¯ng Æ°u tiÃªn hÃ ng Ä‘áº§u cá»§a há»‡ thá»‘ng. Vá» máº·t xÃ¡c thá»±c (Authentication), há»‡ thá»‘ng triá»ƒn khai cÆ¡ cháº¿ JSON Web Token (JWT) vá»›i hai loáº¡i token: Access Token cÃ³ thá»i háº¡n ngáº¯n (1 giá») vÃ  Refresh Token cÃ³ thá»i háº¡n dÃ i hÆ¡n (7 ngÃ y). CÆ¡ cháº¿ nÃ y cho phÃ©p cÃ¢n báº±ng giá»¯a báº£o máº­t vÃ  tráº£i nghiá»‡m ngÆ°á»i dÃ¹ng, giáº£m thiá»ƒu rá»§i ro khi Access Token bá»‹ lá»™ Ä‘á»“ng thá»i trÃ¡nh yÃªu cáº§u ngÆ°á»i dÃ¹ng Ä‘Äƒng nháº­p láº¡i thÆ°á»ng xuyÃªn.

Máº­t kháº©u ngÆ°á»i dÃ¹ng Ä‘Æ°á»£c báº£o vá»‡ báº±ng thuáº­t toÃ¡n bcrypt vá»›i cost factor lÃ  10 (tÆ°Æ¡ng Ä‘Æ°Æ¡ng 2^10 rounds), Ä‘áº£m báº£o kháº£ nÄƒng chá»‘ng láº¡i cÃ¡c cuá»™c táº¥n cÃ´ng brute-force vÃ  rainbow table. Má»—i máº­t kháº©u Ä‘Æ°á»£c hash vá»›i má»™t salt ngáº«u nhiÃªn duy nháº¥t, Ä‘áº£m báº£o ráº±ng ngay cáº£ khi hai ngÆ°á»i dÃ¹ng cÃ³ cÃ¹ng máº­t kháº©u, giÃ¡ trá»‹ hash lÆ°u trong database sáº½ hoÃ n toÃ n khÃ¡c nhau.

Äá»ƒ báº£o vá»‡ há»‡ thá»‘ng khá»i cÃ¡c cuá»™c táº¥n cÃ´ng tá»« chá»‘i dá»‹ch vá»¥ (DoS), API gateway triá»ƒn khai cÆ¡ cháº¿ rate limiting vá»›i ngÆ°á»¡ng 100 requests má»—i phÃºt cho má»—i Ä‘á»‹a chá»‰ IP. CÃ¡c request vÆ°á»£t quÃ¡ ngÆ°á»¡ng nÃ y sáº½ nháº­n vá» HTTP status code 429 (Too Many Requests) vÃ  pháº£i chá» trÆ°á»›c khi thá»­ láº¡i. Äá»‘i vá»›i cÃ¡c endpoint nháº¡y cáº£m nhÆ° Ä‘Äƒng nháº­p vÃ  Ä‘Äƒng kÃ½, ngÆ°á»¡ng nÃ y cÃ²n Ä‘Æ°á»£c giáº£m xuá»‘ng Ä‘á»ƒ tÄƒng cÆ°á»ng báº£o máº­t.

ToÃ n bá»™ giao tiáº¿p giá»¯a client vÃ  server Ä‘Æ°á»£c mÃ£ hÃ³a báº±ng giao thá»©c HTTPS vá»›i TLS phiÃªn báº£n 1.3, phiÃªn báº£n má»›i nháº¥t vÃ  an toÃ n nháº¥t cá»§a giao thá»©c báº£o máº­t táº§ng váº­n chuyá»ƒn. Äiá»u nÃ y Ä‘áº£m báº£o dá»¯ liá»‡u truyá»n táº£i khÃ´ng thá»ƒ bá»‹ nghe lÃ©n hoáº·c can thiá»‡p trong quÃ¡ trÃ¬nh truyá»n qua máº¡ng Internet. Vá» validation dá»¯ liá»‡u Ä‘áº§u vÃ o, há»‡ thá»‘ng sá»­ dá»¥ng Zod schemas Ä‘á»ƒ Ä‘á»‹nh nghÄ©a vÃ  kiá»ƒm tra táº¥t cáº£ input tá»« client, ngÄƒn cháº·n cÃ¡c lá»— há»•ng nhÆ° SQL Injection, XSS (Cross-Site Scripting), vÃ  cÃ¡c dáº¡ng táº¥n cÃ´ng injection khÃ¡c ngay tá»« táº§ng validation.

#### **3.2.5.3. YÃªu cáº§u vá» Kháº£ nÄƒng Má»Ÿ rá»™ng (Scalability Requirements)**

Kiáº¿n trÃºc há»‡ thá»‘ng Ä‘Æ°á»£c thiáº¿t káº¿ vá»›i kháº£ nÄƒng má»Ÿ rá»™ng theo chiá»u ngang (horizontal scaling) lÃ m trá»ng tÃ¢m. Backend Ä‘Æ°á»£c xÃ¢y dá»±ng theo mÃ´ hÃ¬nh stateless, nghÄ©a lÃ  khÃ´ng lÆ°u trá»¯ session state trÃªn server instances. Thay vÃ o Ä‘Ã³, táº¥t cáº£ session data Ä‘Æ°á»£c lÆ°u trá»¯ táº­p trung trong Redis cluster, cho phÃ©p báº¥t ká»³ server instance nÃ o cÅ©ng cÃ³ thá»ƒ xá»­ lÃ½ request tá»« báº¥t ká»³ client nÃ o. Äiá»u nÃ y táº¡o Ä‘iá»u kiá»‡n thuáº­n lá»£i Ä‘á»ƒ thÃªm hoáº·c bá»›t server instances dá»±a trÃªn táº£i há»‡ thá»‘ng mÃ  khÃ´ng áº£nh hÆ°á»Ÿng Ä‘áº¿n tráº£i nghiá»‡m ngÆ°á»i dÃ¹ng.

Äá»‘i vá»›i táº§ng cÆ¡ sá»Ÿ dá»¯ liá»‡u, chiáº¿n lÆ°á»£c master-slave replication Ä‘Æ°á»£c triá»ƒn khai vá»›i má»™t primary database xá»­ lÃ½ cÃ¡c thao tÃ¡c ghi (write operations) vÃ  nhiá»u read replicas xá»­ lÃ½ cÃ¡c truy váº¥n Ä‘á»c (read operations). Kiáº¿n trÃºc nÃ y Ä‘áº·c biá»‡t hiá»‡u quáº£ cho workload cá»§a á»©ng dá»¥ng lá»‹ch, nÆ¡i mÃ  tá»· lá»‡ Ä‘á»c/ghi thÆ°á»ng lÃ  80/20 hoáº·c cao hÆ¡n. CÃ¡c read replicas Ä‘Æ°á»£c phÃ¢n phá»‘i Ä‘á»‹a lÃ½ Ä‘á»ƒ giáº£m Ä‘á»™ trá»… cho ngÆ°á»i dÃ¹ng á»Ÿ cÃ¡c khu vá»±c khÃ¡c nhau.

Há»‡ thá»‘ng caching Ä‘Æ°á»£c thiáº¿t káº¿ theo mÃ´ hÃ¬nh nhiá»u táº§ng (tiered caching) vá»›i Redis lÃ m primary cache layer. CÃ¡c dá»¯ liá»‡u Ä‘Æ°á»£c truy váº¥n thÆ°á»ng xuyÃªn (hot data) nhÆ° thÃ´ng tin user profile, availability rules, vÃ  events trong tuáº§n hiá»‡n táº¡i Ä‘Æ°á»£c cache vá»›i Time-To-Live (TTL) tá»« 5 Ä‘áº¿n 15 phÃºt tÃ¹y thuá»™c vÃ o tÃ­nh cháº¥t dá»¯ liá»‡u. Chiáº¿n lÆ°á»£c cache invalidation Ä‘Æ°á»£c triá»ƒn khai cáº©n tháº­n Ä‘á»ƒ Ä‘áº£m báº£o tÃ­nh nháº¥t quÃ¡n dá»¯ liá»‡u (data consistency) trong khi váº«n tá»‘i Ä‘a hÃ³a cache hit rate.

#### **3.2.5.4. YÃªu cáº§u vá» Äá»™ Sáºµn sÃ ng (Availability Requirements)**

Há»‡ thá»‘ng cam káº¿t Ä‘áº¡t má»©c Ä‘á»™ sáºµn sÃ ng (uptime) 99.5%, tÆ°Æ¡ng Ä‘Æ°Æ¡ng vá»›i khoáº£ng 43.8 giá» downtime tá»‘i Ä‘a má»—i nÄƒm. Má»©c SLA (Service Level Agreement) nÃ y Ä‘Æ°á»£c tÃ­nh toÃ¡n dá»±a trÃªn nhu cáº§u thá»±c táº¿ cá»§a ngÆ°á»i dÃ¹ng vÃ  cÃ¢n nháº¯c giá»¯a chi phÃ­ váº­n hÃ nh vá»›i yÃªu cáº§u vá» Ä‘á»™ tin cáº­y. Äá»ƒ Ä‘áº¡t Ä‘Æ°á»£c má»¥c tiÃªu nÃ y, há»‡ thá»‘ng triá»ƒn khai nhiá»u biá»‡n phÃ¡p nhÆ° health check tá»± Ä‘á»™ng, automatic failover, vÃ  monitoring 24/7.

Chiáº¿n lÆ°á»£c backup Ä‘Æ°á»£c thiáº¿t káº¿ theo mÃ´ hÃ¬nh 3-2-1: duy trÃ¬ 3 báº£n sao dá»¯ liá»‡u, trÃªn 2 loáº¡i phÆ°Æ¡ng tiá»‡n lÆ°u trá»¯ khÃ¡c nhau, vá»›i 1 báº£n Ä‘Æ°á»£c lÆ°u trá»¯ off-site. PostgreSQL database Ä‘Æ°á»£c backup tá»± Ä‘á»™ng hÃ ng ngÃ y báº±ng pg_dump vá»›i full backup. CÃ¡c incremental backups Ä‘Æ°á»£c thá»±c hiá»‡n má»—i 6 giá» Ä‘á»ƒ giáº£m thiá»ƒu dá»¯ liá»‡u máº¥t mÃ¡t trong trÆ°á»ng há»£p tháº£m há»a. Táº¥t cáº£ backup files Ä‘Æ°á»£c mÃ£ hÃ³a vÃ  lÆ°u trá»¯ trÃªn cloud storage vá»›i versioning enabled.

Recovery Time Objective (RTO), chá»‰ sá»‘ thá»i gian tá»‘i Ä‘a Ä‘á»ƒ khÃ´i phá»¥c há»‡ thá»‘ng sau sá»± cá»‘, Ä‘Æ°á»£c Ä‘áº·t á»Ÿ má»©c dÆ°á»›i 4 giá». Äiá»u nÃ y cÃ³ nghÄ©a lÃ  trong trÆ°á»ng há»£p xáº¥u nháº¥t, há»‡ thá»‘ng sáº½ Ä‘Æ°á»£c Ä‘Æ°a trá»Ÿ láº¡i hoáº¡t Ä‘á»™ng trong vÃ²ng 4 giá» ká»ƒ tá»« khi phÃ¡t hiá»‡n sá»± cá»‘. Recovery Point Objective (RPO), chá»‰ sá»‘ lÆ°á»£ng dá»¯ liá»‡u tá»‘i Ä‘a cÃ³ thá»ƒ máº¥t mÃ¡t, Ä‘Æ°á»£c thiáº¿t láº­p á»Ÿ má»©c 6 giá», tÆ°Æ¡ng á»©ng vá»›i khoáº£ng cÃ¡ch giá»¯a cÃ¡c incremental backups.

#### **3.2.5.5. YÃªu cáº§u vá» TÃ­nh Kháº£ dá»¥ng (Usability Requirements)**

Giao diá»‡n ngÆ°á»i dÃ¹ng Ä‘Æ°á»£c thiáº¿t káº¿ theo nguyÃªn táº¯c Responsive Web Design, Ä‘áº£m báº£o hoáº¡t Ä‘á»™ng mÆ°á»£t mÃ  trÃªn má»i kÃ­ch thÆ°á»›c mÃ n hÃ¬nh tá»« Ä‘iá»‡n thoáº¡i di Ä‘á»™ng (viewport tá»‘i thiá»ƒu 320px) Ä‘áº¿n mÃ n hÃ¬nh desktop lá»›n (4K resolution). Há»‡ thá»‘ng há»— trá»£ Ä‘áº§y Ä‘á»§ cÃ¡c trÃ¬nh duyá»‡t phá»• biáº¿n trÃªn iOS (Safari) vÃ  Android (Chrome, Samsung Internet) vá»›i cÃ¹ng má»™t codebase, táº­n dá»¥ng cÃ¡c CSS features hiá»‡n Ä‘áº¡i nhÆ° Flexbox, Grid, vÃ  CSS Custom Properties.

Vá» kháº£ nÄƒng tiáº¿p cáº­n (Accessibility), á»©ng dá»¥ng tuÃ¢n thá»§ WCAG 2.1 Level AA, bá»™ tiÃªu chuáº©n quá»‘c táº¿ vá» kháº£ nÄƒng tiáº¿p cáº­n web. Äiá»u nÃ y bao gá»“m cÃ¡c yÃªu cáº§u nhÆ° tá»· lá»‡ tÆ°Æ¡ng pháº£n mÃ u sáº¯c tá»‘i thiá»ƒu 4.5:1 cho vÄƒn báº£n thÆ°á»ng vÃ  3:1 cho vÄƒn báº£n lá»›n, há»— trá»£ Ä‘iá»u hÆ°á»›ng báº±ng bÃ n phÃ­m hoÃ n toÃ n, semantic HTML cho screen readers, vÃ  ARIA attributes phÃ¹ há»£p. CÃ¡c form inputs Ä‘á»u cÃ³ labels rÃµ rÃ ng, error messages mÃ´ táº£ cá»¥ thá»ƒ, vÃ  focus indicators dá»… nháº­n biáº¿t.

Há»‡ thá»‘ng Ä‘Æ°á»£c xÃ¢y dá»±ng vá»›i kháº£ nÄƒng quá»‘c táº¿ hÃ³a (Internationalization - i18n) ngay tá»« Ä‘áº§u, hiá»‡n táº¡i há»— trá»£ hai ngÃ´n ngá»¯ chÃ­nh lÃ  Tiáº¿ng Viá»‡t vÃ  Tiáº¿ng Anh. Kiáº¿n trÃºc i18n cho phÃ©p dá»… dÃ ng thÃªm cÃ¡c ngÃ´n ngá»¯ má»›i trong tÆ°Æ¡ng lai mÃ  khÃ´ng cáº§n refactor code. Táº¥t cáº£ cÃ¡c vÄƒn báº£n hiá»ƒn thá»‹ Ä‘Æ°á»£c quáº£n lÃ½ thÃ´ng qua translation keys, format ngÃ y thÃ¡ng vÃ  sá»‘ tá»± Ä‘á»™ng Ä‘iá»u chá»‰nh theo locale cá»§a ngÆ°á»i dÃ¹ng, vÃ  timezone Ä‘Æ°á»£c xá»­ lÃ½ chÃ­nh xÃ¡c cho tá»«ng khu vá»±c Ä‘á»‹a lÃ½.

## **3.3. MÃ´ táº£ cÃ¡c thÃ nh pháº§n trong há»‡ thá»‘ng**

Há»‡ thá»‘ng Calento Ä‘Æ°á»£c xÃ¢y dá»±ng theo kiáº¿n trÃºc micro-modular monolith, trong Ä‘Ã³ cÃ¡c modules Ä‘Æ°á»£c tá»• chá»©c thÃ nh cÃ¡c nhÃ³m chá»©c nÄƒng rÃµ rÃ ng. Má»—i module Ä‘áº£m nhiá»‡m má»™t domain nghiá»‡p vá»¥ cá»¥ thá»ƒ, cÃ³ boundaries Ä‘Æ°á»£c Ä‘á»‹nh nghÄ©a rÃµ rÃ ng, vÃ  giao tiáº¿p vá»›i nhau thÃ´ng qua well-defined interfaces. CÃ¡ch tiáº¿p cáº­n nÃ y mang láº¡i lá»£i Ã­ch cá»§a microservices (modularity, separation of concerns) nhÆ°ng váº«n giá»¯ Ä‘Æ°á»£c sá»± Ä‘Æ¡n giáº£n cá»§a monolithic deployment.

### **3.3.1. Core Modules - NhÃ³m Module Ná»n táº£ng**

NhÃ³m Core Modules bao gá»“m cÃ¡c module cÆ¡ báº£n nháº¥t cá»§a há»‡ thá»‘ng, cung cáº¥p cÃ¡c chá»©c nÄƒng thiáº¿t yáº¿u mÃ  háº§u háº¿t cÃ¡c modules khÃ¡c Ä‘á»u phá»¥ thuá»™c vÃ o. ÄÃ¢y lÃ  foundation layer cá»§a toÃ n bá»™ application architecture.

#### **33.1.1. Auth Module (Authentication & Authorization)**

Auth Module lÃ  gatekeeper cá»§a toÃ n bá»™ há»‡ thá»‘ng, Ä‘áº£m nhiá»‡m viá»‡c xÃ¡c thá»±c danh tÃ­nh ngÆ°á»i dÃ¹ng vÃ  quáº£n lÃ½ quyá»n truy cáº­p. Module nÃ y Ä‘Æ°á»£c thiáº¿t káº¿ vá»›i nhiá»u lá»›p báº£o máº­t (defense in depth) Ä‘á»ƒ Ä‘áº£m báº£o chá»‰ nhá»¯ng ngÆ°á»i dÃ¹ng há»£p lá»‡ má»›i cÃ³ thá»ƒ truy cáº­p vÃ o há»‡ thá»‘ng vÃ  cÃ¡c tÃ i nguyÃªn cá»§a há».

**Registration Flow (ÄÄƒng kÃ½ tÃ i khoáº£n):**

Quy trÃ¬nh Ä‘Äƒng kÃ½ Ä‘Æ°á»£c thiáº¿t káº¿ Ä‘á»ƒ cÃ¢n báº±ng giá»¯a báº£o máº­t vÃ  tráº£i nghiá»‡m ngÆ°á»i dÃ¹ng. Khi ngÆ°á»i dÃ¹ng má»›i truy cáº­p trang Ä‘Äƒng kÃ½, há» cáº§n cung cáº¥p ba thÃ´ng tin cÆ¡ báº£n: Ä‘á»‹a chá»‰ email (sáº½ dÃ¹ng lÃ m primary identifier), username (hiá»ƒn thá»‹ tÃªn trong UI), vÃ  password. Há»‡ thá»‘ng thá»±c hiá»‡n validation nghiÃªm ngáº·t trÃªn cáº£ client-side vÃ  server-side: email pháº£i theo Ä‘Ãºng format RFC 5322 vÃ  unique trong database; username pháº£i cÃ³ Ä‘á»™ dÃ i tá»« 3-20 kÃ½ tá»±, chá»‰ chá»©a alphanumeric vÃ  underscores; password pháº£i Ä‘áº¡t Ä‘á»™ máº¡nh tá»‘i thiá»ƒu - Ã­t nháº¥t 8 kÃ½ tá»±, bao gá»“m chá»¯ hoa, chá»¯ thÆ°á»ng, sá»‘, vÃ  kÃ½ tá»± Ä‘áº·c biá»‡t.

Sau khi validation thÃ nh cÃ´ng, password khÃ´ng Ä‘Æ°á»£c lÆ°u trá»±c tiáº¿p mÃ  pháº£i hash báº±ng bcrypt algorithm vá»›i cost factor 10 (tÆ°Æ¡ng Ä‘Æ°Æ¡ng 2^10 = 1024 rounds). Bcrypt Ä‘Æ°á»£c chá»n vÃ¬ tÃ­nh resistance cao vá»›i brute-force attacks nhá» slow hashing nature vÃ  built-in salting. Má»—i password Ä‘Æ°á»£c hash vá»›i má»™t salt ngáº«u nhiÃªn unique, Ä‘áº£m báº£o ngay cáº£ khi hai users cÃ³ cÃ¹ng password, hash values hoÃ n toÃ n khÃ¡c nhau.

User record Ä‘Æ°á»£c táº¡o vá»›i tráº¡ng thÃ¡i `is_verified = false` vÃ  há»‡ thá»‘ng gá»­i verification email chá»©a unique token. User cáº§n click vÃ o link trong email Ä‘á»ƒ verify account. Token Ä‘Æ°á»£c generate báº±ng cryptographically secure random generator vÃ  cÃ³ thá»i háº¡n 24 giá». CÆ¡ cháº¿ nÃ y prevent spam registrations vÃ  Ä‘áº£m báº£o email address belongs to ngÆ°á»i Ä‘Äƒng kÃ½.

**Login Flow vá»›i JWT:**

Há»‡ thá»‘ng há»— trá»£ hai phÆ°Æ¡ng thá»©c Ä‘Äƒng nháº­p: traditional email/password vÃ  Google OAuth 2.0. Äá»‘i vá»›i email/password login, user nháº­p credentials, server verify báº±ng cÃ¡ch hash input password vá»›i same salt vÃ  compare vá»›i stored hash. Náº¿u match, server generates hai JWT tokens: Access Token (short-lived, 1 giá») vÃ  Refresh Token (long-lived, 7 ngÃ y).

Access Token chá»©a user claims nhÆ° `userId`, `email`, `role` vÃ  Ä‘Æ°á»£c sign báº±ng secret key. Token nÃ y Ä‘Æ°á»£c attach vÃ o má»i API requests qua Authorization header (`Bearer <token>`). Khi token expires, client dÃ¹ng Refresh Token Ä‘á»ƒ request Access Token má»›i mÃ  khÃ´ng cáº§n user login láº¡i. Refresh Token Ä‘Æ°á»£c store trong httpOnly cookie Ä‘á»ƒ prevent XSS attacks.

**Google OAuth Integration:**

Calento tÃ­ch há»£p Google OAuth 2.0 Ä‘á»ƒ cho phÃ©p "Sign in with Google" - má»™t tÃ­nh nÄƒng crucial vÃ¬ Ä‘Ã¢y lÃ  calendar app sync vá»›i Google Calendar. OAuth flow báº¯t Ä‘áº§u khi user click "Continue with Google", Ä‘Æ°á»£c redirect Ä‘áº¿n Google consent screen. Sau khi user authorize, Google redirect vá» Calento callback URL vá»›i authorization code.

Backend exchange code nÃ y vá»›i Access Token vÃ  Refresh Token tá»« Google, cÃ¹ng vá»›i user profile info (email, name, avatar). Náº¿u email Ä‘Ã£ tá»“n táº¡i trong database, system perform login. Náº¿u chÆ°a, tá»± Ä‘á»™ng create account má»›i vá»›i info tá»« Google profile. OAuth tokens Ä‘Æ°á»£c lÆ°u vÃ o `user_credentials` table, sáº½ Ä‘Æ°á»£c dÃ¹ng sau nÃ y cho Google Calendar sync.

```mermaid
flowchart TB
    A[User Access] --> B{Has Account?}
    B -->|No| C[Registration]
    B -->|Yes| D[Login Choice]
    
    C --> E[Email/Password Form]
    E --> F[Validation]
    F --> G[Bcrypt Hash]
    G --> H[Create User]
    H --> I[Send Verification Email]
    I --> J[Email Verification]
    
    D --> K{Method?}
    K -->|Email/Pass| L[Credentials Check]
    K -->|Google OAuth| M[OAuth Flow]
    
    L --> N{Valid?}
    N -->|Yes| O[Generate JWT Tokens]
    N -->|No| P[Login Failed]
    
    M --> Q[Google Consent]
    Q --> R[Get OAuth Tokens]
    R --> S[Get User Profile]
    S --> T{User Exists?}
    T -->|Yes| O
    T -->|No| U[Auto Create Account]
    U --> O
    
    O --> V[Access Token<br/>1 hour]
    O --> W[Refresh Token<br/>7 days]
    V --> X[Client Storage]
    W --> X
    
    style G fill:#ffebee
    style O fill:#e8f5e9
    style Q fill:#e3f2fd
    style V fill:#fff3e0
```

![Auth Module Flow](SÆ¡ Ä‘á»“ luá»“ng xá»­ lÃ½ Authentication vá»›i Registration, Email/Password Login vÃ  Google OAuth)

**Password Reset Mechanism:**

Khi user quÃªn password, há» cÃ³ thá»ƒ request reset qua email. System generate secure reset token (UUID), hash nÃ³ vá»›i SHA-256, vÃ  lÆ°u cáº£ identifier vÃ  secret vÃ o user record vá»›i expiry timestamp (1 giá»). Email chá»©a link vá»›i token identifier Ä‘Æ°á»£c gá»­i Ä‘áº¿n user.

Khi user click link vÃ  nháº­p password má»›i, system verify token chÆ°a expired vÃ  hash matches. Náº¿u valid, password má»›i Ä‘Æ°á»£c hash vÃ  update, reset tokens bá»‹ clear. Táº¥t cáº£ existing sessions bá»‹ invalidate Ä‘á»ƒ force re-login across devices, preventing unauthorized access náº¿u attacker cÃ³ old tokens.

#### **3.3.1.2. Users Module (User Profile Management)**

Users Module quáº£n lÃ½ toÃ n bá»™ thÃ´ng tin profile vÃ  preferences cá»§a ngÆ°á»i dÃ¹ng. Module nÃ y cung cáº¥p CRUD operations cho user data nhÆ° first name, last name, avatar, timezone, vÃ  cÃ¡c settings cÃ¡ nhÃ¢n.

Má»™t tÃ­nh nÄƒng quan trá»ng lÃ  User Settings management vá»›i JSONB storage trong PostgreSQL. Thay vÃ¬ táº¡o nhiá»u columns riÃªng cho má»—i setting, há»‡ thá»‘ng sá»­ dá»¥ng JSONB column `settings` Ä‘á»ƒ store flexible configuration. VÃ­ dá»¥, user cÃ³ thá»ƒ config notification preferences (email enabled/disabled cho tá»«ng loáº¡i notification), default calendar view (week/month), working hours, theme preference (light/dark), language...

JSONB Ä‘Æ°á»£c chá»n vÃ¬ kháº£ nÄƒng query vÃ  index tá»‘t - PostgreSQL cÃ³ thá»ƒ index vÃ o specific keys trong JSON, cho phÃ©p fast lookups mÃ  váº«n giá»¯ flexibility. Module expose API endpoints nhÆ° `PATCH /users/me/settings` Ä‘á»ƒ update partial settings mÃ  khÃ´ng overwrite toÃ n bá»™ object.

Users Module cÅ©ng handle avatar upload vÃ  processing. Khi user upload avatar image, file Ä‘Æ°á»£c validate (max 5MB, only JPEG/PNG/WebP), resize vá» multiple sizes (32x32 thumbnail, 128x128 medium, 512x512 large) using sharp library, vÃ  upload lÃªn cloud storage (hoáº·c local filesystem trong development). Avatar URLs Ä‘Æ°á»£c update vÃ o user record.

#### **3.3.1.3. Calendar Module (Calendar Metadata Management)**

Calendar Module khÃ¡c vá»›i Event Module - nÃ³ quáº£n lÃ½ calendars metadata chá»© khÃ´ng pháº£i individual events. Má»™t user cÃ³ thá»ƒ cÃ³ nhiá»u calendars, vÃ­ dá»¥: "Work", "Personal", "Family", má»—i calendar cÃ³ mÃ u sáº¯c riÃªng Ä‘á»ƒ phÃ¢n biá»‡t trÃªn UI.

Khi user connect Google Calendar, má»—i Google calendar Ä‘Æ°á»£c map vá»›i má»™t Calento calendar record. Record nÃ y lÆ°u `google_calendar_id`, `name`, `timezone`, `color`, vÃ  lÃ  `primary` calendar hay khÃ´ng. System duy trÃ¬ sync relationship nÃ y Ä‘á»ƒ biáº¿t events nÃ o thuá»™c calendar nÃ o.

Calendar Module cÅ©ng quáº£n lÃ½ calendar sharing permissions (trong tÆ°Æ¡ng lai). Hiá»‡n táº¡i má»—i user chá»‰ tháº¥y calendars cá»§a chÃ­nh há», nhÆ°ng architecture Ä‘Ã£ chuáº©n bá»‹ cho team calendars - permissions table cÃ³ thá»ƒ define ai cÃ³ quyá»n view/edit calendar nÃ o.

### **3.3.2. Event Management Modules**

Module nÃ y lÃ  core logic cá»§a há»‡ thá»‘ng. Quáº£n lÃ½ lá»‹ch, sá»± kiá»‡n, RRULE engine cho sá»± kiá»‡n láº·p láº¡i, Ä‘á»“ng bá»™ dá»¯ liá»‡u.

![][image11]

##### HÃ¬nh 10: Calendar & Event Module {#hÃ¬nh-10:-calendar-&-event-module}

* Booking Module: Xá»­ lÃ½ logic Ä‘áº·t lá»‹ch, táº¡o booking links, kiá»ƒm tra khung giá» ráº£nh (Availability checking).

![][image12]

##### HÃ¬nh 11: Booking Module {#hÃ¬nh-11:-booking-module}

### **3.3.2. AI & RAG Modules**

ÄÃ¢y lÃ  nhÃ³m module cá»‘t lÃµi táº¡o nÃªn tÃ­nh nÄƒng Ä‘áº·c trÆ°ng cá»§a Calento - trá»£ lÃ½ áº£o AI thÃ´ng minh. Kiáº¿n trÃºc Ä‘Æ°á»£c thiáº¿t káº¿ theo mÃ´ hÃ¬nh RAG (Retrieval-Augmented Generation) Ä‘á»ƒ Ä‘áº£m báº£o AI cÃ³ thá»ƒ tráº£ lá»i chÃ­nh xÃ¡c dá»±a trÃªn dá»¯ liá»‡u thá»±c táº¿ cá»§a ngÆ°á»i dÃ¹ng.

#### **3.3.2.1. LLM Module (Large Language Model Service)**

Module LLM Ä‘Ã³ng vai trÃ² lÃ  lá»›p trung gian (wrapper layer) giá»¯a há»‡ thá»‘ng Calento vÃ  Google Gemini API, cung cáº¥p má»™t interface thá»‘ng nháº¥t vÃ  dá»… sá»­ dá»¥ng cho cÃ¡c module khÃ¡c. Viá»‡c thiáº¿t káº¿ theo pattern nÃ y giÃºp tÃ¡ch biá»‡t logic nghiá»‡p vá»¥ khá»i chi tiáº¿t triá»ƒn khai cá»§a LLM provider cá»¥ thá»ƒ, cho phÃ©p dá»… dÃ ng thay Ä‘á»•i hoáº·c má»Ÿ rá»™ng trong tÆ°Æ¡ng lai.

**Kiáº¿n trÃºc vÃ  thÃ nh pháº§n:**

Module Ä‘Æ°á»£c thiáº¿t káº¿ vá»›i ba nhÃ³m chá»©c nÄƒng chÃ­nh. NhÃ³m Ä‘áº§u tiÃªn quáº£n lÃ½ Model Configuration & Initialization, chá»‹u trÃ¡ch nhiá»‡m khá»Ÿi táº¡o Gemini model vá»›i cÃ¡c tham sá»‘ Ä‘Æ°á»£c Ä‘iá»u chá»‰nh tá»‘i Æ°u cho domain quáº£n lÃ½ lá»‹ch. Tham sá»‘ `temperature` Ä‘Æ°á»£c thiáº¿t láº­p á»Ÿ má»©c 0.7 Ä‘á»ƒ cÃ¢n báº±ng giá»¯a tÃ­nh sÃ¡ng táº¡o vÃ  nháº¥t quÃ¡n trong cÃ¢u tráº£ lá»i. CÃ¡c tham sá»‘ `topK` (40) vÃ  `topP` (0.95) Ä‘iá»u chá»‰nh quÃ¡ trÃ¬nh sampling Ä‘á»ƒ Ä‘áº£m báº£o cháº¥t lÆ°á»£ng output. Giá»›i háº¡n `maxOutputTokens` á»Ÿ 2048 tokens giÃºp kiá»ƒm soÃ¡t Ä‘á»™ dÃ i pháº£n há»“i vÃ  chi phÃ­ API. Äáº·c biá»‡t, `safetySettings` Ä‘Æ°á»£c cáº¥u hÃ¬nh Ä‘á»ƒ lá»c cÃ¡c ná»™i dung cÃ³ háº¡i, Ä‘áº£m báº£o an toÃ n cho ngÆ°á»i dÃ¹ng.

NhÃ³m chá»©c nÄƒng thá»© hai lÃ  Prompt Engineering, quáº£n lÃ½ system prompts Ä‘Æ°á»£c tá»‘i Æ°u hÃ³a Ä‘áº·c biá»‡t cho viá»‡c quáº£n lÃ½ thá»i gian. System prompt Ä‘á»‹nh nghÄ©a rÃµ rÃ ng vai trÃ² cá»§a AI lÃ  "Calento AI Assistant - trá»£ lÃ½ thÃ´ng minh chuyÃªn vá» quáº£n lÃ½ thá»i gian", vá»›i nhiá»‡m vá»¥ cá»¥ thá»ƒ lÃ  há»— trá»£ ngÆ°á»i dÃ¹ng quáº£n lÃ½ lá»‹ch trÃ¬nh, tÃ¬m kiáº¿m events, vÃ  Ä‘á» xuáº¥t thá»i gian há»p há»£p lÃ½. Phong cÃ¡ch giao tiáº¿p Ä‘Æ°á»£c thiáº¿t káº¿ thÃ¢n thiá»‡n, ngáº¯n gá»n nhÆ°ng chÃ­nh xÃ¡c, cÃ³ sá»­ dá»¥ng emoji phÃ¹ há»£p Ä‘á»ƒ tÄƒng tÃ­nh tÆ°Æ¡ng tÃ¡c. Module cÅ©ng há»— trá»£ Ä‘a ngÃ´n ngá»¯, tá»± Ä‘á»™ng phÃ¡t hiá»‡n vÃ  tráº£ lá»i báº±ng tiáº¿ng Viá»‡t hoáº·c tiáº¿ng Anh tÃ¹y theo ngÃ´n ngá»¯ cÃ¢u há»i cá»§a ngÆ°á»i dÃ¹ng.

NhÃ³m thá»© ba triá»ƒn khai Streaming Support thÃ´ng qua Server-Sent Events (SSE), cho phÃ©p AI stream responses vá» client theo thá»i gian thá»±c. Thay vÃ¬ chá» Ä‘á»£i cÃ¢u tráº£ lá»i hoÃ n chá»‰nh, ngÆ°á»i dÃ¹ng tháº¥y tá»«ng pháº§n cá»§a response xuáº¥t hiá»‡n dáº§n, táº¡o tráº£i nghiá»‡m tÆ°Æ¡ng tÃ¡c tá»‘t hÆ¡n tÆ°Æ¡ng tá»± nhÆ° ChatGPT. Äiá»u nÃ y Ä‘áº·c biá»‡t quan trá»ng vá»›i cÃ¡c cÃ¢u tráº£ lá»i dÃ i hoáº·c phá»©c táº¡p.

**Function Calling Integration:**

Má»™t tÃ­nh nÄƒng Ä‘áº·c biá»‡t quan trá»ng cá»§a LLM Module lÃ  kháº£ nÄƒng Function Calling - cho phÃ©p AI khÃ´ng chá»‰ tráº£ lá»i cÃ¢u há»i mÃ  cÃ²n thá»±c hiá»‡n cÃ¡c hÃ nh Ä‘á»™ng cá»¥ thá»ƒ trong há»‡ thá»‘ng. Module Ä‘á»‹nh nghÄ©a bá»‘n functions chÃ­nh mÃ  AI cÃ³ thá»ƒ gá»i: `createEvent` Ä‘á»ƒ táº¡o sá»± kiá»‡n má»›i vá»›i Ä‘áº§y Ä‘á»§ thÃ´ng tin vá» tiÃªu Ä‘á», thá»i gian báº¯t Ä‘áº§u/káº¿t thÃºc vÃ  danh sÃ¡ch ngÆ°á»i tham dá»±; `findAvailableSlots` Ä‘á»ƒ tÃ¬m cÃ¡c khung giá» ráº£nh dá»±a trÃªn ngÃ y vÃ  thá»i lÆ°á»£ng mong muá»‘n; `searchEvents` Ä‘á»ƒ tÃ¬m kiáº¿m events theo semantic meaning thay vÃ¬ keyword matching truyá»n thá»‘ng; vÃ  `getScheduleSummary` Ä‘á»ƒ tÃ³m táº¯t lá»‹ch trÃ¬nh trong má»™t khoáº£ng thá»i gian cá»¥ thá»ƒ.

```mermaid
graph TB
    A[User Query] --> B{LLM Service}
    B --> C[Model Config]
    C --> D[Gemini 2.0 Flash<br/>temp=0.7, topK=40]
    
    B --> E[Prompt Engineering]
    E --> F[System Prompt<br/>Role + Style + Language]
    
    B --> G[Function Detection]
    G --> H{Intent Analysis}
    
    H -->|Create| I[createEvent<br/>title, time, attendees]
    H -->|Search| J[findAvailableSlots<br/>date, duration]
    H -->|Query| K[searchEvents<br/>semantic query]
    H -->|Summary| L[getScheduleSummary<br/>date range]
    
    I --> M[Execute Function]
    J --> M
    K --> M
    L --> M
    
    M --> N[Return Result]
    N --> O[Generate Response]
    O --> P[SSE Streaming]
    P --> Q[Client Display]
    
    style D fill:#e1f5ff
    style F fill:#fff4e1
    style M fill:#e8f5e9
    style P fill:#fce4ec
```

![LLM Module Architecture](SÆ¡ Ä‘á»“ kiáº¿n trÃºc LLM Module vá»›i cÃ¡c thÃ nh pháº§n: Model Config, Prompt Engineering, Function Calling vÃ  SSE Streaming)

##### HÃ¬nh 12: LLM Module Architecture {#hÃ¬nh-12:-llm-module}

**Luá»“ng xá»­ lÃ½ chi tiáº¿t:**

Khi nháº­n Ä‘Æ°á»£c má»™t cÃ¢u há»i tá»« ngÆ°á»i dÃ¹ng, LLM Service thá»±c hiá»‡n chuá»—i xá»­ lÃ½ theo quy trÃ¬nh cháº·t cháº½. Äáº§u tiÃªn, cÃ¢u há»i Ä‘Æ°á»£c Ä‘Æ°a qua Intent Analysis Ä‘á»ƒ xÃ¡c Ä‘á»‹nh ngÆ°á»i dÃ¹ng muá»‘n thá»±c hiá»‡n hÃ nh Ä‘á»™ng gÃ¬ - táº¡o sá»± kiá»‡n má»›i, tÃ¬m kiáº¿m thÃ´ng tin, hay chá»‰ Ä‘Æ¡n giáº£n lÃ  há»i thÃ´ng tin. Dá»±a trÃªn káº¿t quáº£ phÃ¢n tÃ­ch, module cÃ³ thá»ƒ trigger function calling tÆ°Æ¡ng á»©ng hoáº·c chuyá»ƒn sang generation mode thuáº§n tÃºy. ToÃ n bá»™ quÃ¡ trÃ¬nh nÃ y Ä‘Æ°á»£c tá»‘i Æ°u hÃ³a Ä‘á»ƒ Ä‘áº£m báº£o thá»i gian pháº£n há»“i nhanh vÃ  Ä‘á»™ chÃ­nh xÃ¡c cao.

#### **3.3.2.2. LangChain Integration Layer**

LangChain Ä‘Æ°á»£c tÃ­ch há»£p vÃ o há»‡ thá»‘ng nhÆ° má»™t orchestration framework, Ä‘Ã³ng vai trÃ² Ä‘iá»u phá»‘i luá»“ng xá»­ lÃ½ phá»©c táº¡p giá»¯a cÃ¡c components khÃ¡c nhau bao gá»“m LLM, Vector Store, vÃ  Memory management. Framework nÃ y khÃ´ng thay tháº¿ mÃ  bá»• trá»£ cho LLM Module, cung cáº¥p cÃ¡c abstractions vÃ  utilities giÃºp code dá»… maintain vÃ  extend hÆ¡n.

**Memory Management vá»›i Chat Message History:**

Má»™t trong nhá»¯ng thÃ¡ch thá»©c lá»›n nháº¥t khi xÃ¢y dá»±ng chatbot lÃ  quáº£n lÃ½ ngá»¯ cáº£nh há»™i thoáº¡i (conversation context). LangChain giáº£i quyáº¿t váº¥n Ä‘á» nÃ y thÃ´ng qua component ChatMessageHistory, tá»± Ä‘á»™ng lÆ°u trá»¯ vÃ  retrieve lá»‹ch sá»­ tin nháº¯n. Component nÃ y Ä‘Æ°á»£c cáº¥u hÃ¬nh vá»›i `returnMessages: true` Ä‘á»ƒ tráº£ vá» full message objects thay vÃ¬ chá»‰ text, cho phÃ©p giá»¯ metadata quan trá»ng nhÆ° timestamps vÃ  roles. Memory key Ä‘Æ°á»£c Ä‘áº·t lÃ  "chat_history" vÃ  Ä‘Æ°á»£c map vá»›i input/output keys tÆ°Æ¡ng á»©ng, táº¡o ra má»™t pipeline xá»­ lÃ½ rÃµ rÃ ng vÃ  dá»… debug.

**Prompt Templates vÃ  Standardization:**

Thay vÃ¬ concatenate strings thá»§ cÃ´ng Ä‘á»ƒ táº¡o prompts - má»™t practice dá»… gÃ¢y lá»—i vÃ  khÃ³ maintain - LangChain cung cáº¥p ChatPromptTemplate system. Template nÃ y cho phÃ©p Ä‘á»‹nh nghÄ©a prompts dÆ°á»›i dáº¡ng structured messages vá»›i placeholders cho dynamic content. System message chá»©a instructions khÃ´ng Ä‘á»•i vá» vai trÃ² vÃ  hÃ nh vi cá»§a AI, trong khi human message template chá»©a context tá»« RAG vÃ  cÃ¢u há»i thá»±c táº¿ cá»§a user. Cáº¥u trÃºc nÃ y Ä‘áº£m báº£o tÃ­nh nháº¥t quÃ¡n trong cÃ¡ch prompts Ä‘Æ°á»£c format vÃ  dá»… dÃ ng A/B testing cÃ¡c phiÃªn báº£n prompt khÃ¡c nhau.

**LLM Chain vÃ  Composition Pattern:**

Má»™t trong nhá»¯ng Ä‘iá»ƒm máº¡nh nháº¥t cá»§a LangChain lÃ  kháº£ nÄƒng compose cÃ¡c operations phá»©c táº¡p tá»« simple components thÃ´ng qua piping mechanism. Prompt template Ä‘Æ°á»£c pipe vÃ o LLM, output cá»§a LLM Ä‘Æ°á»£c pipe vÃ o parser, táº¡o thÃ nh má»™t chain xá»­ lÃ½ liá»n máº¡ch. Pattern nÃ y mang láº¡i nhiá»u lá»£i Ã­ch: code trá»Ÿ nÃªn declarative vÃ  self-documenting; dá»… dÃ ng insert thÃªm processing steps vÃ o giá»¯a chain; vÃ  cÃ³ thá»ƒ reuse cÃ¡c sub-chains cho nhiá»u use cases khÃ¡c nhau.

```mermaid
graph LR
    A[User Input] --> B[Prompt Template]
    B --> C{Context Injection}
    C --> D[System Message]
    C --> E[Human Message<br/>with Context]
    
    D --> F[LLM Chain]
    E --> F
    
    F --> G[Gemini API]
    G --> H[Raw Response]
    H --> I[Output Parser]
    I --> J[Structured Data]
    
    subgraph Memory
        K[Chat History]
        K -.->|Previous Context| C
        J -.->|Save| K
    end
    
    style B fill:#e3f2fd
    style F fill:#fff3e0
    style I fill:#f3e5f5
    style K fill:#e8f5e9
```

![LangChain Integration Flow](SÆ¡ Ä‘á»“ luá»“ng xá»­ lÃ½ LangChain vá»›i Prompt Template, Memory Management vÃ  LLM Chain)

**Lá»£i Ã­ch cá»§a LangChain trong há»‡ thá»‘ng:**

Viá»‡c tÃ­ch há»£p LangChain mang láº¡i bá»‘n lá»£i Ã­ch chÃ­nh cho dá»± Ã¡n Calento. Thá»© nháº¥t lÃ  Abstraction - kháº£ nÄƒng trá»«u tÆ°á»£ng hÃ³a cÃ¡c LLM providers khÃ¡c nhau. Náº¿u trong tÆ°Æ¡ng lai cáº§n chuyá»ƒn tá»« Gemini sang OpenAI GPT hoáº·c Anthropic Claude, chá»‰ cáº§n thay Ä‘á»•i LLM initialization mÃ  khÃ´ng áº£nh hÆ°á»Ÿng Ä‘áº¿n business logic. Thá»© hai lÃ  Memory Management vá»›i built-in conversation memory giÃºp AI nhá»› ngá»¯ cáº£nh cÃ¡c cuá»™c há»™i thoáº¡i trÆ°á»›c Ä‘Ã³. Thá»© ba, Chaining pattern cho phÃ©p compose complex workflows tá»« simple, testable components. Cuá»‘i cÃ¹ng lÃ  Observability - LangChain cung cáº¥p built-in logging vÃ  debugging tools giÃºp track tá»«ng bÆ°á»›c xá»­ lÃ½, vÃ´ cÃ¹ng há»¯u Ã­ch khi troubleshoot issues trong production.



#### **3.3.2.3. Vector Module (Embedding & Similarity Search)**

Module Vector quáº£n lÃ½ toÃ n bá»™ vÃ²ng Ä‘á»i (lifecycle) cá»§a vector embeddings, tá»« quÃ¡ trÃ¬nh generate embeddings cho text, lÆ°u trá»¯ vÃ o database, Ä‘áº¿n viá»‡c tÃ¬m kiáº¿m semantic similarity. ÄÃ¢y lÃ  ná»n táº£ng ká»¹ thuáº­t cho tÃ­nh nÄƒng RAG - cho phÃ©p AI khÃ´ng chá»‰ dá»±a vÃ o general knowledge mÃ  cÃ²n truy xuáº¥t thÃ´ng tin cá»¥ thá»ƒ tá»« dá»¯ liá»‡u ngÆ°á»i dÃ¹ng.

**Embedding Generation Process:**

Há»‡ thá»‘ng sá»­ dá»¥ng model `text-embedding-004` cá»§a Google, má»™t trong nhá»¯ng embedding models tiÃªn tiáº¿n nháº¥t hiá»‡n nay vá»›i nhiá»u Æ°u Ä‘iá»ƒm vÆ°á»£t trá»™i. Model nÃ y táº¡o ra vectors cÃ³ 768 chiá»u (dimensions), má»™t kÃ­ch thÆ°á»›c Ä‘á»§ lá»›n Ä‘á»ƒ capture semantic meaning nhÆ°ng váº«n hiá»‡u quáº£ cho viá»‡c storage vÃ  retrieval. Äiá»ƒm Ä‘áº·c biá»‡t lÃ  kháº£ nÄƒng há»— trá»£ Ä‘a ngÃ´n ngá»¯, bao gá»“m cáº£ tiáº¿ng Viá»‡t vÃ  tiáº¿ng Anh, Ä‘áº£m báº£o ráº±ng ngÆ°á»i dÃ¹ng Viá»‡t Nam cÃ³ tráº£i nghiá»‡m tÃ¬m kiáº¿m cháº¥t lÆ°á»£ng tÆ°Æ¡ng Ä‘Æ°Æ¡ng vá»›i cÃ¡c ngÃ´n ngá»¯ phá»• biáº¿n khÃ¡c. Model Ä‘Æ°á»£c optimize Ä‘áº·c biá»‡t cho short texts nhÆ° event titles vÃ  descriptions - Ä‘Ãºng vá»›i use case cá»§a á»©ng dá»¥ng lá»‹ch.

QuÃ¡ trÃ¬nh generate embedding diá»…n ra nhÆ° sau: khi nháº­n Ä‘Æ°á»£c má»™t Ä‘oáº¡n text (vÃ­ dá»¥: "Hop team vá» sprint planning tuáº§n sau"), module gá»i API cá»§a Google Generative AI vá»›i model embedding Ä‘Ã£ Ä‘Æ°á»£c khá»Ÿi táº¡o sáºµn. API tráº£ vá» má»™t array cá»§a 768 sá»‘ thá»±c (float numbers), má»—i sá»‘ Ä‘áº¡i diá»‡n cho má»™t dimension trong semantic space. Vector nÃ y sau Ä‘Ã³ Ä‘Æ°á»£c lÆ°u trá»¯ vÃ o PostgreSQL database cÃ¹ng vá»›i original text vÃ  metadata liÃªn quan.

**Storage vÃ  Indexing vá»›i pgvector:**

PostgreSQL Ä‘Æ°á»£c má»Ÿ rá»™ng vá»›i extension pgvector, cho phÃ©p lÆ°u trá»¯ vÃ  query vector data má»™t cÃ¡ch native. Extension nÃ y cung cáº¥p data type `vector(768)` Ä‘á»ƒ store embeddings vÃ  cÃ¡c operators Ä‘áº·c biá»‡t cho vector operations. Operator `<=>` (cosine distance) Ä‘Æ°á»£c sá»­ dá»¥ng Ä‘á»ƒ Ä‘o Ä‘á»™ tÆ°Æ¡ng Ä‘á»“ng giá»¯a hai vectors - giÃ¡ trá»‹ cÃ ng nhá» nghÄ©a lÃ  hai vectors cÃ ng giá»‘ng nhau (tÆ°Æ¡ng tá»± vá» semantic meaning).

Äá»ƒ tá»‘i Æ°u hÃ³a performance, há»‡ thá»‘ng sá»­ dá»¥ng HNSW index (Hierarchical Navigable Small World) - má»™t loáº¡i approximate nearest neighbor index Ä‘Æ°á»£c thiáº¿t káº¿ Ä‘áº·c biá»‡t cho high-dimensional vectors. Index nÃ y cho phÃ©p search trong hÃ ng trÄƒm nghÃ¬n vectors vá»›i thá»i gian pháº£n há»“i dÆ°á»›i 10 milliseconds, Ä‘áº£m báº£o tráº£i nghiá»‡m real-time cho ngÆ°á»i dÃ¹ng.

**Similarity Search Workflow:**

```mermaid
graph TB
    A[User Query Text] --> B[Generate Query Embedding]
    B --> C[768-dim Vector]
    C --> D[PostgreSQL pgvector]
    
    subgraph "Vector Database"
        D --> E[HNSW Index]
        E --> F[Cosine Distance<br/>Calculation]
        F --> G{Similarity > 0.7}
    end
    
    G -->|Yes| H[Return Top-K<br/>Results]
    G -->|No| I[Filter Out]
    
    H --> J[Relevant Events]
    J --> K[Sort by Similarity]
    K --> L[Top 5 Events]
    
    style C fill:#e1f5ff
    style E fill:#fff4e1
    style G fill:#f3e5f5
    style L fill:#e8f5e9
```

![Vector Similarity Search Process](SÆ¡ Ä‘á»“ quy trÃ¬nh tÃ¬m kiáº¿m semantic similarity vá»›i pgvector: tá»« text query Ä‘áº¿n top-K relevant  results)

QuÃ¡ trÃ¬nh search diá»…n ra trong ba bÆ°á»›c chÃ­nh. Äáº§u tiÃªn, user query Ä‘Æ°á»£c transform thÃ nh vector embedding sá»­ dá»¥ng cÃ¹ng model `text-embedding-004`. Thá»© hai, vector nÃ y Ä‘Æ°á»£c so sÃ¡nh vá»›i táº¥t cáº£ vectors Ä‘Ã£ lÆ°u trong database sá»­ dá»¥ng cosine distance, vá»›i HNSW index giÃºp tÄƒng tá»‘c computation Ä‘Ã¡ng ká»ƒ. Cuá»‘i cÃ¹ng, káº¿t quáº£ Ä‘Æ°á»£c filter theo threshold (similarity > 0.7), sort theo Ä‘á»™ tÆ°Æ¡ng Ä‘á»“ng giáº£m dáº§n, vÃ  tráº£ vá» top 5 events most relevant vá»›i query.

#### **3.3.2.4. RAG Module (Retrieval-Augmented Generation)**

RAG Module lÃ  táº§ng integration cao nháº¥t, káº¿t há»£p Vector Service vÃ  LLM Service theo RAG pattern Ä‘á»ƒ táº¡o ra má»™t AI assistant context-aware vÃ  chÃ­nh xÃ¡c. Module nÃ y thá»±c hiá»‡n vai trÃ² cáº§u ná»‘i, orchestrate quÃ¡ trÃ¬nh retrieval vÃ  generation thÃ nh má»™t workflow liá»n máº¡ch.

**Three-Phase RAG Workflow:**

Quy trÃ¬nh RAG Ä‘Æ°á»£c chia thÃ nh ba phases rÃµ rÃ ng, má»—i phase cÃ³ trÃ¡ch nhiá»‡m riÃªng biá»‡t. Phase 1 - Retrieval (TÃ¬m kiáº¿m) lÃ  bÆ°á»›c Ä‘áº§u tiÃªn khi user gá»­i cÃ¢u há»i. RAG Service nháº­n query text vÃ  chuyá»ƒn ngay cho Vector Service Ä‘á»ƒ generate embedding. Embedding nÃ y Ä‘Æ°á»£c sá»­ dá»¥ng Ä‘á»ƒ search trong database, tÃ¬m ra 5 events cÃ³ semantic meaning gáº§n nháº¥t vá»›i cÃ¢u há»i. VÃ­ dá»¥, náº¿u user há»i "TÃ´i cÃ³ gáº·p client nÃ o tuáº§n nÃ y khÃ´ng?", vector search sáº½ tÃ¬m ra cÃ¡c events cÃ³ keywords nhÆ° "client", "meeting", "presentation" trong tuáº§n hiá»‡n táº¡i, ngay cáº£ khi exact phrase "gáº·p client" khÃ´ng xuáº¥t hiá»‡n trong event title.

Phase 2 - Augmentation (LÃ m giÃ u) lÃ  bÆ°á»›c format vÃ  inject context vÃ o prompt. RAG Service láº¥y 5 events vá»«a retrieve Ä‘Æ°á»£c, transform chÃºng thÃ nh JSON format vá»›i cÃ¡c fields relevant (title, start_time, end_time, location, attendees). JSON nÃ y Ä‘Æ°á»£c concatenate vá»›i user query vÃ  system instructions Ä‘á»ƒ táº¡o thÃ nh má»™t complete prompt. Prompt nÃ y rÃµ rÃ ng chá»‰ dáº«n LLM: "Dá»±a vÃ o cÃ¡c events trong context, hÃ£y tráº£ lá»i cÃ¢u há»i cá»§a user má»™t cÃ¡ch chÃ­nh xÃ¡c. Náº¿u thÃ´ng tin khÃ´ng cÃ³ trong context, hÃ£y thÃ nh tháº­t nÃ³i khÃ´ng biáº¿t thay vÃ¬ Ä‘oÃ¡n".

Phase 3 - Generation (Sinh cÃ¢u tráº£ lá»i) lÃ  bÆ°á»›c cuá»‘i cÃ¹ng khi augmented prompt Ä‘Æ°á»£c gá»­i Ä‘áº¿n Gemini LLM. Model phÃ¢n tÃ­ch context vÃ  question, generate response dá»±a trÃªn factual information tá»« events thay vÃ¬ hallucinate. Response Ä‘Æ°á»£c stream vá» client qua SSE, cho phÃ©p user tháº¥y tá»«ng pháº§n cÃ¢u tráº£ lá»i xuáº¥t hiá»‡n real-time, táº¡o tráº£i nghiá»‡m interactive tá»‘t.

```mermaid
sequenceDiagram
    participant U as User
    participant RAG as RAG Service
    participant VEC as Vector Service
    participant DB as pgvector DB
    participant LLM as Gemini LLM
    participant SSE as Streaming

    U->>RAG: "TÃ´i cÃ³ báº­n vÃ o thá»© 5?"
    RAG->>VEC: generateEmbedding(query)
    VEC-->>RAG: embedding[768]
    
    RAG->>DB: searchSimilar(embedding)
    Note over DB: Cosine similarity<br/>HNSW index search
    DB-->>RAG: Top 5 relevant events
    
    RAG->>RAG: formatContext(events)
    RAG->>RAG: buildPrompt(context + query)
    
    RAG->>LLM: streamChat(augmentedPrompt)
    LLM-->>SSE: chunk: "Dá»±a vÃ o lá»‹ch..."
    SSE-->>U: Display chunk
    LLM-->>SSE: chunk: "báº¡n cÃ³ 2 meetings"
    SSE-->>U: Display chunk
    LLM-->>SSE: [DONE]
    SSE-->>U: Close stream
```

![RAG Sequence Flow](SÆ¡ Ä‘á»“ tuáº§n tá»± chi tiáº¿t cá»§a RAG workflow tá»« user query Ä‘áº¿n streaming response)

**Context Quality vÃ  Relevance Filtering:**

Má»™t thÃ¡ch thá»©c quan trá»ng trong RAG lÃ  Ä‘áº£m báº£o cháº¥t lÆ°á»£ng context Ä‘Æ°á»£c inject vÃ o prompt. Náº¿u retrieve quÃ¡ nhiá»u irrelevant events, LLM cÃ³ thá»ƒ bá»‹ confused vÃ  Ä‘Æ°a ra cÃ¢u tráº£ lá»i sai. Há»‡ thá»‘ng giáº£i quyáº¿t váº¥n Ä‘á» nÃ y báº±ng similarity threshold - chá»‰ nhá»¯ng events cÃ³ similarity score > 0.7 má»›i Ä‘Æ°á»£c consider. NgÆ°á»¡ng nÃ y Ä‘Æ°á»£c fine-tune qua testing Ä‘á»ƒ cÃ¢n báº±ng giá»¯a recall (khÃ´ng bá» sÃ³t events quan trá»ng) vÃ  precision (khÃ´ng include events khÃ´ng liÃªn quan).

Trong trÆ°á»ng há»£p khÃ´ng tÃ¬m tháº¥y events nÃ o Ä‘áº¡t threshold, RAG Service sáº½ truyá»n empty context cho LLM kÃ¨m instruction rÃµ rÃ ng: "No relevant events found in user's calendar. Answer based on general knowledge or inform user you don't have specific information". CÆ¡ cháº¿ nÃ y prevent hallucination - má»™t váº¥n Ä‘á» phá»• biáº¿n vá»›i LLMs khi chÃºng "bá»‹a" thÃ´ng tin khÃ´ng cÃ³ tháº­t.

### **3.3.3. Google Calendar Sync Module**

Module Google Calendar Sync lÃ  má»™t trong nhá»¯ng components phá»©c táº¡p nháº¥t cá»§a há»‡ thá»‘ng, chá»‹u trÃ¡ch nhiá»‡m Ä‘á»“ng bá»™ dá»¯ liá»‡u hai chiá»u giá»¯a Calento vÃ  Google Calendar. Thiáº¿t káº¿ pháº£i Ä‘áº£m báº£o data consistency trong mÃ´i trÆ°á»ng distributed system - má»™t bÃ i toÃ¡n khÃ´ng há» Ä‘Æ¡n giáº£n khi cÃ³ hai sources of truth Ä‘á»™c láº­p.

**OAuth Authentication Flow:**

TrÆ°á»›c khi cÃ³ thá»ƒ Ä‘á»“ng bá»™, user pháº£i authorize Calento truy cáº­p Google Calendar cá»§a há» thÃ´ng qua OAuth 2.0 flow. Quy trÃ¬nh báº¯t Ä‘áº§u khi user click nÃºt "Connect Google Calendar" trÃªn UI. Backend generate OAuth URL vá»›i cÃ¡c scopes cáº§n thiáº¿t (`calendar.events`, `calendar.readonly`) vÃ  redirect user Ä‘áº¿n Google consent screen. Sau khi user cháº¥p

 thuáº­n, Google redirect vá» Calento callback URL kÃ¨m authorization code. Backend exchange code nÃ y láº¥y access token (valid 1 giá») vÃ  refresh token (long-lived), lÆ°u vÃ o `user_credentials` table vá»›i encryption.

**Bi-directional Sync Architecture:**

Sync process Ä‘Æ°á»£c chia thÃ nh hai phases cháº¡y Ä‘á»™c láº­p: PULL (Google â†’ Calento) vÃ  PUSH (Calento â†’ Google). Cáº£ hai phases Ä‘Æ°á»£c trigger bá»Ÿi background job cháº¡y Ä‘á»‹nh ká»³ má»—i 5 phÃºt, Ä‘áº£m báº£o dá»¯ liá»‡u luÃ´n gáº§n nhÆ° real-time nhÆ°ng khÃ´ng quÃ¡ táº£i API quota cá»§a Google.

```mermaid
graph TB
    A[Background Job<br/>Every 5 min] --> B{Check Credentials}
    B -->|Expired| C[Refresh Token]
    B -->|Valid| D[Start Sync]
    C --> D
    
    D --> E[PULL Phase]
    D --> F[PUSH Phase]
    
    subgraph "PULL: Google â†’ Calento"
        E --> G[Fetch Updated Events<br/>since lastSyncTime]
        G --> H[Compare with Local DB]
        H --> I{Event Exists?}
        I -->|No| J[INSERT New Event]
        I -->|Yes| K{Has Changes?}
        K -->|Both Modified| L[Detect Conflict]
        K -->|Only Google| M[UPDATE from Google]
        L --> N[Save to<br/>event_conflicts]
    end
    
    subgraph "PUSH: Calento â†’ Google"
        F --> O[Find Local Events<br/>google_id = NULL]
        O --> P[Create in Google]
        P --> Q[Save google_id<br/>to Local]
    end
    
    style C fill:#ffebee
    style L fill:#fff3e0
    style J fill:#e8f5e9
    style P fill:#e1f5ff
```

![Google Calendar Sync Flow](SÆ¡ Ä‘á»“ luá»“ng Ä‘á»“ng bá»™ Google Calendar vá»›i PULL vÃ  PUSH phases song song)

PULL Phase sá»­ dá»¥ng Google Calendar API endpoint `events.list()` vá»›i parameter `updatedMin` set to `lastSyncTime`, ensuring chá»‰ fetch events Ä‘Ã£ Ä‘Æ°á»£c modified tá»« láº§n sync cuá»‘i. Má»—i event tá»« Google Ä‘Æ°á»£c compare vá»›i local database dá»±a vÃ o `google_event_id`. Náº¿u event chÆ°a tá»“n táº¡i locally, thá»±c hiá»‡n INSERT. Náº¿u Ä‘Ã£ tá»“n táº¡i, compare `updated_at` timestamps - náº¿u cáº£ hai phÃ­a Ä‘á»u cÃ³ changes (local modified_at > last_sync AND Google updated > last_sync), Ä‘Ã¢y lÃ  conflict case cáº§n user resolution.

PUSH Phase  query database tÃ¬m táº¥t cáº£ events cÃ³ `google_event_id IS NULL` - Ä‘Ã¢y lÃ  cÃ¡c events Ä‘Æ°á»£c táº¡o trong Calento chÆ°a sync lÃªn Google. Má»—i event Ä‘Æ°á»£c transform sang Google Calendar format (convert time zones, map fields) vÃ  call `events.insert()` API. Sau khi create thÃ nh cÃ´ng, `google_event_id` Ä‘Æ°á»£c update vÃ o local database Ä‘á»ƒ track relationship.

**Conflict Resolution Mechanism:**

Conflict xáº£y ra khi cÃ¹ng má»™t event bá»‹ modify á»Ÿ cáº£ hai há»‡ thá»‘ng trong cÃ¹ng sync interval. Há»‡ thá»‘ng detect conflict báº±ng cÃ¡ch compare `updated_at` timestamp cá»§a local event vá»›i `updated` timestamp tá»« Google response - náº¿u cáº£ hai Ä‘á»u > `last_sync_at`, cÃ³ conflict. Thay vÃ¬ tá»± Ä‘á»™ng overwrite (cÃ³ thá»ƒ máº¥t dá»¯ liá»‡u), system lÆ°u conflict vÃ o table `event_conflicts` vá»›i full data tá»« cáº£ hai phÃ­a vÃ  notify user.

User Ä‘Æ°á»£c present vá»›i conflict resolution UI, cho phÃ©p chá»n má»™t trong bá»‘n strategies: `prefer_google` (giá»¯ version tá»« Google, discard local changes); `prefer_calento` (push local changes lÃªn Google, overwrite); `keep_both` (táº¡o hai events riÃªng biá»‡t vá»›i suffixes); hoáº·c `manual` (user tá»± merge fields tá»« hai versions). Decision Ä‘Æ°á»£c execute vÃ  conflict record Ä‘Æ°á»£c mark resolved.

### **3.3.4. Notification System Module**

Notification System Ä‘Æ°á»£c thiáº¿t káº¿ theo mÃ´ hÃ¬nh event-driven architecture vá»›i message queue, Ä‘áº£m báº£o notifications Ä‘Æ°á»£c deliver reliably ngay cáº£ khi cÃ³ failures. Há»‡ thá»‘ng há»— trá»£  nhiá»u kÃªnh thÃ´ng bÃ¡o khÃ¡c nhau, má»—i kÃªnh phÃ¹ há»£p cho cÃ¡c use cases cá»¥ thá»ƒ.

**Multi-channel Architecture:**

Há»‡ thá»‘ng hiá»‡n há»— trá»£ hai kÃªnh chÃ­nh: Email (primary channel) vÃ  Webhook (cho integrations). Email channel xá»­ lÃ½ cÃ¡c notifications quan trá»ng nhÆ° event reminders, booking confirmations, team invitations. Webhook channel cho phÃ©p developers tÃ­ch há»£p Calento vá»›i external systems nhÆ° Slack workspace notifications hoáº·c custom business logic.

Notification Service hoáº¡t Ä‘á»™ng nhÆ° central coordinator. Khi má»™t event trigger notification (vÃ­ dá»¥: user táº¡o sá»± kiá»‡n má»›i), service check user preferences trong database Ä‘á»ƒ xÃ¡c Ä‘á»‹nh kÃªnh nÃ o enabled. Náº¿u email enabled, má»™t job Ä‘Æ°á»£c add vÃ o email queue. Náº¿u webhook enabled, job Ä‘Æ°á»£c add vÃ o webhook queue. Queuing mechanism Ä‘áº£m báº£o notifications khÃ´ng block main request thread vÃ  cÃ³ thá»ƒ retry náº¿u delivery fails.

**Email Worker Implementation:**

Email worker Ä‘Æ°á»£c implement vá»›i BullMQ - má»™t robust Redis-based queue system. Worker subscribe vÃ o `send-notification` queue vÃ  process jobs concurrently (configurable concurrency limit Ä‘á»ƒ avoid overwhelming SMTP server). Má»—i job chá»©a `userId`, `notificationType`, vÃ  `data` object with template variables.

Worker Ä‘áº§u tiÃªn select email template tÆ°Æ¡ng á»©ng vá»›i notification type tá»« template storage. Templates Ä‘Æ°á»£c viáº¿t báº±ng Handlebars syntax, cho phÃ©p dynamic content injection. VÃ­ dá»¥, template `event-reminder.hbs` cÃ³ placeholders nhÆ° `{{event.title}}`, `{{event.start_time}}`, `{{user.first_name}}`. Worker compile template vá»›i actual data, generate HTML email body, vÃ  gá»­i qua Nodemailer vá»›i SMTP configuration.

```mermaid
flowchart LR
    A[Event Trigger] --> B{Notification Service}
    B --> C[Check User<br/>Preferences]
    
    C -->|Email Enabled| D[Email Queue]
    C -->|Webhook Enabled| E[Webhook Queue]
    
    D --> F[Email Worker]
    F --> G[Select Template]
    G --> H[Render Handlebars]
    H --> I[SMTP Send]
    
    E --> J[Webhook Worker]
    J --> K[Generate Signature]
    K --> L[HTTP POST]
    
    I --> M{Success?}
    L --> N{Success?}
    
    M -->|Fail| O[Retry<br/>Exponential Backoff]
    N -->|Fail| O
    
    M -->|Success| P[Log Delivery]
    N -->|Success| P
    
    style C fill:#e3f2fd
    style F fill:#fff3e0
    style J fill:#f3e5f5
    style P fill:#e8f5e9
```

![Notification Multi-channel System](SÆ¡ Ä‘á»“ há»‡ thá»‘ng notification Ä‘a kÃªnh vá»›i Email vÃ  Webhook workers, retry mechanism)

**Notification Types vÃ  Prioritization:**

Há»‡ thá»‘ng Ä‘á»‹nh nghÄ©a báº£y loáº¡i notifications vá»›i priority levels khÃ¡c nhau. `event_reminder` notifications (15 phÃºt trÆ°á»›c event) cÃ³ priority `High` vÃ  Ä‘Æ°á»£c process vá»›i higher concurrency. `booking_created` notifications cÅ©ng cÃ³ priority `High` vÃ¬ liÃªn quan Ä‘áº¿n commitment giá»¯a hai ngÆ°á»i - delay cÃ³ thá»ƒ gÃ¢y hiá»ƒu láº§m. `sync_conflict` vÃ  `team_invitation` cÃ³ priority `Medium`, trong khi `event_created` cÃ³ priority `Low` vÃ¬ khÃ´ng time-sensitive.

Priority Ä‘Æ°á»£c implement thÃ´ng qua separate queues vá»›i different worker  configurations. High-priority queue cÃ³ concurrency 10 workers, Medium cÃ³ 5, Low cÃ³ 2. Cáº¥u hÃ¬nh nÃ y Ä‘áº£m báº£o critical notifications luÃ´n Ä‘Æ°á»£c process nhanh chÃ³ng ngay cáº£ khi system under load.

### **3.3.5. Webhook System Module**

Webhook System cho phÃ©p Calento integrate vá»›i external services theo event-driven pattern. Thay vÃ¬ external services pháº£i constantly poll Calento API Ä‘á»ƒ check updates, webhooks "push" notifications Ä‘áº¿n configured endpoints ngay khi events xáº£y ra.

**Configuration vÃ  Security:**

User configure webhooks qua dashboard UI, specify endpoint URL, select which event types muá»‘n subscribe (vÃ­ dá»¥: chá»‰ `booking.created` vÃ  `booking.cancelled`), vÃ  nháº­n má»™t secret key. Secret key nÃ y critical cho security - Ä‘Æ°á»£c sá»­ dá»¥ng Ä‘á»ƒ generate HMAC-SHA256 signature cho má»—i webhook payload. Receiver cÃ³ thá»ƒ verify signature báº±ng same secret Ä‘á»ƒ authenticate ráº±ng request thá»±c sá»± Ä‘áº¿n tá»« Calento, khÃ´ng pháº£i attacker.

System enforce HTTPS-only policy - webhook URLs pháº£i dÃ¹ng `https://` protocol. HTTP endpoints bá»‹ reject Ä‘á»ƒ prevent man-in-the-middle attacks. Rate limiting cÅ©ng Ä‘Æ°á»£c apply: maximum 100 webhooks per minute per user Ä‘á»ƒ prevent abuse vÃ  protect both Calento infrastructure vÃ  receiving endpoints.

**Delivery vÃ  Retry Logic:**

Khi má»™t webhook-eligible eventxáº£y ra (vÃ­ dá»¥: guest book appointment), Webhook Service construct payload theo predefined schema, generate HMAC signature, vÃ  attempt delivery qua HTTP POST request vá»›i 10-second timeout. Request headers include `X-Calento-Signature` (HMAC hash), `X-Calento-Event` (event type), vÃ  `Content-Type: application/json`.

Náº¿u request fails (network error, timeout, non-2xx response), retry mechanism kicks in vá»›i exponential backoff strategy. First retry sau 1 minute, second retry sau 5 minutes, third retry sau 15 minutes. Sau 3 failed attempts, webhook Ä‘Æ°á»£c mark failed vÃ  admin notification sent. Retry mechanism balance giá»¯a reliability (not giving up too quickly) vÃ  efficiency (not hammering failing endpoints).

```mermaid
sequenceDiagram
    participant E as Event Source
    participant WS as Webhook Service
    participant DB as Database
    participant EXT as External Endpoint
    
    E->>WS: Trigger: booking.created
    WS->>DB: Load webhook configs<br/>for event type
    DB-->>WS: configs[]
    
    loop For each config
        WS->>WS: Generate HMAC<br/>signature(secret, payload)
        
        WS->>EXT: POST webhook<br/>+ X-Calento-Signature<br/>+ X-Calento-Event
        
        alt Success (2xx)
            EXT-->>WS: 200 OK
            WS->>DB: Log: success
        else Failure
            EXT-->>WS: 500 Error / Timeout
            WS->>DB: Log: failed
            WS->>WS: Schedule retry<br/>(exponential backoff)
        end
    end
```

![Webhook Delivery Flow](SÆ¡ Ä‘á»“ tuáº§n tá»± delivery webhook vá»›i HMAC signature vÃ  retry mechanism)

**Payload Structure vÃ  Versioning:**

Webhook payloads follow consistent JSON schema vá»›i top-level fields: `event` (event type string), `timestamp` (ISO8601 UTC), vÃ  `data` (event-specific payload). VÃ­ dá»¥, `booking.created` payload chá»©a booking details (ID, link slug), guest information (name, email, phone), scheduled time (start, end, timezone), vÃ  optionally event metadata.

System support API versioning Ä‘á»ƒ maintain backward compatibility. Header `X-Calento-API-Version: v1` allows receivers biáº¿t schema version. Khi introduce breaking changes trong future, version 2 sáº½ Ä‘Æ°á»£c released vá»›i option cho users migrate at their own pace, avoiding sudden breakage cá»§a existing integrations.

* Queue Module: Cáº¥u hÃ¬nh BullMQ.  
* Email Module: Worker xá»­ lÃ½ viá»‡c gá»­i email notification báº¥t Ä‘á»“ng bá»™.  
* Sync Worker: Worker cháº¡y Ä‘á»‹nh ká»³ Ä‘á»ƒ Ä‘á»“ng bá»™ lá»‹ch tá»« Google Calendar vá» database ná»™i bá»™.

![][image15]

![][image16]

##### HÃ¬nh 14: Worker & Infrastructure {#hÃ¬nh-14:-worker-&-infrastructure}

## **3.3. Thiáº¿t káº¿ dá»¯ liá»‡u**

CÆ¡ sá»Ÿ dá»¯ liá»‡u PostgreSQL Ä‘Æ°á»£c thiáº¿t káº¿ tuÃ¢n theo nguyÃªn táº¯c chuáº©n hÃ³a (normalization) Ä‘á»ƒ Ä‘áº£m báº£o data integrity, giáº£m redundancy, vÃ  optimize performance. Äáº·c biá»‡t, database Ä‘Æ°á»£c má»Ÿ rá»™ng vá»›i extension `pgvector` Ä‘á»ƒ há»— trá»£ viá»‡c lÆ°u trá»¯ vÃ  tÃ¬m kiáº¿m vector embeddings - má»™t cÃ´ng nghá»‡ tiÃªn tiáº¿n phá»¥c vá»¥ cho tÃ­nh nÄƒng AI Retrieval-Augmented Generation (RAG).

### **3.3.1. PostgreSQL Extensions & Custom Types**

**Extensions:**

Há»‡ thá»‘ng sá»­ dá»¥ng hai PostgreSQL extensions quan trá»ng. Extension `uuid-ossp` cung cáº¥p functions Ä‘á»ƒ generate UUID (Universally Unique Identifiers) phiÃªn báº£n 4, Ä‘Æ°á»£c sá»­ dá»¥ng lÃ m primary keys cho táº¥t cáº£ tables thay vÃ¬ auto-increment integers. Lá»±a chá»n nÃ y mang láº¡i nhiá»u lá»£i Ã­ch: security cao hÆ¡n (khÃ´ng thá»ƒ predict ID tiáº¿p theo), support tá»‘t cho distributed systems (cÃ³ thá»ƒ generate offline mÃ  khÃ´ng lo collision), vÃ  thuáº­n tiá»‡n khi merge data tá»« nhiá»u sources.

Extension `pgvector` lÃ  ná»n táº£ng cho AI capabilities, cho phÃ©p store vÃ  query high-dimensional vector embeddings. Extension nÃ y provide vector data type support dimensionality lÃªn Ä‘áº¿n  16,000 dimensions (há»‡ thá»‘ng dÃ¹ng 768-dim), distance operators (cosine `<=>`, L2 `<->`, inner product `<#>`), vÃ  specialized indexes (HNSW, IVFFlat) cho approximate nearest neighbor search vá»›i performance cao.

**Custom ENUM Types:**

Database Ä‘á»‹nh nghÄ©a nÄƒm ENUM types Ä‘á»ƒ enforce data integrity táº¡i database level:

- `event_status`: confirmed, cancelled, tentative (cho tráº¡ng thÃ¡i events)
- `sync_status`: pull, push (tracking hÆ°á»›ng Ä‘á»“ng bá»™ Google Calendar)
- `sync_log_status`: success, failed, in_progress (monitor sync jobs)
- `provider_type`: google, outlook, apple (multi-provider support)
- `notification_channel`: email, slack, zalo, push (notification channels)

ENUM types giÃºp prevent invalid values, reduce storage (stored internally as integers), vÃ  improve query performance thÃ´ng qua compile-time type checking.

### **3.3.2. Entity Relationship Diagram**

Há»‡ thá»‘ng database bao gá»“m 18 core tables Ä‘Æ°á»£c tá»• chá»©c theo modules nghiá»‡p vá»¥, vá»›i relationships Ä‘Æ°á»£c define rÃµ rÃ ng qua foreign keys.

```mermaid
erDiagram
    users ||--o{ user_credentials : "has OAuth tokens"
    users ||--o{ user_settings : "has preferences"
    users ||--o{ calendars : "owns"
    users ||--o{ events : "creates"
    users ||--o{ tasks : "manages"
    users ||--o{ booking_links : "creates"
    users ||--o{ teams : "owns"
    users ||--o{ team_members : "member of"
    users ||--o{ user_context_summary : "AI embeddings"
    users ||--o{ blog_posts : "authors"
    
    calendars ||--o{ events : "contains"
    events ||--o{ event_attendees : "has attendees"
    events ||--o{ event_conflicts : "may have conflicts"
    
    booking_links ||--o{ availabilities : "defines schedule"
    booking_links ||--o{ bookings : "receives"
    bookings }o--|| events : "creates event"
    
    teams ||--o{ team_members : "has members"
    teams ||--o{ team_rituals : "holds rituals"
    
    blog_posts }o--|| blog_categories : "belongs to"
    blog_posts }o--o{ blog_tags : "tagged with"
    
    users {
        uuid id PK
        varchar email UK "RFC 5322 format"
        varchar username UK
        varchar password_hash "bcrypt with salt"
        varchar first_name
        varchar last_name
        boolean is_active "soft delete flag"
        boolean is_verified "email verified"
        timestamp created_at
        timestamp updated_at
    }
    
    user_credentials {
        uuid id PK
        uuid user_id FK
        enum provider_type "google/outlook/apple"
        varchar access_token "OAuth access"
        varchar refresh_token "OAuth refresh"
        timestamp expires_at
        boolean sync_enabled
        timestamp last_sync_at
    }
    
    calendars {
        uuid id PK
        uuid user_id FK
        varchar google_calendar_id "null for local"
        varchar name
        varchar color "hex code"
        varchar timezone "IANA format"
        boolean is_primary
    }
    
    events {
        uuid id PK
        uuid calendar_id FK
        uuid user_id FK "denormalized"
        varchar google_event_id "null for local"
        varchar title
        text description
        timestamp start_time
        timestamp end_time
        enum event_status
        text recurrence_rule "RRULE RFC 5545"
        boolean is_all_day
        varchar location
    }
    
    user_context_summary {
        uuid id PK
        uuid user_id FK
        text content "original text"
        vector embedding "768-dim vector"
        jsonb metadata "source info"
        timestamp created_at
    }
    
    booking_links {
        uuid id PK
        uuid user_id FK
        varchar slug UK "URL identifier"
        varchar title
        integer duration_minutes
        integer buffer_before
        integer buffer_after
        integer advance_notice
        boolean is_active
    }
    
    tasks {
        uuid id PK
        uuid user_id FK
        varchar title
        text description
        varchar priority "critical/high/medium/low"
        varchar status "todo/in_progress/completed"
        timestamp due_date
        integer order_index "drag-drop position"
    }
```

![Database Entity Relationship Diagram](SÆ¡ Ä‘á»“ ERD Ä‘áº§y Ä‘á»§ cá»§a há»‡ thá»‘ng Calento vá»›i 18 tables vÃ  relationships)

### **3.3.3. Database Migration Strategy: Raw SQL**

**Quyáº¿t Ä‘á»‹nh kiáº¿n trÃºc: Táº¡i sao dÃ¹ng Raw SQL thay vÃ¬ Prisma?**

Há»‡ thá»‘ng Calento sá»­ dá»¥ng raw SQL migrations trong `server/migrations/schema.sql` thay vÃ¬ ORM nhÆ° Prisma, máº·c dÃ¹ Prisma  ráº¥t phá»• biáº¿n trong NestJS ecosystem. Quyáº¿t Ä‘á»‹nh nÃ y dá»±a trÃªn bá»‘n lÃ½ do ká»¹ thuáº­t quan trá»ng.

**LÃ½ do 1: Advanced PostgreSQL Features**

Prisma Schema Language (PSL) cÃ³ limitations vá»›i advanced PostgreSQL features. Extension `pgvector` cho vector embeddings khÃ´ng Ä‘Æ°á»£c Prisma native support - pháº£i dÃ¹ng raw SQL hoáº·c unsafe typing. Custom ENUM types, specialized indexes (HNSW, GIN, GIST), vÃ  triggers cÅ©ng khÃ³ express Ä‘áº§y Ä‘á»§ trong PSL. Raw SQL cho phÃ©p leverage full power cá»§a PostgreSQL mÃ  khÃ´ng bá»‹ giá»›i háº¡n bá»Ÿi ORM abstractions.

**LÃ½ do 2: Migration Control & Transparency**

Raw SQL migrations cung cáº¥p explicit control vÃ  transparency. Developers tháº¥y chÃ­nh xÃ¡c DDL statements Ä‘Æ°á»£c execute, dá»… review trong code review, vÃ  cÃ³ thá»ƒ optimize tá»«ng migration statement. Prisma migrations auto-generated Ä‘Ã´i khi produce suboptimal SQL hoáº·c unexpected changes, Ä‘áº·c biá»‡t vá»›i complex schema modifications nhÆ° column type changes hoáº·c data migrations.

**LÃ½ do 3: Performance Optimization**

Database design cá»§a Calento heavily optimized cho specific access  patterns. Events table cÃ³ composite indexes `(user_id, start_time, end_time)` cho time-range queries, partial indexes cho conditional filtering, vÃ  HNSW index configuration tuned cho 768-dim vectors. Raw SQL allows fine-grained control over index types, fill factors, vÃ  storage parameters mÃ  Prisma khÃ´ng expose Ä‘áº§y Ä‘á»§.

**LÃ½ do 4: Team Expertise & Maintainability**

Team cÃ³ deep PostgreSQL expertise vÃ  prefer SQL-first approach. Raw migrations dá»… debug khi cÃ³ issues (direct psql execution), portable across environments (khÃ´ng depend on Prisma version), vÃ  cÃ³ thá»ƒ reuse existing PostgreSQL knowledge/tools. Migration files cÅ©ng serve as documentation - clear, readable SQL statements miÃªu táº£ exact schema structure.

**Migration Execution:**

Migrations Ä‘Æ°á»£c run manual hoáº·c automated trong CI/CD pipeline:

```bash
# Development
psql -U postgres -d calento < server/migrations/schema.sql

# Production (vá»›i transaction safety)
psql -U postgres -d calento_prod -v ON_ERROR_STOP=1 -f schema.sql
```

Schema file Ä‘Æ°á»£c tá»• chá»©c theo modules vá»›i comments rÃµ rÃ ng, shared functions (nhÆ° `update_updated_at_column()`), vÃ  IF NOT EXISTS clauses Ä‘á»ƒ support idempotency.



| STT | Table Name | MÃ´ táº£ | Columns chÃ­nh | Records Æ°á»›c tÃ­nh |
| :---: | ----- | ----- | ----- | ----- |
| 1 | users | ThÃ´ng tin tÃ i khoáº£n ngÆ°á»i dÃ¹ng | id, email, username, password_hash, avatar, full_name | 1,000-10,000 |
| 2 | user_credentials | OAuth tokens (Google Calendar) | id, user_id, provider, access_token, refresh_token, expires_at | 500-5,000 |
| 3 | user_settings | Preferences ngÆ°á»i dÃ¹ng (JSONB) | id, user_id, settings (JSONB) | 1,000-10,000 |
| 4 | calendars | Metadata lá»‹ch Ä‘á»“ng bá»™ tá»« Google | id, user_id, google_calendar_id, name, timezone, is_primary | 2,000-20,000 |
| 5 | events | Sá»± kiá»‡n (synced hoáº·c local) | id, calendar_id, google_event_id, title, start_time, end_time, recurrence_rule, status | 50,000-500,000 |
| 6 | event_attendees | NgÆ°á»i tham dá»± sá»± kiá»‡n vá»›i invitation tracking | id, event_id, email, name, response_status, invitation_token | 20,000-200,000 |
| 7 | event_conflicts | Xá»­ lÃ½ conflicts khi Ä‘á»“ng bá»™ | id, user_id, calento_event_id, google_event_id, conflict_reason, resolution | 100-1,000 |
| 8 | availabilities | Khung giá» ráº£nh hÃ ng tuáº§n cá»§a user | id, user_id, day_of_week, start_time, end_time, timezone | 5,000-50,000 |
| 9 | booking_links | Trang Ä‘áº·t lá»‹ch cÃ´ng khai | id, user_id, slug, title, duration_minutes, advance_notice_hours | 2,000-20,000 |
| 10 | bookings | Lá»‹ch háº¹n tá»« booking links | id, booking_link_id, user_id, event_id, booker_name, booker_email, start_time, status | 10,000-100,000 |
| 11 | tasks | CÃ´ng viá»‡c cáº§n lÃ m (To-do) | id, user_id, title, status, priority, due_date, recurrence_rule | 20,000-200,000 |
| 12 | user_priorities | Æ¯u tiÃªn cho tasks/items trong priority board | id, user_id, item_id, item_type, priority, position | 10,000-100,000 |
| 13 | teams | ThÃ´ng tin nhÃ³m (collaborative) | id, name, owner_id, timezone, settings (JSONB), is_active | 500-5,000 |
| 14 | team_members | ThÃ nh viÃªn nhÃ³m | id, team_id, user_id, role, status | 2,000-20,000 |
| 15 | team_rituals | Cuá»™c há»p Ä‘á»‹nh ká»³ cá»§a team | id, team_id, title, recurrence_rule, rotation_type | 1,000-10,000 |
| 16 | blog_posts | BÃ i viáº¿t blog/CMS | id, title, slug, content, author_id, category_id, status, published_at | 100-1,000 |
| 17 | blog_categories | Danh má»¥c blog | id, name, slug, description | 10-50 |
| 18 | blog_tags | Tags cho bÃ i viáº¿t | id, name, slug, usage_count | 50-500 |

### **3.3.3. Má»‘i quan há»‡ dá»¯ liá»‡u** 

* 1 User cÃ³ nhiá»u Calendars.  
* 1 Calendar chá»©a nhiá»u Events.  
* 1 User cÃ³ nhiá»u Context Summaries (cho RAG).  
* 1 User táº¡o nhiá»u Booking Links.
* 1 Event cÃ³ nhiá»u Event Attendees.
* 1 User cÃ³ nhiá»u Tasks.
* 1 Team cÃ³ nhiá»u Team Members vÃ  Team Rituals.
* 1 Blog Post thuá»™c 1 Category vÃ  cÃ³ nhiá»u Tags.

### **3.3.4. Luá»“ng xá»­ lÃ½ nghiá»‡p vá»¥ chÃ­nh**

#### **Luá»“ng 1: Äá»“ng bá»™ Google Calendar (Bi-directional Sync)**

```
[User káº¿t ná»‘i Google] 
   â†“
[LÆ°u OAuth tokens vÃ o user_credentials]
   â†“
[Background Job - BullMQ] (Cháº¡y Ä‘á»‹nh ká»³ 5 phÃºt)
   â”œâ”€â†’ PULL: Google Calendar API â†’ Láº¥y events má»›i/updated
   â”‚     â”œâ”€â†’ So sÃ¡nh vá»›i DB (dá»±a google_event_id, synced_at)
   â”‚     â”œâ”€â†’ PhÃ¡t hiá»‡n conflicts â†’ LÆ°u event_conflicts
   â”‚     â””â”€â†’ Táº¡o/cáº­p nháº­t events trong DB
   â”‚
   â””â”€â†’ PUSH: Láº¥y events local (google_event_id = NULL)
         â””â”€â†’ Äáº©y lÃªn Google Calendar â†’ Cáº­p nháº­t google_event_id
```

**Chi tiáº¿t ká»¹ thuáº­t:**
- Module: `google.service.ts`, `calendar.service.ts`
- Queue: `sync-calendar` queue trong BullMQ
- Error handling: Retry mechanism (3 láº§n), exponential backoff
- Conflict resolution: User chá»n prefer_google/prefer_calento/keep_both

#### **Luá»“ng 2: Äáº·t lá»‹ch qua Booking Link**

```
[User A táº¡o booking link] â†’ /dashboard/booking
   â”œâ”€â†’ Thiáº¿t láº­p: duration, buffer_time, max_bookings/day
   â””â”€â†’ Public URL: calento.space/book/username/slug

[User B truy cáº­p link]
   â†“
[Query availabilities cá»§a User A] + [Lá»c events Ä‘Ã£ cÃ³]
   â†“
[TÃ­nh available slots] â†’ Hiá»ƒn thá»‹ calendar
   â†“
[User B chá»n slot + Ä‘iá»n info] â†’ Submit
   â†“
[Server xá»­ lÃ½]
   â”œâ”€â†’ Táº¡o booking record (status: confirmed)
   â”œâ”€â†’ Táº¡o event cho User A
   â”œâ”€â†’ Gá»­i email confirmation (2 bÃªn)
   â””â”€â†’ [Náº¿u Google connected] â†’ Push event lÃªn Google Calendar
```

**Chi tiáº¿t ká»¹ thuáº­t:**
- Module: `booking.service.ts`, `availability.service.ts`
- Email template: `booking-confirmation.hbs` (Handlebars)
- Validation: Kiá»ƒm tra overlap, advance_notice, max_bookings
- Transaction: Sá»­ dá»¥ng PostgreSQL transaction Ä‘á»ƒ Ä‘áº£m báº£o atomic

#### **Luá»“ng 3: AI Assistant vá»›i RAG (Chat)**

```
[User há»i: "TÃ´i cÃ³ meeting nÃ o tuáº§n sau?"]
   â†“
POST /api/v1/ai/chat
   â†“
[RAG Service]
   â”œâ”€â†’ Vector search: TÃ¬m relevant events (pgvector similarity)
   â”œâ”€â†’ Láº¥y top 5 events (score > 0.7)
   â””â”€â†’ Construct context: events data + user profile

[LLM Service - Gemini]
   â”œâ”€â†’ System prompt + User question + Context
   â”œâ”€â†’ Function calling: XÃ¡c Ä‘á»‹nh intent (search/create/summary)
   â””â”€â†’ Generate response (streaming)

[Server-Sent Events (SSE)]
   â””â”€â†’ Stream response vá» frontend â†’ Real-time display
```

**Chi tiáº¿t ká»¹ thuáº­t:**
- Module: `llm.service.ts`, `rag.service.ts`, `vector.service.ts`
- Model: Gemini 2 Flash vá»›i function calling
- Embeddings: text-embedding-004 (768 dimensions)
- Similarity search: Cosine similarity trong pgvector

### **3.3.5. SÆ¡ Ä‘á»“ tuáº§n tá»± (Sequence Diagrams)**

Äá»ƒ hiá»ƒu rÃµ hÆ¡n vá» tÆ°Æ¡ng tÃ¡c giá»¯a cÃ¡c thÃ nh pháº§n trong há»‡ thá»‘ng, cÃ¡c sÆ¡ Ä‘á»“ tuáº§n tá»± (sequence diagrams) sau Ä‘Ã¢y mÃ´ táº£ chi tiáº¿t luá»“ng xá»­ lÃ½ cá»§a cÃ¡c tÃ­nh nÄƒng quan trá»ng.

#### ** Sequen Diagram 1: AI Chatbot vá»›i RAG (Retrieval-Augmented Generation)**

```mermaid
sequenceDiagram
    participant U as User (Frontend)
    participant API as API Gateway
    participant AI as AI Controller
    participant RAG as RAG Service
    participant VEC as Vector Service
    participant DB as PostgreSQL (pgvector)
    participant LLM as Gemini LLM Service
    participant SSE as SSE Stream

    U->>API: POST /api/v1/ai/chat<br/>{message: "TÃ´i cÃ³ báº­n vÃ o thá»© 5?"}
    API->>AI: authenticateUser()<br/>validateInput()
    
    Note over AI,RAG: Phase 1: Retrieval (TÃ¬m kiáº¿m context)
    AI->>RAG: processConvers ation(userId, message)
    RAG->>VEC: generateEmbedding(message)
    VEC-->>RAG: vector[768]
    
    RAG->>DB: SELECT * FROM events<br/>WHERE user_id = ?<br/>ORDER BY embedding <=> vector<br/>LIMIT 5
    DB-->>RAG: relevantEvents[]
    
    Note over RAG: Context: 5 events vá»›i similarity > 0.7
    
    Note over AI,LLM: Phase 2: Augmentation (XÃ¢y dá»±ng prompt)
    RAG->>LLM: constructPrompt(systemPrompt, context, userMessage)
    Note over LLM: System: "Báº¡n lÃ  AI assistant..."<br/>Context: JSON cá»§a 5 events<br/>Question: "TÃ´i cÃ³ báº­n vÃ o thá»© 5?"
    
    Note over LLM: Phase 3: Generation (Streaming response)
    LLM->>LLM: callGeminiAPI(prompt, stream=true)
    LLM-->>SSE: chunk 1: "Dá»±a vÃ o lá»‹ch..."
    SSE-->>U: SSE event-stream
    LLM-->>SSE: chunk 2: "báº¡n cÃ³ 2 meetings..."
    SSE-->>U: SSE event-stream
    LLM-->>SSE: chunk 3: "[DONE]"
    SSE-->>U: SSE close
    
    Note over U: Hiá»ƒn thá»‹ markdown real-time
```

**Giáº£i thÃ­ch chi tiáº¿t:**

1. **Request Phase**: User gá»­i cÃ¢u há»i tá»« chat interface, API authenticate JWT token vÃ  validate input.

2. **Retrieval Phase**: RAG Service chuyá»ƒn cÃ¢u há»i thÃ nh vector embedding 768-chiá»u sá»­ dá»¥ng model `text-embedding-004`. Vector nÃ y Ä‘Æ°á»£c so sÃ¡nh vá»›i embeddings cá»§a táº¥t cáº£ events trong database sá»­ dá»¥ng toÃ¡n tá»­ `<=>` (cosine distance) cá»§a pgvector. Top 5 events cÃ³ similarity cao nháº¥t (> 0.7) Ä‘Æ°á»£c láº¥y ra lÃ m context.

3. **Augmentation Phase**: Context events Ä‘Æ°á»£c format thÃ nh JSON vÃ  Ä‘Æ°a vÃ o prompt template cÃ¹ng vá»›i system instruction vÃ  user question. Prompt hoÃ n chá»‰nh Ä‘Æ°á»£c gá»­i Ä‘áº¿n Gemini API.

4. **Generation Phase**: Gemini xá»­ lÃ½ prompt vÃ  tráº£ vá» response dÆ°á»›i dáº¡ng streaming. Má»—i chunk text Ä‘Æ°á»£c forward qua Server-Sent Events (SSE) vá» frontend ngay láº­p tá»©c, táº¡o tráº£i nghiá»‡m real-time tÆ°Æ¡ng tá»± ChatGPT.

#### **Sequence Diagram 2: Äá»“ng bá»™ Google Calendar (Bi-directional Sync)**

```mermaid
sequenceDiagram
    participant BG as Background Job (BullMQ)
    participant SYNC as Sync Service
    participant DB as PostgreSQL
    participant GCAL as Google Calendar API
    participant CONF as Conflict Resolver
    participant NOTIFY as Notification Service

    Note over BG: Cron job cháº¡y má»—i 5 phÃºt
    
    BG->>SYNC: triggerSync(userId)
    SYNC->>DB: getUserCredentials(userId)
    DB-->>SYNC: {accessToken, refreshToken}
    
    rect rgb(200, 220, 255)
        Note over SYNC,GCAL: PULL Phase: Google â†’ Calento
        SYNC->>GCAL: GET /calendars/{id}/events<br/>?updatedMin=lastSyncTime
        GCAL-->>SYNC: events[] (200 OK)
        
        loop Má»—i event tá»« Google
            SYNC->>DB: findEventByGoogleId(eventId)
            alt Event chÆ°a tá»“n táº¡i
                SYNC->>DB: INSERT INTO events<br/>(google_event_id, ...)
            else Event Ä‘Ã£ tá»“n táº¡i nhÆ°ng updated
                SYNC->>SYNC: compareEvent(dbEvent, googleEvent)
                alt CÃ³ conflict
                    SYNC->>CONF: detectConflict(dbEvent, googleEvent)
                    CONF->>DB: INSERT INTO event_conflicts
                    CONF->>NOTIFY: notifyUser(conflict)
                else KhÃ´ng conflict
                    SYNC->>DB: UPDATE events SET ...<br/>WHERE google_event_id = ?
                end
            end
        end
    end
    
    rect rgb(255, 220, 200)
        Note over SYNC,GCAL: PUSH Phase: Calento â†’ Google
        SYNC->>DB: SELECT * FROM events<br/>WHERE google_event_id IS NULL<br/>AND user_id = ?
        DB-->>SYNC: localEvents[]
        
        loop Má»—i local event
            SYNC->>GCAL: POST /calendars/{id}/events<br/>{title, start, end, ...}
            GCAL-->>SYNC: {id: "google123"} (201 Created)
            SYNC->>DB: UPDATE events<br/>SET google_event_id = 'google123'<br/>WHERE id = ?
        end
    end
    
    SYNC->>DB: UPDATE user_credentials<br/>SET last_sync_at = NOW()
    SYNC-->>BG: syncCompleted(summary)
```

**Giáº£i thÃ­ch luá»“ng Ä‘á»“ng bá»™:**

1. **PULL Phase (Google â†’ Calento)**: Background job láº¥y events tá»« Google Calendar API vá»›i tham sá»‘ `updatedMin` Ä‘á»ƒ chá»‰ fetch events Ä‘Ã£ thay Ä‘á»•i tá»« láº§n sync cuá»‘i. Má»—i event Ä‘Æ°á»£c so sÃ¡nh vá»›i database:
   - Náº¿u chÆ°a tá»“n táº¡i â†’ INSERT má»›i
   - Náº¿u Ä‘Ã£ tá»“n táº¡i â†’ So sÃ¡nh timestamps vÃ  content
   - Náº¿u phÃ¡t hiá»‡n conflict (cáº£ 2 phÃ­a Ä‘á»u update) â†’ LÆ°u vÃ o `event_conflicts` table vÃ  notify user

2. **PUSH Phase (Calento â†’ Google)**: TÃ¬m táº¥t cáº£ events cÃ³ `google_event_id = NULL` (local-only events) vÃ  Ä‘áº©y lÃªn Google Calendar. Sau khi push thÃ nh cÃ´ng, lÆ°u `google_event_id` vÃ o database.

3. **Error Handling**: Náº¿u `accessToken` expired, tá»± Ä‘á»™ng refresh báº±ng `refreshToken`. Náº¿u API rate limit â†’ exponential backoff vÃ  retry.

#### **Sequence Diagram 3: Public Booking Flow (Guest Ä‘áº·t lá»‹ch)**

```mermaid
sequenceDiagram
    participant G as Guest
    participant PUB as Public Booking Page
    participant API as Booking API
    participant AVAIL as Availability Service
    participant DB as PostgreSQL
    participant EMAIL as Email Service
    participant GCAL as Google Calendar API

    G->>PUB: Truy cáº­p /book/username/slug
    PUB->>API: GET /booking-links/:slug
    API->>DB: findBookingLink(slug)
    DB-->>API: bookingLink {duration, buffer, ...}
    API-->>PUB: bookingLinkData
    
    PUB->>API: GET /booking-links/:id/slots<br/>?startDate=2026-01-20
    API->>AVAIL: calculateAvailableSlots(userId, dateRange)
    
    rect rgb(220, 255, 220)
        Note over AVAIL,DB: TÃ­nh toÃ¡n slots ráº£nh
        AVAIL->>DB: SELECT * FROM availabilities<br/>WHERE user_id = ?
        DB-->>AVAIL: weeklySchedule[]
        
        AVAIL->>DB: SELECT * FROM events<br/>WHERE user_id = ?<br/>AND start_time BETWEEN ? AND ?
        DB-->>AVAIL: existingEvents[]
        
        AVAIL->>AVAIL: computeFreeSlots(<br/>weeklySchedule,<br/>existingEvents,<br/>duration + buffer<br/>)
    end
    
    AVAIL-->>API: availableSlots[]
    API-->>PUB: slots: [{start, end}, ...]
    
    G->>PUB: Chá»n slot + Ä‘iá»n form<br/>{name, email, notes}
    PUB->>API: POST /bookings<br/>{slotTime, guestInfo}
    
    API->>API: validateSlot(still available?)
    API->>DB: BEGIN TRANSACTION
    
    API->>DB: INSERT INTO bookings<br/>(link_id, start_time, ...)
    DB-->>API: booking {id, ...}
    
    API->>DB: INSERT INTO events<br/>(title, start_time, ...)
    DB-->>API: event {id, ...}
    
    API->>DB: UPDATE bookings<br/>SET event_id = ?
    API->>DB: COMMIT TRANSACTION
    
    par Email notifications
        API->>EMAIL: sendBookingConfirmation(guest)
        EMAIL-->>G: Email "Booking confirmed..."
    and
        API->>EMAIL: sendBooking Notification(host)
        EMAIL-->>G: Email "New booking from..."
    end
    
    opt Náº¿u host káº¿t ná»‘i Google
        API->>GCAL: POST /events (push event)
        GCAL-->>API: {id: "google123"}
    end
    
    API-->>PUB: 201 Created {bookingId}
    PUB-->>G: "Äáº·t lá»‹ch thÃ nh cÃ´ng!"
```

**CÃ¡c Ä‘iá»ƒm quan trá»ng:**

1. **Availability Calculation**: Há»‡ thá»‘ng káº¿t há»£p `availabilities` table (weekly schedule) vá»›i `events` table (actual events) Ä‘á»ƒ tÃ­nh cÃ¡c slots trá»‘ng. Buffer time Ä‘Æ°á»£c apply trÆ°á»›c vÃ  sau má»—i slot.

2. **Double-check Validation**: TrÆ°á»›c khi táº¡o booking, re-validate slot váº«n available (trÃ¡nh race condition khi 2 ngÆ°á»i book cÃ¹ng lÃºc).

3. **Transaction Safety**: Sá»­ dá»¥ng database transaction Ä‘á»ƒ Ä‘áº£m báº£o booking vÃ  event Ä‘Æ°á»£c táº¡o atomic. Náº¿u má»™t trong hai fails â†’ rollback cáº£ hai.

4. **Parallel Email**: Gá»­i email cho guest vÃ  host song song (khÃ´ng chá» Ä‘á»£i) Ä‘á»ƒ giáº£m response time.

#### **Sequence Diagram 4: AI Function Calling (Create Event)**

```mermaid
sequenceDiagram
    participant U as User
    participant AI as AI Controller
    participant LLM as Gemini LLM
    participant FC as Function Call Handler
    participant EVENT as Event Service
    participant DB as PostgreSQL

    U->>AI: "Äáº·t lá»‹ch há»p team vÃ o 9h sÃ¡ng thá»© 2"
    AI->>LLM: chat(message, tools=[createEvent])
    
    Note over LLM: Gemini phÃ¢n tÃ­ch intent
    LLM-->>AI: functionCall {<br/>  name: "createEvent",<br/>  args: {<br/>    title: "Há»p team",<br/>    start: "2026-01-20T09:00:00",<br/>    duration: 60<br/>  }<br/>}
    
    AI->>FC: executeFunctionCall(createEvent, args)
    FC->>FC: confirmWithUser(args)
    FC-->>U: "Táº¡o sá»± kiá»‡n:<br/>ğŸ“… Há»p team<br/>â° 20/01 9:00 AM<br/>XÃ¡c nháº­n?"
    
    U-->>FC: "Yes" (confirm)
    
    FC->>EVENT: createEvent(userId, eventData)
    EVENT->>DB: INSERT INTO events (...)
    DB-->>EVENT: event {id, ...}
    EVENT -->>FC: success(event)
    
    FC-->>AI: functionResult {<br/>  success: true,<br/>  eventId: "uuid123"<br/>}
    
    AI->>LLM: chat(functionResult)
    LLM-->>AI: "ÄÃ£ táº¡o sá»± kiá»‡n 'Há»p team'<br/>vÃ o thá»© 2, 20/01 lÃºc 9:00 AM."
    
    AI-->>U: Display AI response
```

**Function Calling Flow:**

1. **Intent Detection**: LLM nháº­n diá»‡n user muá»‘n create event, extract parameters (title, time) tá»« natural language.

2. **Confirmation**: TrÆ°á»›c khi execute, hiá»ƒn thá»‹ preview Ä‘á»ƒ user confirm (trÃ¡nh táº¡o nháº§m).

3. **Execution**: Call Event Service Ä‘á»ƒ thá»±c sá»± táº¡o event trong database.

4. **Response**: Káº¿t quáº£ Ä‘Æ°á»£c tráº£ vá» AI, AI generate human-readable confirmation message.



## **3.4. Thiáº¿t káº¿ API**

Há»‡ thá»‘ng Calento cung cáº¥p má»™t bá»™ RESTful API toÃ n diá»‡n, Ä‘Æ°á»£c thiáº¿t káº¿ xoay quanh cÃ¡c tÃ i nguyÃªn (resources) vÃ  tuÃ¢n thá»§ cháº·t cháº½ cÃ¡c nguyÃªn táº¯c kiáº¿n trÃºc REST. API Ä‘Ã³ng vai trÃ² lÃ  xÆ°Æ¡ng sá»‘ng giao tiáº¿p giá»¯a frontend (Next.js) vÃ  backend (NestJS), cÅ©ng nhÆ° cho phÃ©p cÃ¡c integrations tá»« bÃªn thá»© ba trong tÆ°Æ¡ng lai.

### **3.4.1. Kiáº¿n trÃºc vÃ  NguyÃªn lÃ½ thiáº¿t káº¿**

API cá»§a Calento Ä‘Æ°á»£c xÃ¢y dá»±ng dá»±a trÃªn kiáº¿n trÃºc Layered Architecture cá»§a NestJS, Ä‘áº£m báº£o tÃ­nh separation of concerns. Má»i endpoint Ä‘á»u tuÃ¢n theo quy táº¯c Ä‘áº·t tÃªn danh tá»« sá»‘ nhiá»u (plural nouns) Ä‘á»ƒ chá»‰ Ä‘á»‹nh tÃ i nguyÃªn (vÃ­ dá»¥: `/users`, `/events`) vÃ  sá»­ dá»¥ng cÃ¡c HTTP verbs chuáº©n (`GET`, `POST`, `PATCH`, `DELETE`) Ä‘á»ƒ Ä‘á»‹nh nghÄ©a hÃ nh Ä‘á»™ng.

Dá»¯ liá»‡u trao Ä‘á»•i giá»¯a client vÃ  server hoÃ n toÃ n sá»­ dá»¥ng Ä‘á»‹nh dáº¡ng JSON (JavaScript Object Notation), Ä‘áº£m báº£o tÃ­nh lightweight vÃ  dá»… dÃ ng parsing trÃªn má»i ná»n táº£ng. Má»—i response tá»« server Ä‘á»u cÃ³ structure nháº¥t quÃ¡n, bao gá»“m `statusCode`, `message`, vÃ  `data` (Ä‘á»‘i vá»›i success response) hoáº·c `error` details (Ä‘á»‘i vá»›i failure), giÃºp frontend dá»… dÃ ng handle cÃ¡c tráº¡ng thÃ¡i khÃ¡c nhau cá»§a application.

### **3.4.2. CÆ¡ cháº¿ XÃ¡c thá»±c vÃ  Báº£o máº­t**

Báº£o máº­t lÃ  Æ°u tiÃªn hÃ ng Ä‘áº§u trong thiáº¿t káº¿ API. Há»‡ thá»‘ng sá»­ dá»¥ng cÆ¡ cháº¿ xÃ¡c thá»±c dá»±a trÃªn token (Token-based Authentication) vá»›i chuáº©n JWT (JSON Web Tokens).

**Bearer Token Authentication:**
Má»i request Ä‘áº¿n cÃ¡c protected endpoints Ä‘á»u báº¯t buá»™c pháº£i Ä‘Ã­nh kÃ¨m Access Token há»£p lá»‡ trong header `Authorization` dÆ°á»›i dáº¡ng `Bearer <token>`. Access Token nÃ y chá»©a cÃ¡c claims Ä‘Ã£ Ä‘Æ°á»£c kÃ½ (userId, email, role), cho phÃ©p server xÃ¡c Ä‘á»‹nh danh tÃ­nh user mÃ  khÃ´ng cáº§n tra cá»©u database liÃªn tá»¥c (stateless authentication).

**Refresh Token Rotation:**
Äá»ƒ cÃ¢n báº±ng giá»¯a UX vÃ  báº£o máº­t, Access Token cÃ³ thá»i gian sá»‘ng ngáº¯n (1 giá»). Khi háº¿t háº¡n, client sá»­ dá»¥ng Refresh Token (thá»i háº¡n 7 ngÃ y, lÆ°u trong HttpOnly cookie) Ä‘á»ƒ request cáº¥p phÃ¡t cáº·p token má»›i. CÆ¡ cháº¿ rotation nÃ y (cáº¥p má»›i cáº£ refresh token má»—i láº§n sá»­ dá»¥ng) giÃºp detect token theft: náº¿u má»™t refresh token cÅ© bá»‹ sá»­ dá»¥ng láº¡i, há»‡ thá»‘ng sáº½ láº­p tá»©c invalidate toÃ n bá»™ chuá»—i token cá»§a user Ä‘Ã³.

**Rate Limiting vÃ  Security Headers:**
Äá»ƒ báº£o vá»‡ há»‡ thá»‘ng khá»i cÃ¡c cuá»™c táº¥n cÃ´ng DDoS vÃ  Brute-force, API Ã¡p dá»¥ng rate limiting (giá»›i háº¡n sá»‘ request) cho cÃ¡c endpoints nháº¡y cáº£m nhÆ° `/auth/login` hay `/auth/register`. NgoÃ i ra, cÃ¡c security headers nhÆ° Helmet, CORS (Cross-Origin Resource Sharing) policies Ä‘Æ°á»£c cáº¥u hÃ¬nh cháº·t cháº½, chá»‰ cho phÃ©p requests tá»« cÃ¡c domains tin cáº­y (frontend domain).

### **3.4.3. Chiáº¿n lÆ°á»£c PhiÃªn báº£n hÃ³a (Versioning)**

Äá»ƒ Ä‘áº£m báº£o tÃ­nh tÆ°Æ¡ng thÃ­ch ngÆ°á»£c (backward compatibility) khi há»‡ thá»‘ng phÃ¡t triá»ƒn, Calento Ã¡p dá»¥ng chiáº¿n lÆ°á»£c phiÃªn báº£n hÃ³a qua URL (URI Path Versioning). Táº¥t cáº£ cÃ¡c endpoints Ä‘á»u cÃ³ prefix `/api/v1`.

Chiáº¿n lÆ°á»£c nÃ y cho phÃ©p team phÃ¡t triá»ƒn deploy cÃ¡c tÃ­nh nÄƒng má»›i hoáº·c thay Ä‘á»•i breaking changes á»Ÿ `/api/v2` trong tÆ°Æ¡ng lai mÃ  khÃ´ng lÃ m giÃ¡n Ä‘oáº¡n tráº£i nghiá»‡m cá»§a ngÆ°á»i dÃ¹ng Ä‘ang sá»­ dá»¥ng phiÃªn báº£n cÅ©. ÄÃ¢y lÃ  best practice trong thiáº¿t káº¿ API cho cÃ¡c há»‡ thá»‘ng long-term, giÃºp decouple vÃ²ng Ä‘á»i phÃ¡t triá»ƒn cá»§a frontend vÃ  backend.

### **3.4.4. CÃ¡c nhÃ³m tÃ i nguyÃªn chÃ­nh**

Há»‡ thá»‘ng API Ä‘Æ°á»£c tá»• chá»©c thÃ nh cÃ¡c nhÃ³m module function-centric:

**Auth & Users Module:**
Bao gá»“m cÃ¡c endpoints cho quy trÃ¬nh authentication (Login, Register, OAuth callback) vÃ  quáº£n lÃ½ identity. CÃ¡c endpoints nhÆ° `GET /users/me` cho phÃ©p láº¥y full profile cá»§a logged-in user, trong khi `PATCH /users/me/settings` cho phÃ©p update preferences linh hoáº¡t thÃ´ng qua JSONB storage.

**Calendar & Events Module:**
ÄÃ¢y lÃ  nhÃ³m API phá»©c táº¡p nháº¥t, xá»­ lÃ½ logic nghiá»‡p vá»¥ cá»‘t lÃµi. NgoÃ i cÃ¡c CRUD operations cÆ¡ báº£n cho events, module nÃ y cung cáº¥p cÃ¡c endpoints Ä‘áº·c thÃ¹ nhÆ° `/events/sync` Ä‘á»ƒ trigger Google Calendar synchronization, `/events/recurring/expand` Ä‘á»ƒ tÃ­nh toÃ¡n cÃ¡c instances cá»¥ thá»ƒ tá»« má»™t recurring rule (RRULE), vÃ  `/events/availability` Ä‘á»ƒ kiá»ƒm tra xung Ä‘á»™t lá»‹ch trÃ¬nh.

**Public Booking Module:**
NhÃ³m API nÃ y phá»¥c vá»¥ tÃ­nh nÄƒng Ä‘áº·t lá»‹ch cÃ´ng khai. CÃ¡c endpoints nhÆ° `/booking-links/:slug` lÃ  public (khÃ´ng yÃªu cáº§u auth), cho phÃ©p khÃ¡ch truy cáº­p xem thÃ´ng tin trang Ä‘áº·t lá»‹ch. Endpoint `/bookings` xá»­ lÃ½ transaction phá»©c táº¡p: táº¡o booking record, táº¡o event tÆ°Æ¡ng á»©ng, gá»­i emails xÃ¡c nháº­n, vÃ  update Google Calendar náº¿u cáº§n thiáº¿t.

**AI Integration Module:**
Cung cáº¥p cÃ¡c endpoints cho tÃ­nh nÄƒng AI Assistant. Endpoint `/ai/chat` há»— trá»£ Server-Sent Events (SSE), cho phÃ©p streaming response tá»« LLM vá» client theo thá»i gian thá»±c (real-time typing effect). Endpoint nÃ y cÅ©ng handle logic RAG: nháº­n cÃ¢u há»i, gá»i vector search service, vÃ  inject context vÃ o prompt trÆ°á»›c khi gá»­i Ä‘áº¿n Gemini model.

## **3.5. CÃ i Ä‘áº·t mÃ´i trÆ°á»ng**

Äá»ƒ triá»ƒn khai vÃ  phÃ¡t triá»ƒn há»‡ thá»‘ng Calento, mÃ´i trÆ°á»ng cáº§n Ä‘Ã¡p á»©ng cÃ¡c yÃªu cáº§u pháº§n má»m cá»¥ thá»ƒ vÃ  tuÃ¢n theo quy trÃ¬nh cÃ i Ä‘áº·t chuáº©n hÃ³a.

### **3.5.1. YÃªu cáº§u há»‡ thá»‘ng (Prerequisites)**

Há»‡ thá»‘ng yÃªu cáº§u cÃ¡c thÃ nh pháº§n core sau Ä‘Ã¢y Ä‘á»ƒ hoáº¡t Ä‘á»™ng chÃ­nh xÃ¡c:

**Node.js (Runtime Environment):**
YÃªu cáº§u phiÃªn báº£n 18.x hoáº·c má»›i hÆ¡n (LTS). Node.js lÃ  runtime environment cho cáº£ backend (NestJS) vÃ  frontend (Next.js). PhiÃªn báº£n 18+ há»— trá»£ native fetch API vÃ  cÃ¡c tÃ­nh nÄƒng performance má»›i nháº¥t cá»§a V8 engine.

**PostgreSQL (Database):**
YÃªu cáº§u phiÃªn báº£n 15.x trá»Ÿ lÃªn. Äáº·c biá»‡t, database pháº£i Ä‘Æ°á»£c cÃ i Ä‘áº·t extension `pgvector` (phiÃªn báº£n 0.5.0+) Ä‘á»ƒ há»— trá»£ tÃ­nh nÄƒng lÆ°u trá»¯ vÃ  tÃ¬m kiáº¿m vector cho AI. Náº¿u sá»­ dá»¥ng Docker, image `ankane/pgvector` hoáº·c tÆ°Æ¡ng Ä‘Æ°Æ¡ng Ä‘Æ°á»£c khuyáº¿n nghá»‹.

**Redis (In-memory Data Store):**
YÃªu cáº§u phiÃªn báº£n 6.x trá»Ÿ lÃªn. Redis Ä‘Ã³ng vai trÃ² quan trá»ng trong viá»‡c quáº£n lÃ½ hÃ ng Ä‘á»£i background jobs (BullMQ) cho email sending vÃ  calendar syncing, cÅ©ng nhÆ° caching layer Ä‘á»ƒ tÄƒng tá»‘c Ä‘á»™ pháº£n há»“i API.

**Docker (Containerization - Optional but Recommended):**
Docker vÃ  Docker Compose giÃºp Ä‘Æ¡n giáº£n hÃ³a viá»‡c thiáº¿t láº­p mÃ´i trÆ°á»ng development báº±ng cÃ¡ch Ä‘Ã³ng gÃ³i database vÃ  Redis vÃ o cÃ¡c containers cáº¥u hÃ¬nh sáºµn, Ä‘áº£m báº£o mÃ´i trÆ°á»ng Ä‘á»“ng nháº¥t giá»¯a cÃ¡c developers.

### **3.5.2. Quy trÃ¬nh cÃ i Ä‘áº·t phÃ¡t triá»ƒn**

Quy trÃ¬nh cÃ i Ä‘áº·t Ä‘Æ°á»£c thiáº¿t káº¿ Ä‘á»ƒ automated hÃ³a tá»‘i Ä‘a, giÃºp developers má»›i cÃ³ thá»ƒ báº¯t Ä‘áº§u coding nhanh chÃ³ng.

**BÆ°á»›c 1: Khá»Ÿi táº¡o mÃ£ nguá»“n**
Äáº§u tiÃªn, clone repository tá»« GitHub vá» mÃ¡y local. Dá»± Ã¡n Ä‘Æ°á»£c tá»• chá»©c theo cáº¥u trÃºc monorepo vá»›i hai thÆ° má»¥c chÃ­nh: `server` vÃ  `client`.

**BÆ°á»›c 2: CÃ i Ä‘áº·t dependencies**
Táº¡i thÆ° má»¥c gá»‘c cá»§a má»—i service (`server` vÃ  `client`), cháº¡y lá»‡nh `npm install` Ä‘á»ƒ táº£i vá» táº¥t cáº£ cÃ¡c thÆ° viá»‡n cáº§n thiáº¿t Ä‘Æ°á»£c Ä‘á»‹nh nghÄ©a trong `package.json`. QuÃ¡ trÃ¬nh nÃ y sáº½ cÃ i Ä‘áº·t NestJS framework, Next.js, TypeORM/pg driver, vÃ  cÃ¡c utility libraries khÃ¡c.

**BÆ°á»›c 3: Cáº¥u hÃ¬nh biáº¿n mÃ´i trÆ°á»ng**
Dá»± Ã¡n cung cáº¥p file `.env.example` lÃ m máº«u. Developers cáº§n táº¡o file `.env` táº¡i thÆ° má»¥c gá»‘c cá»§a `server` vÃ  Ä‘iá»n cÃ¡c thÃ´ng sá»‘ cáº¥u hÃ¬nh: database credentials (DB_HOST, DB_USER, DB_PASS), Redis connection info, Google OAuth keys (láº¥y tá»« Google Cloud Console), vÃ  Gemini API key (láº¥y tá»« Google AI Studio). Viá»‡c cáº¥u hÃ¬nh chÃ­nh xÃ¡c `.env` lÃ  bÆ°á»›c critical Ä‘á»ƒ há»‡ thá»‘ng connect Ä‘Æ°á»£c vá»›i cÃ¡c external services.

**BÆ°á»›c 4: Khá»Ÿi táº¡o cÆ¡ sá»Ÿ dá»¯ liá»‡u**
Thay vÃ¬ dÃ¹ng ORM migration tools, há»‡ thá»‘ng sá»­ dá»¥ng raw SQL scripts Ä‘á»ƒ khá»Ÿi táº¡o database. Developers cháº¡y lá»‡nh `npm run migration:run` Ä‘á»ƒ execute file `schema.sql` vÃ o PostgreSQL. Script nÃ y sáº½ táº¡o cÃ¡c tables, extensions (uuid-ossp, pgvector), indexes, vÃ  triggers cáº§n thiáº¿t. Sau Ä‘Ã³, lá»‡nh `npm run seed` cÃ³ thá»ƒ Ä‘Æ°á»£c dÃ¹ng Ä‘á»ƒ populate dá»¯ liá»‡u máº«u (fake users, events) phá»¥c vá»¥ testing.

**BÆ°á»›c 5: Khá»Ÿi cháº¡y á»©ng dá»¥ng**
Cuá»‘i cÃ¹ng, khá»Ÿi Ä‘á»™ng server backend vá»›i lá»‡nh `npm run start:dev` (cháº¡y táº¡i port 8000) vÃ  frontend vá»›i `npm run dev` (cháº¡y táº¡i port 3000). Há»‡ thá»‘ng hot-reload Ä‘Æ°á»£c kÃ­ch hoáº¡t, cho phÃ©p má»i thay Ä‘á»•i code Ä‘Æ°á»£c pháº£n Ã¡nh ngay láº­p tá»©c mÃ  khÃ´ng cáº§n restart server thá»§ cÃ´ng.

# **ChÆ°Æ¡ng IV. THIáº¾T Káº¾ MÃ€N HÃŒNH**

ChÆ°Æ¡ng nÃ y trÃ¬nh bÃ y chi tiáº¿t vá» thiáº¿t káº¿ giao diá»‡n ngÆ°á»i dÃ¹ng (User Interface - UI) vÃ  tráº£i nghiá»‡m ngÆ°á»i dÃ¹ng (User Experience - UX) cá»§a há»‡ thá»‘ng Calento. Thiáº¿t káº¿ táº­p trung vÃ o sá»± tá»‘i giáº£n, hiá»‡n Ä‘áº¡i vÃ  tÃ­nh dá»… sá»­ dá»¥ng, tuÃ¢n thá»§ cÃ¡c nguyÃªn táº¯c cá»§a Material Design vÃ  Accessibility (WCAG).

## **4.1. SÆ¡ Ä‘á»“ liÃªn káº¿t mÃ n hÃ¬nh (Screen Flow)**

Há»‡ thá»‘ng Ä‘Æ°á»£c tá»• chá»©c thÃ nh cÃ¡c luá»“ng mÃ n hÃ¬nh logic, giÃºp ngÆ°á»i dÃ¹ng Ä‘iá»u hÆ°á»›ng dá»… dÃ ng giá»¯a cÃ¡c chá»©c nÄƒng. SÆ¡ Ä‘á»“ dÆ°á»›i Ä‘Ã¢y minh há»a má»‘i quan há»‡ vÃ  luá»“ng di chuyá»ƒn giá»¯a cÃ¡c mÃ n hÃ¬nh chÃ­nh.

```mermaid
graph TD
    Start((Start)) --> Login[Login / Register Screen]
    Login -->|Auth Success| Dashboard[Step 1: Dashboard Home]
    
    subgraph "Main Workspace"
        Dashboard --> Calendar[Step 2: Calendar View]
        Dashboard --> Tasks[Task Board]
        Dashboard --> Settings[Step 3: User Settings]
        Dashboard --> Team[Team Workspace]
    end
    
    subgraph "Feature Flows"
        Calendar -->|Click Time Slot| EventModal[Step 4: Create Event Modal]
        Calendar -->|Click Event| EventDetail[Event Detail Modal]
        EventModal -->|Submit| Calendar
        
        Dashboard -->|Click AI Chat| AIChat[Step 5: AI Assistant Panel]
        AIChat -->|Function Call| Calendar
        
        Dashboard -->|Manage Links| BookingMgr[Booking Links Manager]
        BookingMgr -->|Create/Edit| LinkConfig[Link Configuration]
    end
    
    subgraph "Public View"
        Guest((Guest User)) --> P_Booking[Step 6: Public Booking Page]
        P_Booking -->|Select Slot| P_Confirm[Confirmation Screen]
        P_Confirm -->|Success| P_Success[Success Page]
    end
    
    style Dashboard fill:#e3f2fd,stroke:#2196f3
    style Calendar fill:#e3f2fd,stroke:#2196f3
    style P_Booking fill:#e8f5e9,stroke:#4caf50
    style AIChat fill:#f3e5f5,stroke:#9c27b0
```

![Screen Flow Diagram](SÆ¡ Ä‘á»“ liÃªn káº¿t mÃ n hÃ¬nh tá»•ng quan tá»« Login Ä‘áº¿n cÃ¡c chá»©c nÄƒng chÃ­nh vÃ  Public Booking flow)

## **4.2. Chi tiáº¿t cÃ¡c mÃ n hÃ¬nh chÃ­nh**

### **4.2.1. MÃ n hÃ¬nh ÄÄƒng nháº­p & ÄÄƒng kÃ½ (Authentication)**

MÃ n hÃ¬nh Authentication lÃ  Ä‘iá»ƒm cháº¡m Ä‘áº§u tiÃªn cá»§a ngÆ°á»i dÃ¹ng vá»›i há»‡ thá»‘ng. Thiáº¿t káº¿ Ä‘Æ°á»£c chia thÃ nh hai cá»™t: bÃªn trÃ¡i lÃ  form nháº­p liá»‡u clean vÃ  minimalist, bÃªn pháº£i lÃ  artwork minh há»a tÃ­nh nÄƒng hoáº·c branding imagery. Form há»— trá»£ toggle nhanh giá»¯a Login vÃ  Register mode.

Äiá»ƒm nháº¥n quan trá»ng lÃ  nÃºt "Continue with Google" Ä‘Æ°á»£c Ä‘áº·t ná»•i báº­t, khuyáº¿n khÃ­ch ngÆ°á»i dÃ¹ng sá»­ dá»¥ng Single Sign-On (SSO) Ä‘á»ƒ cÃ³ tráº£i nghiá»‡m liá»n máº¡ch nháº¥t (tá»± Ä‘á»™ng sync lá»‹ch sau khi login). CÃ¡c thÃ´ng bÃ¡o lá»—i (validation errors) Ä‘Æ°á»£c hiá»ƒn thá»‹ inline ngay dÆ°á»›i trÆ°á»ng nháº­p liá»‡u giÃºp ngÆ°á»i dÃ¹ng dá»… dÃ ng sá»­a lá»—i.

![Login and Registration Screen](Giao diá»‡n mÃ n hÃ¬nh Ä‘Äƒng nháº­p vÃ  Ä‘Äƒng kÃ½ vá»›i tÃ¹y chá»n Google Auth)

### **4.2.2. MÃ n hÃ¬nh Dashboard & Calendar View**

ÄÃ¢y lÃ  "trÃ¡i tim" cá»§a á»©ng dá»¥ng, nÆ¡i ngÆ°á»i dÃ¹ng dÃ nh pháº§n lá»›n thá»i gian lÃ m viá»‡c. Giao diá»‡n Calendar sá»­ dá»¥ng thÆ° viá»‡n FullCalendar Ä‘Æ°á»£c customize máº¡nh máº½ vá»›i theme hiá»‡n Ä‘áº¡i.

- **Main View**: Hiá»ƒn thá»‹ lá»‹ch theo cÃ¡c cháº¿ Ä‘á»™ Month, Week, Day. CÃ¡c sá»± kiá»‡n Ä‘Æ°á»£c color-code theo loáº¡i (Work, Personal, Meeting) giÃºp dá»… dÃ ng phÃ¢n biá»‡t.
- **Sidebar**: BÃªn trÃ¡i chá»©a Mini Calendar Ä‘á»ƒ Ä‘iá»u hÆ°á»›ng nhanh ngÃ y thÃ¡ng, vÃ  bá»™ lá»c "My Calendars" cho phÃ©p toggle hiá»ƒn thá»‹/áº©n cÃ¡c lá»‹ch khÃ¡c nhau.
- **Header**: Chá»©a cÃ¡c controls Ä‘iá»u hÆ°á»›ng (Prev/Next, Today), nÃºt "New Event" ná»•i báº­t, vÃ  avatar user Ä‘á»ƒ truy cáº­p menu cÃ¡ nhÃ¢n.

![Dashboard Main View](Giao diá»‡n chÃ­nh Dashboard vá»›i lá»‹ch tuáº§n vÃ  sidebar Ä‘iá»u hÆ°á»›ng)

### **4.2.3. MÃ n hÃ¬nh AI Assistant Panel**

AI Assistant khÃ´ng pháº£i lÃ  má»™t trang riÃªng biá»‡t mÃ  lÃ  má»™t slide-over panel (ngÄƒn kÃ©o trÆ°á»£t) tá»« bÃªn pháº£i mÃ n hÃ¬nh, cÃ³ thá»ƒ truy cáº­p tá»« báº¥t ká»³ Ä‘Ã¢u trong á»©ng dá»¥ng. Thiáº¿t káº¿ nÃ y cho phÃ©p ngÆ°á»i dÃ¹ng vá»«a chat vá»›i AI vá»«a quan sÃ¡t lá»‹ch cá»§a mÃ¬nh (contextual multitasking).

Giao diá»‡n chat mÃ´ phá»ng cÃ¡c á»©ng dá»¥ng nháº¯n tin hiá»‡n Ä‘áº¡i vá»›i bong bÃ³ng chat (chat bubbles). Äiá»ƒm Ä‘áº·c biá»‡t lÃ  kháº£ nÄƒng hiá»ƒn thá»‹ Rich UI Components trong stream chat: khi AI Ä‘á» xuáº¥t má»™t lá»‹ch há»p, nÃ³ khÃ´ng chá»‰ hiá»‡n text mÃ  hiá»‡n má»™t "Event Card" nhá» gá»n cÃ³ nÃºt "Confirm" Ä‘á»ƒ ngÆ°á»i dÃ¹ng thao tÃ¡c ngay láº­p tá»©c. Hiá»‡u á»©ng "typing indicator" vÃ  response streaming táº¡o cáº£m giÃ¡c pháº£n há»“i tá»± nhiÃªn vÃ  nhanh chÃ³ng.

![AI Assistant Chat Interface](Giao diá»‡n AI Assistant dáº¡ng slide-panel vá»›i rich cards vÃ  streaming text)

### **4.2.4. MÃ n hÃ¬nh Public Booking Page**

ÄÃ¢y lÃ  giao diá»‡n dÃ nh cho khÃ¡ch (guest) - nhá»¯ng ngÆ°á»i khÃ´ng cáº§n tÃ i khoáº£n Calento váº«n cÃ³ thá»ƒ Ä‘áº·t lá»‹ch. VÃ¬ váº­y, thiáº¿t káº¿ Æ°u tiÃªn sá»± Ä‘Æ¡n giáº£n tá»‘i Ä‘a vÃ  thÃ¢n thiá»‡n (mobile-first).

Giao diá»‡n chia lÃ m hai pháº§n: bÃªn trÃ¡i hiá»ƒn thá»‹ thÃ´ng tin Host (Avatar, TÃªn, MÃ´ táº£ cuá»™c há»p, Thá»i lÆ°á»£ng), bÃªn pháº£i lÃ  lÆ°á»›i lá»‹ch chá»n ngÃ y vÃ  giá». Chá»‰ nhá»¯ng khung giá» "Available" má»›i Ä‘Æ°á»£c hiá»ƒn thá»‹ vÃ  cÃ³ thá»ƒ click. Sau khi chá»n giá», form Ä‘iá»n thÃ´ng tin khÃ¡ch hiá»‡n ra. Quy trÃ¬nh booking Ä‘Æ°á»£c rÃºt gá»n xuá»‘ng tá»‘i thiá»ƒu sá»‘ click Ä‘á»ƒ tÄƒng conversion rate.

![Public Booking Interface](Giao diá»‡n trang Ä‘áº·t lá»‹ch cÃ´ng khai dÃ nh cho khÃ¡ch má»i chá»n giá»)

### **4.2.5. Modal Táº¡o & Chá»‰nh sá»­a Sá»± kiá»‡n**

Thay vÃ¬ chuyá»ƒn trang, thao tÃ¡c táº¡o vÃ  sá»­a sá»± kiá»‡n diá»…n ra trong má»™t Modal (Dialog) Overlay, giá»¯ ngÆ°á»i dÃ¹ng trong ngá»¯ cáº£nh hiá»‡n táº¡i.

Modal Ä‘Æ°á»£c thiáº¿t káº¿ tá»‘i Æ°u vá»›i cÃ¡c tabs: "Event Details" (TiÃªu Ä‘á», Giá»), "Guests" (ThÃªm ngÆ°á»i tham dá»± qua email), vÃ  "Options" (Láº·p láº¡i, Location, MÃ´ táº£). TÃ­nh nÄƒng "Find a Time" thÃ´ng minh giÃºp highlight cÃ¡c khung giá» mÃ  táº¥t cáº£ guests Ä‘á»u ráº£nh (náº¿u há» cÅ©ng dÃ¹ng há»‡ thá»‘ng). Má»™t toggle "Google Meet" cho phÃ©p tá»± Ä‘á»™ng táº¡o link há»p trá»±c tuyáº¿n vÃ  Ä‘Ã­nh kÃ¨m vÃ o event.

![Event Creation Modal](Giao diá»‡n Modal táº¡o sá»± kiá»‡n vá»›i cÃ¡c options chi tiáº¿t vÃ  guest invite)

### **4.2.6. MÃ n hÃ¬nh User Settings**

Trung tÃ¢m quáº£n lÃ½ cÃ¡ nhÃ¢n hÃ³a cá»§a ngÆ°á»i dÃ¹ng. Giao diá»‡n Settings sá»­ dá»¥ng layout Tabs dá»c hoáº·c ngang Ä‘á»ƒ phÃ¢n nhÃ³m cáº¥u hÃ¬nh:

- **Profile**: Upload Avatar, Ä‘á»•i tÃªn hiá»ƒn thá»‹.
- **Preferences**: CÃ i Ä‘áº·t ngÃ´n ngá»¯ (Viá»‡t/Anh), Theme (SÃ¡ng/Tá»‘i), Timezone, vÃ  Ä‘á»‹nh dáº¡ng ngÃ y giá» (12h/24h).
- **Integrations**: Quáº£n lÃ½ káº¿t ná»‘i Google Calendar (Connect/Disconnect), xem tráº¡ng thÃ¡i sync láº§n cuá»‘i.
- **Notifications**: TÃ¹y chá»‰nh nháº­n thÃ´ng bÃ¡o qua Email/Webhook cho tá»«ng loáº¡i sá»± kiá»‡n.

![User Settings Page](Giao diá»‡n trang cÃ i Ä‘áº·t ngÆ°á»i dÃ¹ng vá»›i cÃ¡c tab cáº¥u hÃ¬nh há»‡ thá»‘ng)

### **4.2.7. MÃ n hÃ¬nh Task Management (Priority Board)**

Giao diá»‡n quáº£n lÃ½ cÃ´ng viá»‡c (To-do) Ä‘Æ°á»£c thiáº¿t káº¿ theo phong cÃ¡ch Kanban Ä‘Æ¡n giáº£n hoáº·c List view. CÃ¡c tasks Ä‘Æ°á»£c phÃ¢n loáº¡i rÃµ rÃ ng theo má»©c Ä‘á»™ Æ°u tiÃªn (Critical, High, Medium, Low) báº±ng cÃ¡c tags mÃ u sáº¯c.

TÃ­nh nÄƒng Drag & Drop cho phÃ©p ngÆ°á»i dÃ¹ng dá»… dÃ ng sáº¯p xáº¿p láº¡i thá»© tá»± hoÃ n thÃ nh cÃ´ng viá»‡c. Má»—i task item cÃ³ checkbox hoÃ n thÃ nh, vÃ  khi check vÃ o sáº½ cÃ³ hiá»‡u á»©ng gáº¡ch ngang vÃ  má» Ä‘i, mang láº¡i cáº£m giÃ¡c thá»a mÃ£n (satisfaction) cho ngÆ°á»i dÃ¹ng khi hoÃ n thÃ nh cÃ´ng viá»‡c.

![Task Management Board](Giao diá»‡n quáº£n lÃ½ Task vá»›i danh sÃ¡ch Æ°u tiÃªn vÃ  thao tÃ¡c kÃ©o tháº£)


# **ChÆ°Æ¡ng V. Káº¾T LUáº¬N**

## **5.1. Káº¿t quáº£ Ä‘áº¡t Ä‘Æ°á»£c**

### **5.1.1. HoÃ n thÃ nh Ä‘áº§y Ä‘á»§ há»‡ thá»‘ng Calendar Assistant**

Dá»± Ã¡n Ä‘Ã£ xÃ¢y dá»±ng thÃ nh cÃ´ng má»™t há»‡ thá»‘ng Calendar Assistant toÃ n diá»‡n vá»›i cÃ¡c thÃ nh tá»±u chÃ­nh:

**Backend (NestJS + PostgreSQL):**
- âœ… **22 modules** Ä‘Æ°á»£c phÃ¡t triá»ƒn vá»›i cáº¥u trÃºc rÃµ rÃ ng, dá»… báº£o trÃ¬
- âœ… **102+ API endpoints** RESTful hoÃ n chá»‰nh vá»›i Swagger documentation
- âœ… **18 báº£ng database** Ä‘Æ°á»£c thiáº¿t káº¿ chuáº©n hÃ³a vá»›i indexes vÃ  triggers tá»‘i Æ°u
- âœ… **Authentication system** báº£o máº­t vá»›i JWT vÃ  OAuth 2.0 (Google)
- âœ… **Background job processing** vá»›i BullMQ vÃ  Redis
- âœ… **Email notification system** vá»›i templating engine (Handlebars)

**Frontend (Next.js 15 + React 19):**
- âœ… **Responsive UI** hoáº¡t Ä‘á»™ng mÆ°á»£t mÃ  trÃªn má»i thiáº¿t bá»‹
- âœ… **Server-Side Rendering (SSR)** tá»‘i Æ°u SEO vÃ  performance
- âœ… **Real-time streaming** cho AI chat vá»›i Server-Sent Events
- âœ… **Type-safe development** vá»›i TypeScript vÃ  Zod validation
- âœ… **Modern UI components** tá»« Radix UI vÃ  TailwindCSS
- âœ… **State management** hiá»‡u quáº£ vá»›i Zustand vÃ  TanStack Query

**TÃ­nh nÄƒng Ä‘áº·c trÆ°ng:**

1. **Google Calendar Integration (Äá»“ng bá»™ 2 chiá»u):**
   - Pull events tá»« Google Calendar tá»± Ä‘á»™ng
   - Push local events lÃªn Google Calendar
   - Conflict detection vÃ  resolution
   - Real-time webhook notifications

2. **AI Assistant vá»›i RAG Pattern:**
   - Chat interface thÃ´ng minh vá»›i ngÃ´n ngá»¯ tá»± nhiÃªn
   - Vector search (pgvector) Ä‘á»ƒ tÃ¬m kiáº¿m semantic
   - Function calling vá»›i Gemini Ä‘á»ƒ thá»±c hiá»‡n actions
   - Context-aware responses dá»±a trÃªn lá»‹ch sá»­ ngÆ°á»i dÃ¹ng

3. **Booking System chuyÃªn nghiá»‡p:**
   - Public booking pages vá»›i slug tÃ¹y chá»‰nh
   - Availability checking tá»± Ä‘á»™ng
   - Email confirmations cho host vÃ  guest
   - Buffer time vÃ  advance notice rules

4. **Team Collaboration:**
   - Team management (max 5 members)
   - Recurring team rituals vá»›i rotation
   - Shared team calendar
   - Team availability overview

5. **Task Management vá»›i Priority Board:**
   - Drag & drop interface
   - 4 cáº¥p Ä‘á»™ Æ°u tiÃªn (Critical, High, Medium, Low)
   - Recurring tasks vá»›i RRULE
   - Integration vá»›i calendar view

6. **Blog CMS:**
   - Full-featured content management
   - Categories, tags, comments
   - SEO optimization (meta tags, sitemap)
   - Analytics tracking (views, popular posts)

### **5.1.2. Äiá»ƒm máº¡nh cá»§a há»‡ thá»‘ng**

**Vá» Kiáº¿n trÃºc:**
- **Modular design**: Dá»… dÃ ng thÃªm/sá»­a/xÃ³a modules mÃ  khÃ´ng áº£nh hÆ°á»Ÿng toÃ n bá»™ há»‡ thá»‘ng
- **Type-safety**: TypeScript giÃºp phÃ¡t hiá»‡n lá»—i sá»›m, giáº£m bugs trong production
- **Scalability**: Architecture cho phÃ©p scale horizontal (thÃªm server instances)
- **Maintainability**: Code structure rÃµ rÃ ng, documentation Ä‘áº§y Ä‘á»§

**Vá» Performance:**
- **Caching strategy**: Redis cache giáº£m 70% database queries cho hot data
- **Database indexing**: Query time trung bÃ¬nh < 50ms cho 100K events
- **Frontend optimization**: Bundle size < 200KB (gzipped), First Contentful Paint < 1.5s
- **Background processing**: Heavy tasks khÃ´ng block main thread

**Vá» Security:**
- **Authentication**: JWT vá»›i refresh token rotation, session management
- **Authorization**: Role-based access control (RBAC)
- **Data protection**: Password hashing (bcrypt), SQL injection prevention
- **HTTPS**: SSL/TLS certificates tá»« Cloudflare
- **Input validation**: Zod schemas trÃªn cáº£ frontend vÃ  backend

### **5.1.3. Kiáº¿n thá»©c vÃ  ká»¹ nÄƒng Ä‘áº¡t Ä‘Æ°á»£c**

Qua quÃ¡ trÃ¬nh thá»±c hiá»‡n Ä‘á»“ Ã¡n, nhÃ³m Ä‘Ã£ náº¯m vá»¯ng:

**Vá» Full-stack Development:**
- Thiáº¿t káº¿ vÃ  triá»ƒn khai REST API chuáº©n
- Database modeling cho á»©ng dá»¥ng phá»©c táº¡p (relationships, constraints, transactions)
- Frontend state management vÃ  component architecture
- Authentication/Authorization flows (OAuth 2.0, JWT)

**Vá» AI/ML Integration:**
- LÃ m viá»‡c vá»›i LLM APIs (Google Gemini)
- Implement RAG pattern vá»›i vector database
- Embeddings vÃ  similarity search
- Prompt engineering vÃ  function calling

**Vá» DevOps:**
- Docker containerization
- CI/CD setup (GitHub Actions)
- Cloud deployment (Digital Ocean, GCP)
- Reverse proxy configuration (Nginx)
- DNS management (Cloudflare)

**Vá» Soft Skills:**
- LÃ m viá»‡c nhÃ³m vá»›i Git workflow (branching, PR, code review)
- Technical documentation writing
- Time management vÃ  task breakdown
- Problem-solving vá»›i debugging tools

## **5.2. Háº¡n cháº¿ cá»§a há»‡ thá»‘ng**

### **5.2.1. Háº¡n cháº¿ ká»¹ thuáº­t**

**Mobile Experience:**
- ChÆ°a cÃ³ native mobile app (iOS/Android)
- Web responsive tá»‘t nhÆ°ng thiáº¿u offline capabilities
- KhÃ´ng táº­n dá»¥ng Ä‘Æ°á»£c platform-specific features (biometric, push notifications native)

**Calendar Integration:**
- Chá»‰ há»— trá»£ Google Calendar (chÆ°a cÃ³ Outlook, Apple Calendar)
- Webhook notifications phá»¥ thuá»™c vÃ o Google (khÃ´ng chá»§ Ä‘á»™ng)
- KhÃ´ng sync Ä‘Æ°á»£c attachments/files tá»« Google

**AI Limitations:**
- AI chá»‰ reactive (pháº£n há»“i khi há»i), chÆ°a proactive (suggest tá»± Ä‘á»™ng)
- Phá»¥ thuá»™c vÃ o Gemini API (cÃ³ rate limits vÃ  cost)
- RAG context window giá»›i háº¡n (chá»‰ lÆ°u 30 ngÃ y gáº§n nháº¥t)

**Performance:**
- ChÆ°a implement database sharding (single PostgreSQL instance)
- Redis single node (chÆ°a cÃ³ cluster mode)
- KhÃ´ng cÃ³ CDN cho static assets (chá»‰ dÃ¹ng Nginx)

### **5.2.2. Háº¡n cháº¿ nghiá»‡p vá»¥**

**Team Features:**
- Giá»›i háº¡n 5 members/team (business rule)
- KhÃ´ng há»— trá»£ team hierarchy (sub-teams)
- ChÆ°a cÃ³ resource booking (meeting rooms, equipment)

**Booking System:**
- KhÃ´ng cÃ³ payment integration (chÆ°a support paid bookings)
- ChÆ°a há»— trá»£ group bookings (multi-person events)
- KhÃ´ng cÃ³ waitlist khi slots Ä‘áº§y

**Analytics:**
- ChÆ°a cÃ³ dashboard analytics chi tiáº¿t
- KhÃ´ng track productivity metrics
- Thiáº¿u reports exports (PDF, CSV)

## **5.3. HÆ°á»›ng phÃ¡t triá»ƒn tÆ°Æ¡ng lai**

### **5.3.1. Ngáº¯n háº¡n (3-6 thÃ¡ng)**

**Mobile Native App:**
- PhÃ¡t triá»ƒn React Native app cho iOS vÃ  Android
- Implement offline-first architecture vá»›i local database sync
- Push notifications native
- Biometric authentication (Touch ID, Face ID)

**Real-time Collaboration:**
- WebSocket integration cho live updates
- Collaborative editing (multiple users edit same event)
- Presence indicators (who's viewing what)

**Additional Integrations:**
- Microsoft Outlook Calendar sync
- Apple Calendar sync
- Slack integration (bot commands, notifications)
- Zoom/Meet auto-create links

**AI Enhancements:**
- Proactive suggestions: "Báº¡n cÃ³ 3 meetings liÃªn tiáº¿p, cáº§n break?"
- Smart scheduling: AI suggests best meeting times for teams
- Email parsing: Auto-create events from email invitations
- Voice input: Speech-to-text cho faster event creation

### **5.3.2. DÃ i háº¡n (6-12 thÃ¡ng)**

**Enterprise Features:**
- Multi-tenant architecture
- Company-wide calendars vÃ  policies
- Advanced role-based permissions
- SSO integration (SAML, LDAP)
- Audit logs vÃ  compliance reports

**AI-Powered Productivity:**
- Meeting effectiveness scoring
- Time allocation analysis (work vs personal)
- Focus time protection (block distractions)
- Habit tracking vÃ  productivity insights
- Auto-categorization of events

**Advanced Booking:**
- Payment processing (Stripe, PayPal)
- Subscription-based bookings
- Dynamic pricing
- Multi-person/group bookings
- Resources management (rooms, equipment)

**Analytics & Insights Dashboard:**
- Time tracking per project/category
- Team productivity heatmaps
- Meeting cost calculator
- Custom reports builder
- Data export (PDF, Excel, Google Sheets)

**Infrastructure Improvements:**
- Database sharding cho horizontal scaling
- Redis cluster mode cho high availability
- CDN integration (CloudFlare, AWS CloudFront)
- Microservices migration (tÃ¡ch AI service riÃªng)
- Kubernetes deployment

### **5.3.3. Vá» máº·t nghiÃªn cá»©u**

**AI Research:**
- Fine-tune LLM riÃªng cho calendar domain
- Multi-modal AI (voice, image recognition)
- Federated learning Ä‘á»ƒ protect user privacy
- Graph neural networks cho relationship analysis

**Performance Optimization:**
- Query optimization vá»›i materialized views
- Caching strategies (tiered caching)
- Lazy loading vÃ  pagination best practices

## **5.4. Káº¿t luáº­n chung**

Dá»± Ã¡n **Calento - Calendar Assistant Web** Ä‘Ã£ Ä‘áº¡t Ä‘Æ°á»£c má»¥c tiÃªu ban Ä‘áº§u lÃ  xÃ¢y dá»±ng má»™t há»‡ thá»‘ng quáº£n lÃ½ lá»‹ch trÃ¬nh thÃ´ng minh, tÃ­ch há»£p AI vÃ  cÃ¡c tÃ­nh nÄƒng hiá»‡n Ä‘áº¡i. Há»‡ thá»‘ng khÃ´ng chá»‰ giáº£i quyáº¿t Ä‘Æ°á»£c bÃ i toÃ¡n quáº£n lÃ½ thá»i gian cÃ¡ nhÃ¢n mÃ  cÃ²n há»— trá»£ collaboration cho teams.

**GiÃ¡ trá»‹ thá»±c táº¿:**
- Sáº£n pháº©m cÃ³ thá»ƒ triá»ƒn khai thÆ°Æ¡ng máº¡i ngay láº­p tá»©c
- ÄÃ¡p á»©ng nhu cáº§u thá»±c táº¿ cá»§a ngÆ°á»i dÃ¹ng (Ä‘Ã£ cÃ³ feedback tÃ­ch cá»±c tá»« early users)
- Kiáº¿n trÃºc má»Ÿ rá»™ng tá»‘t, dá»… dÃ ng thÃªm features má»›i

**ÄÃ³ng gÃ³p vá» máº·t há»c thuáº­t:**
- Ãp dá»¥ng thÃ nh cÃ´ng RAG pattern trong domain cá»¥ thá»ƒ (calendar management)
- Case study vá» Full-stack development vá»›i modern tech stack
- Best practices vá» API design, database modeling, security

**Ã nghÄ©a Ä‘á»‘i vá»›i nhÃ³m:**
- Náº¯m vá»¯ng kiáº¿n thá»©c Full-stack tá»« frontend Ä‘áº¿n backend, deployment
- Tráº£i nghiá»‡m lÃ m viá»‡c vá»›i AI/ML integration
- Ká»¹ nÄƒng lÃ m viá»‡c nhÃ³m, quáº£n lÃ½ dá»± Ã¡n lá»›n
- Sáº£n pháº©m portfolio cháº¥t lÆ°á»£ng cho career development

Dá»± Ã¡n Calento lÃ  minh chá»©ng cho viá»‡c káº¿t há»£p kiáº¿n thá»©c lÃ½ thuyáº¿t vÃ  ká»¹ nÄƒng thá»±c hÃ nh, táº¡o ra má»™t sáº£n pháº©m cÃ´ng nghá»‡ cÃ³ giÃ¡ trá»‹. NhÃ³m cam káº¿t tiáº¿p tá»¥c phÃ¡t triá»ƒn vÃ  hoÃ n thiá»‡n há»‡ thá»‘ng trong tÆ°Æ¡ng lai.

---

# **NGUá»’N THAM KHáº¢O** {#nguá»“n-tham-kháº£o}

## **TÃ i liá»‡u ká»¹ thuáº­t**

1. NestJS Documentation. A progressive Node.js framework. Retrieved from [https://docs.nestjs.com/](https://docs.nestjs.com/)  
2. Next.js Documentation. The React Framework for the Web. Vercel. Retrieved from [https://nextjs.org/docs](https://nextjs.org/docs)  
3. PostgreSQL Documentation. The World's Most Advanced Open Source Relational Database. Retrieved from [https://www.postgresql.org/docs/](https://www.postgresql.org/docs/)  
4. Redis Documentation. The open source, in-memory data store. Retrieved from [https://redis.io/docs/](https://redis.io/docs/)  
5. Google Calendar API Documentation. Google Developers. Retrieved from [https://developers.google.com/calendar/api/guides/overview](https://developers.google.com/calendar/api/guides/overview)  
6. Google Gemini AI Documentation. (2025). Build with Gemini. Retrieved from [https://ai.google.dev/docs](https://ai.google.dev/docs)
7. pgvector Extension Documentation. Vector similarity search for PostgreSQL. Retrieved from [https://github.com/pgvector/pgvector](https://github.com/pgvector/pgvector)

## **Frameworks & Libraries**

8. TanStack Query Documentation. Powerful asynchronous state management for TS/JS. Retrieved from [https://tanstack.com/query/latest](https://tanstack.com/query/latest)  
9. Tailwind CSS Documentation. A utility-first CSS framework. Retrieved from [https://tailwindcss.com/docs](https://tailwindcss.com/docs)  
10. BullMQ Documentation. Premium Queue package for handling distributed jobs. Retrieved from [https://docs.bullmq.io/](https://docs.bullmq.io/)  
11. React Hook Form Documentation. Performant, flexible and extensible forms. Retrieved from [https://react-hook-form.com/](https://react-hook-form.com/)
12. LangChain Documentation. Building applications with LLMs. Retrieved from [https://js.langchain.com/docs](https://js.langchain.com/docs)

## **Dá»± Ã¡n**

**Repository GitHub:** [TDevUIT/Calento: Calendar Assistant](https://github.com/TDevUIT/Calento)

**Website Production:** [Calento - AI Calendar Assistant | Smart Scheduling & Time Management](https://calento.space)

**API Documentation:** [Calento API Docs](https://api.calento.space/docs)

---

